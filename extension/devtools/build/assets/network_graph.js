"use strict";(()=>{var Ts=Object.create;var gi=Object.defineProperty;var As=Object.getOwnPropertyDescriptor;var Cs=Object.getOwnPropertyNames;var Rs=Object.getPrototypeOf,ks=Object.prototype.hasOwnProperty;var ye=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var Ls=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Cs(n))!ks.call(r,i)&&i!==e&&gi(r,i,{get:()=>n[i],enumerable:!(t=As(n,i))||t.enumerable});return r};var nt=(r,n,e)=>(e=r!=null?Ts(Rs(r)):{},Ls(n||!r||!r.__esModule?gi(e,"default",{value:r,enumerable:!0}):e,r));var mr=ye((nl,vr)=>{"use strict";var Xt=typeof Reflect=="object"?Reflect:null,Bi=Xt&&typeof Xt.apply=="function"?Xt.apply:function(n,e,t){return Function.prototype.apply.call(n,e,t)},An;Xt&&typeof Xt.ownKeys=="function"?An=Xt.ownKeys:Object.getOwnPropertySymbols?An=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:An=function(n){return Object.getOwnPropertyNames(n)};function fu(r){console&&console.warn&&console.warn(r)}var ji=Number.isNaN||function(n){return n!==n};function ve(){ve.init.call(this)}vr.exports=ve;vr.exports.once=mu;ve.EventEmitter=ve;ve.prototype._events=void 0;ve.prototype._eventsCount=0;ve.prototype._maxListeners=void 0;var Mi=10;function Cn(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ve,"defaultMaxListeners",{enumerable:!0,get:function(){return Mi},set:function(r){if(typeof r!="number"||r<0||ji(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Mi=r}});ve.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ve.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||ji(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Hi(r){return r._maxListeners===void 0?ve.defaultMaxListeners:r._maxListeners}ve.prototype.getMaxListeners=function(){return Hi(this)};ve.prototype.emit=function(n){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var i=n==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var h=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw h.context=a,h}var c=o[n];if(c===void 0)return!1;if(typeof c=="function")Bi(c,this,e);else for(var p=c.length,m=Xi(c,p),t=0;t<p;++t)Bi(m[t],this,e);return!0};function Vi(r,n,e,t){var i,o,a;if(Cn(e),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",n,e.listener?e.listener:e),o=r._events),a=o[n]),a===void 0)a=o[n]=e,++r._eventsCount;else if(typeof a=="function"?a=o[n]=t?[e,a]:[a,e]:t?a.unshift(e):a.push(e),i=Hi(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=r,h.type=n,h.count=a.length,fu(h)}return r}ve.prototype.addListener=function(n,e){return Vi(this,n,e,!1)};ve.prototype.on=ve.prototype.addListener;ve.prototype.prependListener=function(n,e){return Vi(this,n,e,!0)};function gu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qi(r,n,e){var t={fired:!1,wrapFn:void 0,target:r,type:n,listener:e},i=gu.bind(t);return i.listener=e,t.wrapFn=i,i}ve.prototype.once=function(n,e){return Cn(e),this.on(n,qi(this,n,e)),this};ve.prototype.prependOnceListener=function(n,e){return Cn(e),this.prependListener(n,qi(this,n,e)),this};ve.prototype.removeListener=function(n,e){var t,i,o,a,h;if(Cn(e),i=this._events,i===void 0)return this;if(t=i[n],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[n],i.removeListener&&this.emit("removeListener",n,t.listener||e));else if(typeof t!="function"){for(o=-1,a=t.length-1;a>=0;a--)if(t[a]===e||t[a].listener===e){h=t[a].listener,o=a;break}if(o<0)return this;o===0?t.shift():pu(t,o),t.length===1&&(i[n]=t[0]),i.removeListener!==void 0&&this.emit("removeListener",n,h||e)}return this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.removeAllListeners=function(n){var e,t,i;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[n]),this;if(arguments.length===0){var o=Object.keys(t),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[n],typeof e=="function")this.removeListener(n,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(n,e[i]);return this};function $i(r,n,e){var t=r._events;if(t===void 0)return[];var i=t[n];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?vu(i):Xi(i,i.length)}ve.prototype.listeners=function(n){return $i(this,n,!0)};ve.prototype.rawListeners=function(n){return $i(this,n,!1)};ve.listenerCount=function(r,n){return typeof r.listenerCount=="function"?r.listenerCount(n):Yi.call(r,n)};ve.prototype.listenerCount=Yi;function Yi(r){var n=this._events;if(n!==void 0){var e=n[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ve.prototype.eventNames=function(){return this._eventsCount>0?An(this._events):[]};function Xi(r,n){for(var e=new Array(n),t=0;t<n;++t)e[t]=r[t];return e}function pu(r,n){for(;n+1<r.length;n++)r[n]=r[n+1];r.pop()}function vu(r){for(var n=new Array(r.length),e=0;e<n.length;++e)n[e]=r[e].listener||r[e];return n}function mu(r,n){return new Promise(function(e,t){function i(a){r.removeListener(n,o),t(a)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",i),e([].slice.call(arguments))}Zi(r,n,o,{once:!0}),n!=="error"&&yu(r,i,{once:!0})})}function yu(r,n,e){typeof r.on=="function"&&Zi(r,"error",n,e)}function Zi(r,n,e,t){if(typeof r.on=="function")t.once?r.once(n,e):r.on(n,e);else if(typeof r.addEventListener=="function")r.addEventListener(n,function i(o){t.once&&r.removeEventListener(n,i),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var zt=ye((ol,Qi)=>{Qi.exports=function(n){return n!==null&&typeof n=="object"&&typeof n.addUndirectedEdgeWithKey=="function"&&typeof n.dropNode=="function"&&typeof n.multi=="boolean"}});var bo=ye((Tr,Ar)=>{(function(r,n){typeof Tr=="object"&&typeof Ar<"u"?Ar.exports=n():typeof define=="function"&&define.amd?define(n):(r=typeof globalThis<"u"?globalThis:r||self).graphology=n()})(Tr,function(){"use strict";function r(l){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},r(l)}function n(l,g){l.prototype=Object.create(g.prototype),l.prototype.constructor=l,t(l,g)}function e(l){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)},e(l)}function t(l,g){return t=Object.setPrototypeOf||function(d,s){return d.__proto__=s,d},t(l,g)}function i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(l,g,d){return o=i()?Reflect.construct:function(s,u,f){var v=[null];v.push.apply(v,u);var b=new(Function.bind.apply(s,v));return f&&t(b,f.prototype),b},o.apply(null,arguments)}function a(l){var g=typeof Map=="function"?new Map:void 0;return a=function(d){if(d===null||(s=d,Function.toString.call(s).indexOf("[native code]")===-1))return d;var s;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(g!==void 0){if(g.has(d))return g.get(d);g.set(d,u)}function u(){return o(d,arguments,e(this).constructor)}return u.prototype=Object.create(d.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),t(u,d)},a(l)}function h(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}var c=function(){for(var l=arguments[0],g=1,d=arguments.length;g<d;g++)if(arguments[g])for(var s in arguments[g])l[s]=arguments[g][s];return l};function p(l,g,d,s){var u=l._nodes.get(g),f=null;return u?f=s==="mixed"?u.out&&u.out[d]||u.undirected&&u.undirected[d]:s==="directed"?u.out&&u.out[d]:u.undirected&&u.undirected[d]:f}function m(l){return l!==null&&r(l)==="object"&&typeof l.addUndirectedEdgeWithKey=="function"&&typeof l.dropNode=="function"}function y(l){return r(l)==="object"&&l!==null&&l.constructor===Object}function w(l){var g;for(g in l)return!1;return!0}function _(l,g,d){Object.defineProperty(l,g,{enumerable:!1,configurable:!1,writable:!0,value:d})}function C(l,g,d){var s={enumerable:!0,configurable:!0};typeof d=="function"?s.get=d:(s.value=d,s.writable=!1),Object.defineProperty(l,g,s)}function S(l){return!!y(l)&&!(l.attributes&&!Array.isArray(l.attributes))}typeof Object.assign=="function"&&(c=Object.assign);var L,U={exports:{}},z=typeof Reflect=="object"?Reflect:null,R=z&&typeof z.apply=="function"?z.apply:function(l,g,d){return Function.prototype.apply.call(l,g,d)};L=z&&typeof z.ownKeys=="function"?z.ownKeys:Object.getOwnPropertySymbols?function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:function(l){return Object.getOwnPropertyNames(l)};var D=Number.isNaN||function(l){return l!=l};function G(){G.init.call(this)}U.exports=G,U.exports.once=function(l,g){return new Promise(function(d,s){function u(v){l.removeListener(g,f),s(v)}function f(){typeof l.removeListener=="function"&&l.removeListener("error",u),d([].slice.call(arguments))}ce(l,g,f,{once:!0}),g!=="error"&&function(v,b,E){typeof v.on=="function"&&ce(v,"error",b,E)}(l,u,{once:!0})})},G.EventEmitter=G,G.prototype._events=void 0,G.prototype._eventsCount=0,G.prototype._maxListeners=void 0;var W=10;function P(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}function M(l){return l._maxListeners===void 0?G.defaultMaxListeners:l._maxListeners}function T(l,g,d,s){var u,f,v,b;if(P(d),(f=l._events)===void 0?(f=l._events=Object.create(null),l._eventsCount=0):(f.newListener!==void 0&&(l.emit("newListener",g,d.listener?d.listener:d),f=l._events),v=f[g]),v===void 0)v=f[g]=d,++l._eventsCount;else if(typeof v=="function"?v=f[g]=s?[d,v]:[v,d]:s?v.unshift(d):v.push(d),(u=M(l))>0&&v.length>u&&!v.warned){v.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=l,E.type=g,E.count=v.length,b=E,console&&console.warn&&console.warn(b)}return l}function Q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function se(l,g,d){var s={fired:!1,wrapFn:void 0,target:l,type:g,listener:d},u=Q.bind(s);return u.listener=d,s.wrapFn=u,u}function te(l,g,d){var s=l._events;if(s===void 0)return[];var u=s[g];return u===void 0?[]:typeof u=="function"?d?[u.listener||u]:[u]:d?function(f){for(var v=new Array(f.length),b=0;b<v.length;++b)v[b]=f[b].listener||f[b];return v}(u):X(u,u.length)}function me(l){var g=this._events;if(g!==void 0){var d=g[l];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}function X(l,g){for(var d=new Array(g),s=0;s<g;++s)d[s]=l[s];return d}function ce(l,g,d,s){if(typeof l.on=="function")s.once?l.once(g,d):l.on(g,d);else{if(typeof l.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l);l.addEventListener(g,function u(f){s.once&&l.removeEventListener(g,u),d(f)})}}function pe(l){if(typeof l!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=l}Object.defineProperty(G,"defaultMaxListeners",{enumerable:!0,get:function(){return W},set:function(l){if(typeof l!="number"||l<0||D(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");W=l}}),G.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||D(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this},G.prototype.getMaxListeners=function(){return M(this)},G.prototype.emit=function(l){for(var g=[],d=1;d<arguments.length;d++)g.push(arguments[d]);var s=l==="error",u=this._events;if(u!==void 0)s=s&&u.error===void 0;else if(!s)return!1;if(s){var f;if(g.length>0&&(f=g[0]),f instanceof Error)throw f;var v=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw v.context=f,v}var b=u[l];if(b===void 0)return!1;if(typeof b=="function")R(b,this,g);else{var E=b.length,F=X(b,E);for(d=0;d<E;++d)R(F[d],this,g)}return!0},G.prototype.addListener=function(l,g){return T(this,l,g,!1)},G.prototype.on=G.prototype.addListener,G.prototype.prependListener=function(l,g){return T(this,l,g,!0)},G.prototype.once=function(l,g){return P(g),this.on(l,se(this,l,g)),this},G.prototype.prependOnceListener=function(l,g){return P(g),this.prependListener(l,se(this,l,g)),this},G.prototype.removeListener=function(l,g){var d,s,u,f,v;if(P(g),(s=this._events)===void 0)return this;if((d=s[l])===void 0)return this;if(d===g||d.listener===g)--this._eventsCount==0?this._events=Object.create(null):(delete s[l],s.removeListener&&this.emit("removeListener",l,d.listener||g));else if(typeof d!="function"){for(u=-1,f=d.length-1;f>=0;f--)if(d[f]===g||d[f].listener===g){v=d[f].listener,u=f;break}if(u<0)return this;u===0?d.shift():function(b,E){for(;E+1<b.length;E++)b[E]=b[E+1];b.pop()}(d,u),d.length===1&&(s[l]=d[0]),s.removeListener!==void 0&&this.emit("removeListener",l,v||g)}return this},G.prototype.off=G.prototype.removeListener,G.prototype.removeAllListeners=function(l){var g,d,s;if((d=this._events)===void 0)return this;if(d.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):d[l]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete d[l]),this;if(arguments.length===0){var u,f=Object.keys(d);for(s=0;s<f.length;++s)(u=f[s])!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(g=d[l])=="function")this.removeListener(l,g);else if(g!==void 0)for(s=g.length-1;s>=0;s--)this.removeListener(l,g[s]);return this},G.prototype.listeners=function(l){return te(this,l,!0)},G.prototype.rawListeners=function(l){return te(this,l,!1)},G.listenerCount=function(l,g){return typeof l.listenerCount=="function"?l.listenerCount(g):me.call(l,g)},G.prototype.listenerCount=me,G.prototype.eventNames=function(){return this._eventsCount>0?L(this._events):[]},typeof Symbol<"u"&&(pe.prototype[Symbol.iterator]=function(){return this}),pe.of=function(){var l=arguments,g=l.length,d=0;return new pe(function(){return d>=g?{done:!0}:{done:!1,value:l[d++]}})},pe.empty=function(){return new pe(function(){return{done:!0}})},pe.fromSequence=function(l){var g=0,d=l.length;return new pe(function(){return g>=d?{done:!0}:{done:!1,value:l[g++]}})},pe.is=function(l){return l instanceof pe||typeof l=="object"&&l!==null&&typeof l.next=="function"};var Y=pe,A={};A.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",A.SYMBOL_SUPPORT=typeof Symbol<"u";var Te=Y,be=A,j=be.ARRAY_BUFFER_SUPPORT,k=be.SYMBOL_SUPPORT,ne=function(l){var g=function(d){return typeof d=="string"||Array.isArray(d)||j&&ArrayBuffer.isView(d)?Te.fromSequence(d):typeof d!="object"||d===null?null:k&&typeof d[Symbol.iterator]=="function"?d[Symbol.iterator]():typeof d.next=="function"?d:null}(l);if(!g)throw new Error("obliterator: target is not iterable nor a valid iterator.");return g},he=ne,Ie=function(l,g){for(var d,s=arguments.length>1?g:1/0,u=s!==1/0?new Array(s):[],f=0,v=he(l);;){if(f===s)return u;if((d=v.next()).done)return f!==g&&(u.length=f),u;u[f++]=d.value}},tt=function(l){function g(d){var s;return(s=l.call(this)||this).name="GraphError",s.message=d,s}return n(g,l),g}(a(Error)),q=function(l){function g(d){var s;return(s=l.call(this,d)||this).name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(h(s),g.prototype.constructor),s}return n(g,l),g}(tt),x=function(l){function g(d){var s;return(s=l.call(this,d)||this).name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(h(s),g.prototype.constructor),s}return n(g,l),g}(tt),oe=function(l){function g(d){var s;return(s=l.call(this,d)||this).name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(h(s),g.prototype.constructor),s}return n(g,l),g}(tt);function Me(l,g){this.key=l,this.attributes=g,this.clear()}function an(l,g){this.key=l,this.attributes=g,this.clear()}function ut(l,g){this.key=l,this.attributes=g,this.clear()}function wn(l,g,d,s,u){this.key=g,this.attributes=u,this.undirected=l,this.source=d,this.target=s}function Dt(l,g,d,s,u,f,v){var b,E,F="out",N="in";if(g&&(F=N="undirected"),l.multi){if((E=(b=f[F])[u])===void 0&&(E=new Set,b[u]=E),E.add(d),s===u&&g)return;(b=v[N])[s]===void 0&&(b[s]=E)}else{if(f[F][u]=d,s===u&&g)return;v[N][s]=d}}function we(l,g,d){var s=l.multi,u=d.source,f=d.target,v=u.key,b=f.key,E=u[g?"undirected":"out"],F=g?"undirected":"in";if(b in E)if(s){var N=E[b];N.size===1?(delete E[b],delete f[F][v]):N.delete(d)}else delete E[b];s||delete f[F][v]}Me.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.directedSelfLoops=0,this.undirectedSelfLoops=0,this.in={},this.out={},this.undirected={}},an.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedSelfLoops=0,this.in={},this.out={}},an.prototype.upgradeToMixed=function(){this.undirectedDegree=0,this.undirectedSelfLoops=0,this.undirected={}},ut.prototype.clear=function(){this.undirectedDegree=0,this.undirectedSelfLoops=0,this.undirected={}},ut.prototype.upgradeToMixed=function(){this.inDegree=0,this.outDegree=0,this.directedSelfLoops=0,this.in={},this.out={}};function ie(l,g,d,s,u,f,v){var b,E,F,N;if(s=""+s,d===0){if(!(b=l._nodes.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" node in the graph.'));F=u,N=f}else if(d===3){if(u=""+u,!(E=l._edges.get(u)))throw new x("Graph.".concat(g,': could not find the "').concat(u,'" edge in the graph.'));var O=E.source.key,V=E.target.key;if(s===O)b=E.target;else{if(s!==V)throw new x("Graph.".concat(g,': the "').concat(s,'" node is not attached to the "').concat(u,'" edge (').concat(O,", ").concat(V,")."));b=E.source}F=f,N=v}else{if(!(E=l._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));b=d===1?E.source:E.target,F=u,N=f}return[b,F,N]}var le=[{name:function(l){return"get".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];return b.attributes[E]}}},{name:function(l){return"get".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u){return ie(this,g,d,s,u)[0].attributes}}},{name:function(l){return"has".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];return b.attributes.hasOwnProperty(E)}}},{name:function(l){return"set".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f,v){var b=ie(this,g,d,s,u,f,v),E=b[0],F=b[1],N=b[2];return E.attributes[F]=N,this.emit("nodeAttributesUpdated",{key:E.key,type:"set",attributes:E.attributes,name:F}),this}}},{name:function(l){return"update".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f,v){var b=ie(this,g,d,s,u,f,v),E=b[0],F=b[1],N=b[2];if(typeof N!="function")throw new q("Graph.".concat(g,": updater should be a function."));var O=E.attributes,V=N(O[F]);return O[F]=V,this.emit("nodeAttributesUpdated",{key:E.key,type:"set",attributes:E.attributes,name:F}),this}}},{name:function(l){return"remove".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];return delete b.attributes[E],this.emit("nodeAttributesUpdated",{key:b.key,type:"remove",attributes:b.attributes,name:E}),this}}},{name:function(l){return"replace".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];if(!y(E))throw new q("Graph.".concat(g,": provided attributes are not a plain object."));return b.attributes=E,this.emit("nodeAttributesUpdated",{key:b.key,type:"replace",attributes:b.attributes}),this}}},{name:function(l){return"merge".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];if(!y(E))throw new q("Graph.".concat(g,": provided attributes are not a plain object."));return c(b.attributes,E),this.emit("nodeAttributesUpdated",{key:b.key,type:"merge",attributes:b.attributes,data:E}),this}}},{name:function(l){return"update".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v=ie(this,g,d,s,u,f),b=v[0],E=v[1];if(typeof E!="function")throw new q("Graph.".concat(g,": provided updater is not a function."));return b.attributes=E(b.attributes),this.emit("nodeAttributesUpdated",{key:b.key,type:"update",attributes:b.attributes}),this}}}],Qe=[{name:function(l){return"get".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return f.attributes[u]}}},{name:function(l){return"get".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s){var u;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>1){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var f=""+s,v=""+arguments[1];if(!(u=p(this,f,v,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(f,'" - "').concat(v,'").'))}else if(s=""+s,!(u=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(d!=="mixed"&&u.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return u.attributes}}},{name:function(l){return"has".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return f.attributes.hasOwnProperty(u)}}},{name:function(l){return"set".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>3){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var b=""+s,E=""+u;if(u=arguments[2],f=arguments[3],!(v=p(this,b,E,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(b,'" - "').concat(E,'").'))}else if(s=""+s,!(v=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(d!=="mixed"&&v.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return v.attributes[u]=f,this.emit("edgeAttributesUpdated",{key:v.key,type:"set",attributes:v.attributes,name:u}),this}}},{name:function(l){return"update".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u,f){var v;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>3){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var b=""+s,E=""+u;if(u=arguments[2],f=arguments[3],!(v=p(this,b,E,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(b,'" - "').concat(E,'").'))}else if(s=""+s,!(v=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(typeof f!="function")throw new q("Graph.".concat(g,": updater should be a function."));if(d!=="mixed"&&v.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return v.attributes[u]=f(v.attributes[u]),this.emit("edgeAttributesUpdated",{key:v.key,type:"set",attributes:v.attributes,name:u}),this}}},{name:function(l){return"remove".concat(l,"Attribute")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return delete f.attributes[u],this.emit("edgeAttributesUpdated",{key:f.key,type:"remove",attributes:f.attributes,name:u}),this}}},{name:function(l){return"replace".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(!y(u))throw new q("Graph.".concat(g,": provided attributes are not a plain object."));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return f.attributes=u,this.emit("edgeAttributesUpdated",{key:f.key,type:"replace",attributes:f.attributes}),this}}},{name:function(l){return"merge".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(!y(u))throw new q("Graph.".concat(g,": provided attributes are not a plain object."));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return c(f.attributes,u),this.emit("edgeAttributesUpdated",{key:f.key,type:"merge",attributes:f.attributes,data:u}),this}}},{name:function(l){return"update".concat(l,"Attributes")},attacher:function(l,g,d){l.prototype[g]=function(s,u){var f;if(this.type!=="mixed"&&d!=="mixed"&&d!==this.type)throw new oe("Graph.".concat(g,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new oe("Graph.".concat(g,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var v=""+s,b=""+u;if(u=arguments[2],!(f=p(this,v,b,d)))throw new x("Graph.".concat(g,': could not find an edge for the given path ("').concat(v,'" - "').concat(b,'").'))}else if(s=""+s,!(f=this._edges.get(s)))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" edge in the graph.'));if(typeof u!="function")throw new q("Graph.".concat(g,": provided updater is not a function."));if(d!=="mixed"&&f.undirected!==(d==="undirected"))throw new x("Graph.".concat(g,': could not find the "').concat(s,'" ').concat(d," edge in the graph."));return f.attributes=u(f.attributes),this.emit("edgeAttributesUpdated",{key:f.key,type:"update",attributes:f.attributes}),this}}}],ee=Y,J=ne,I=function(){var l=arguments,g=null,d=-1;return new ee(function s(){if(g===null){if(++d>=l.length)return{done:!0};g=J(l[d])}var u=g.next();return u.done?(g=null,s()):u})},ht=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function vt(l,g){for(var d in g)l.push(g[d].key)}function ct(l,g){for(var d in g)g[d].forEach(function(s){return l.push(s.key)})}function mt(l,g,d){for(var s in l)if(s!==d){var u=l[s];g(u.key,u.attributes,u.source.key,u.target.key,u.source.attributes,u.target.attributes,u.undirected)}}function je(l,g,d){for(var s in l)s!==d&&l[s].forEach(function(u){return g(u.key,u.attributes,u.source.key,u.target.key,u.source.attributes,u.target.attributes,u.undirected)})}function yt(l,g,d){for(var s in l)if(s!==d){var u=l[s];if(g(u.key,u.attributes,u.source.key,u.target.key,u.source.attributes,u.target.attributes,u.undirected))return u.key}}function sn(l,g,d){var s,u,f,v,b;for(var E in l)if(E!==d){for(s=l[E].values();(u=s.next()).done!==!0;)if(v=(f=u.value).source,b=f.target,g(f.key,f.attributes,v.key,b.key,v.attributes,b.attributes,f.undirected))return f.key}}function bt(l,g){var d=Object.keys(l),s=d.length,u=null,f=0;return new Y(function v(){var b;if(u){var E=u.next();if(E.done)return u=null,f++,v();b=E.value}else{if(f>=s)return{done:!0};var F=d[f];if(F===g)return f++,v();if((b=l[F])instanceof Set)return u=b.values(),v();f++}return{done:!1,value:{edge:b.key,attributes:b.attributes,source:b.source.key,target:b.target.key,sourceAttributes:b.source.attributes,targetAttributes:b.target.attributes,undirected:b.undirected}}})}function Bt(l,g,d){var s=g[d];s&&l.push(s.key)}function Mt(l,g,d){var s=g[d];s&&s.forEach(function(u){return l.push(u.key)})}function Gt(l,g,d){var s=l[g];if(s){var u=s.source,f=s.target;d(s.key,s.attributes,u.key,f.key,u.attributes,f.attributes,s.undirected)}}function jt(l,g,d){var s=l[g];s&&s.forEach(function(u){return d(u.key,u.attributes,u.source.key,u.target.key,u.source.attributes,u.target.attributes,u.undirected)})}function lt(l,g,d){var s=l[g];if(s){var u=s.source,f=s.target;return d(s.key,s.attributes,u.key,f.key,u.attributes,f.attributes,s.undirected)?s.key:void 0}}function Ht(l,g,d){var s=l[g];if(s){for(var u,f,v=s.values();(u=v.next()).done!==!0;)if(d((f=u.value).key,f.attributes,f.source.key,f.target.key,f.source.attributes,f.target.attributes,f.undirected))return f.key}}function wt(l,g){var d=l[g];if(d instanceof Set){var s=d.values();return new Y(function(){var u=s.next();if(u.done)return u;var f=u.value;return{done:!1,value:{edge:f.key,attributes:f.attributes,source:f.source.key,target:f.target.key,sourceAttributes:f.source.attributes,targetAttributes:f.target.attributes,undirected:f.undirected}}})}return Y.of([d.key,d.attributes,d.source.key,d.target.key,d.source.attributes,d.target.attributes])}function ts(l,g){if(l.size===0)return[];if(g==="mixed"||g===l.type)return typeof Array.from=="function"?Array.from(l._edges.keys()):Ie(l._edges.keys(),l._edges.size);for(var d,s,u=g==="undirected"?l.undirectedSize:l.directedSize,f=new Array(u),v=g==="undirected",b=l._edges.values(),E=0;(d=b.next()).done!==!0;)(s=d.value).undirected===v&&(f[E++]=s.key);return f}function ns(l,g,d){if(l.size!==0){for(var s,u,f=g!=="mixed"&&g!==l.type,v=g==="undirected",b=l._edges.values();(s=b.next()).done!==!0;)if(u=s.value,!f||u.undirected===v){var E=u,F=E.key,N=E.attributes,O=E.source,V=E.target;d(F,N,O.key,V.key,O.attributes,V.attributes,u.undirected)}}}function rs(l,g,d){if(l.size!==0){for(var s,u,f=g!=="mixed"&&g!==l.type,v=g==="undirected",b=l._edges.values();(s=b.next()).done!==!0;)if(u=s.value,!f||u.undirected===v){var E=u,F=E.key,N=E.attributes,O=E.source,V=E.target;if(d(F,N,O.key,V.key,O.attributes,V.attributes,u.undirected))return F}}}function is(l,g){if(l.size===0)return Y.empty();var d=g!=="mixed"&&g!==l.type,s=g==="undirected",u=l._edges.values();return new Y(function(){for(var f,v;;){if((f=u.next()).done)return f;if(v=f.value,!d||v.undirected===s)break}return{value:{edge:v.key,attributes:v.attributes,source:v.source.key,target:v.target.key,sourceAttributes:v.source.attributes,targetAttributes:v.target.attributes,undirected:v.undirected},done:!1}})}function os(l,g,d,s){var u=[],f=l?ct:vt;return g!=="undirected"&&(d!=="out"&&f(u,s.in),d!=="in"&&f(u,s.out),!d&&s.directedSelfLoops>0&&u.splice(u.lastIndexOf(s.key),1)),g!=="directed"&&f(u,s.undirected),u}function as(l,g,d,s,u){var f=l?je:mt;g!=="undirected"&&(d!=="out"&&f(s.in,u),d!=="in"&&f(s.out,u,d?null:s.key)),g!=="directed"&&f(s.undirected,u)}function ss(l,g,d,s,u){var f,v=l?sn:yt;if(g!=="undirected"&&(d!=="out"&&(f=v(s.in,u))||d!=="in"&&(f=v(s.out,u,d?null:s.key)))||g!=="directed"&&(f=v(s.undirected,u)))return f}function us(l,g,d){var s=Y.empty();return l!=="undirected"&&(g!=="out"&&d.in!==void 0&&(s=I(s,bt(d.in))),g!=="in"&&d.out!==void 0&&(s=I(s,bt(d.out,g?null:d.key)))),l!=="directed"&&d.undirected!==void 0&&(s=I(s,bt(d.undirected))),s}function hs(l,g,d,s,u){var f=g?Mt:Bt,v=[];return l!=="undirected"&&(s.in!==void 0&&d!=="out"&&f(v,s.in,u),s.out!==void 0&&d!=="in"&&f(v,s.out,u),!d&&s.directedSelfLoops>0&&v.splice(v.lastIndexOf(s.key),1)),l!=="directed"&&s.undirected!==void 0&&f(v,s.undirected,u),v}function cs(l,g,d,s,u,f){var v=g?jt:Gt;l!=="undirected"&&(s.in!==void 0&&d!=="out"&&v(s.in,u,f),s.key!==u&&s.out!==void 0&&d!=="in"&&v(s.out,u,f)),l!=="directed"&&s.undirected!==void 0&&v(s.undirected,u,f)}function ls(l,g,d,s,u,f){var v,b=g?Ht:lt;if(l!=="undirected"&&(s.in!==void 0&&d!=="out"&&(v=b(s.in,u,f))||s.key!==u&&s.out!==void 0&&d!=="in"&&(v=b(s.out,u,f,d?null:s.key)))||l!=="directed"&&s.undirected!==void 0&&(v=b(s.undirected,u,f)))return v}function ds(l,g,d,s){var u=Y.empty();return l!=="undirected"&&(d.in!==void 0&&g!=="out"&&s in d.in&&(u=I(u,wt(d.in,s))),d.out!==void 0&&g!=="in"&&s in d.out&&(u=I(u,wt(d.out,s)))),l!=="directed"&&d.undirected!==void 0&&s in d.undirected&&(u=I(u,wt(d.undirected,s))),u}var fs=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function Qn(l,g){if(g!==void 0)for(var d in g)l.add(d)}function ei(l,g,d){for(var s in g){var u=g[s];u instanceof Set&&(u=u.values().next().value);var f=u.source,v=u.target,b=f===l?v:f;d(b.key,b.attributes)}}function Jn(l,g,d,s){for(var u in d){var f=d[u];f instanceof Set&&(f=f.values().next().value);var v=f.source,b=f.target,E=v===g?b:v;l.has(E.key)||(l.add(E.key),s(E.key,E.attributes))}}function ti(l,g,d){for(var s in g){var u=g[s];u instanceof Set&&(u=u.values().next().value);var f=u.source,v=u.target,b=f===l?v:f;if(d(b.key,b.attributes))return b.key}}function er(l,g,d,s){for(var u in d){var f=d[u];f instanceof Set&&(f=f.values().next().value);var v=f.source,b=f.target,E=v===g?b:v;if(!l.has(E.key)&&(l.add(E.key),s(E.key,E.attributes)))return E.key}}function ni(l,g){var d=Object.keys(g),s=d.length,u=0;return new Y(function(){if(u>=s)return{done:!0};var f=g[d[u++]];f instanceof Set&&(f=f.values().next().value);var v=f.source,b=f.target,E=v===l?b:v;return{done:!1,value:{neighbor:E.key,attributes:E.attributes}}})}function tr(l,g,d){var s=Object.keys(d),u=s.length,f=0;return new Y(function v(){if(f>=u)return{done:!0};var b=d[s[f++]];b instanceof Set&&(b=b.values().next().value);var E=b.source,F=b.target,N=E===g?F:E;return l.has(N.key)?v():(l.add(N.key),{done:!1,value:{neighbor:N.key,attributes:N.attributes}})})}function gs(l,g){var d=g.name,s=g.type,u=g.direction;l.prototype[d]=function(f){if(s!=="mixed"&&this.type!=="mixed"&&s!==this.type)return[];f=""+f;var v=this._nodes.get(f);if(v===void 0)throw new x("Graph.".concat(d,': could not find the "').concat(f,'" node in the graph.'));return function(b,E,F){if(b!=="mixed"){if(b==="undirected")return Object.keys(F.undirected);if(typeof E=="string")return Object.keys(F[E])}var N=new Set;return b!=="undirected"&&(E!=="out"&&Qn(N,F.in),E!=="in"&&Qn(N,F.out)),b!=="directed"&&Qn(N,F.undirected),Ie(N.values(),N.size)}(s==="mixed"?this.type:s,u,v)}}function ps(l,g){var d=g.name,s=g.type,u=g.direction,f="forEach"+d[0].toUpperCase()+d.slice(1,-1);l.prototype[f]=function(F,N){if(s==="mixed"||this.type==="mixed"||s===this.type){F=""+F;var O=this._nodes.get(F);if(O===void 0)throw new x("Graph.".concat(f,': could not find the "').concat(F,'" node in the graph.'));(function(V,$,Z,ue){if(V!=="mixed"){if(V==="undirected")return ei(Z,Z.undirected,ue);if(typeof $=="string")return ei(Z,Z[$],ue)}var ae=new Set;V!=="undirected"&&($!=="out"&&Jn(ae,Z,Z.in,ue),$!=="in"&&Jn(ae,Z,Z.out,ue)),V!=="directed"&&Jn(ae,Z,Z.undirected,ue)})(s==="mixed"?this.type:s,u,O,N)}};var v="map"+d[0].toUpperCase()+d.slice(1);l.prototype[v]=function(F,N){var O=[];return this[f](F,function(V,$){O.push(N(V,$))}),O};var b="filter"+d[0].toUpperCase()+d.slice(1);l.prototype[b]=function(F,N){var O=[];return this[f](F,function(V,$){N(V,$)&&O.push(V)}),O};var E="reduce"+d[0].toUpperCase()+d.slice(1);l.prototype[E]=function(F,N,O){if(arguments.length<3)throw new q("Graph.".concat(E,": missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array."));var V=O;return this[f](F,function($,Z){V=N(V,$,Z)}),V}}function vs(l,g){var d=g.name,s=g.type,u=g.direction,f=d[0].toUpperCase()+d.slice(1,-1),v="find"+f;l.prototype[v]=function(F,N){if(s==="mixed"||this.type==="mixed"||s===this.type){F=""+F;var O=this._nodes.get(F);if(O===void 0)throw new x("Graph.".concat(v,': could not find the "').concat(F,'" node in the graph.'));return function(V,$,Z,ue){if(V!=="mixed"){if(V==="undirected")return ti(Z,Z.undirected,ue);if(typeof $=="string")return ti(Z,Z[$],ue)}var ae,xe=new Set;if(V!=="undirected"&&($!=="out"&&(ae=er(xe,Z,Z.in,ue))||$!=="in"&&(ae=er(xe,Z,Z.out,ue)))||V!=="directed"&&(ae=er(xe,Z,Z.undirected,ue)))return ae}(s==="mixed"?this.type:s,u,O,N)}};var b="some"+f;l.prototype[b]=function(F,N){return!!this[v](F,N)};var E="every"+f;l.prototype[E]=function(F,N){return!this[v](F,function(O,V){return!N(O,V)})}}function ms(l,g){var d=g.name,s=g.type,u=g.direction,f=d.slice(0,-1)+"Entries";l.prototype[f]=function(v){if(s!=="mixed"&&this.type!=="mixed"&&s!==this.type)return Y.empty();v=""+v;var b=this._nodes.get(v);if(b===void 0)throw new x("Graph.".concat(f,': could not find the "').concat(v,'" node in the graph.'));return function(E,F,N){if(E!=="mixed"){if(E==="undirected")return ni(N,N.undirected);if(typeof F=="string")return ni(N,N[F])}var O=Y.empty(),V=new Set;return E!=="undirected"&&(F!=="out"&&(O=I(O,tr(V,N,N.in))),F!=="in"&&(O=I(O,tr(V,N,N.out)))),E!=="directed"&&(O=I(O,tr(V,N,N.undirected))),O}(s==="mixed"?this.type:s,u,b)}}function En(l,g,d,s,u){for(var f,v,b,E,F,N,O,V=s._nodes.values(),$=s.type;(f=V.next()).done!==!0;){var Z=!1;if(v=f.value,$!=="undirected"){for(b in E=v.out)if(N=(F=E[b]).target,Z=!0,O=u(v.key,N.key,v.attributes,N.attributes,F.key,F.attributes,F.undirected),l&&O)return F}if($!=="directed"){for(b in E=v.undirected)if(!(g&&v.key>b)&&((N=(F=E[b]).target).key!==b&&(N=F.source),Z=!0,O=u(v.key,N.key,v.attributes,N.attributes,F.key,F.attributes,F.undirected),l&&O))return F}if(d&&!Z&&(O=u(v.key,null,v.attributes,null,null,null,null),l&&O))return null}}function _n(l,g,d,s,u){for(var f,v,b,E,F,N,O,V,$,Z=s._nodes.values(),ue=s.type;(f=Z.next()).done!==!0;){var ae=!1;if(v=f.value,ue!=="undirected"){for(b in N=v.out)for(E=N[b].values();(F=E.next()).done!==!0;)if(V=(O=F.value).target,ae=!0,$=u(v.key,V.key,v.attributes,V.attributes,O.key,O.attributes,O.undirected),l&&$)return O}if(ue!=="directed"){for(b in N=v.undirected)if(!(g&&v.key>b)){for(E=N[b].values();(F=E.next()).done!==!0;)if((V=(O=F.value).target).key!==b&&(V=O.source),ae=!0,$=u(v.key,V.key,v.attributes,V.attributes,O.key,O.attributes,O.undirected),l&&$)return O}}if(d&&!ae&&($=u(v.key,null,v.attributes,null,null,null,null),l&&$))return null}}function ri(l,g){var d={key:l};return w(g.attributes)||(d.attributes=c({},g.attributes)),d}function ii(l,g){var d={key:l,source:g.source.key,target:g.target.key};return w(g.attributes)||(d.attributes=c({},g.attributes)),g.undirected&&(d.undirected=!0),d}function ys(l){return y(l)?"key"in l?!("attributes"in l)||y(l.attributes)&&l.attributes!==null?null:"invalid-attributes":"no-key":"not-object"}function bs(l){return y(l)?"source"in l?"target"in l?!("attributes"in l)||y(l.attributes)&&l.attributes!==null?"undirected"in l&&typeof l.undirected!="boolean"?"invalid-undirected":null:"invalid-attributes":"no-target":"no-source":"not-object"}var oi,ws=(oi=255&Math.floor(256*Math.random()),function(){return oi++}),Es=new Set(["directed","undirected","mixed"]),ai=new Set(["domain","_events","_eventsCount","_maxListeners"]),_s={allowSelfLoops:!0,multi:!1,type:"mixed"};function si(l,g,d){var s=new l.NodeDataClass(g,d);return l._nodes.set(g,s),l.emit("nodeAdded",{key:g,attributes:d}),s}function ui(l,g,d,s,u,f,v,b){if(!s&&l.type==="undirected")throw new oe("Graph.".concat(g,": you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead."));if(s&&l.type==="directed")throw new oe("Graph.".concat(g,": you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead."));if(b&&!y(b))throw new q("Graph.".concat(g,': invalid attributes. Expecting an object but got "').concat(b,'"'));if(f=""+f,v=""+v,b=b||{},!l.allowSelfLoops&&f===v)throw new oe("Graph.".concat(g,': source & target are the same ("').concat(f,`"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`));var E=l._nodes.get(f),F=l._nodes.get(v);if(!E)throw new x("Graph.".concat(g,': source node "').concat(f,'" not found.'));if(!F)throw new x("Graph.".concat(g,': target node "').concat(v,'" not found.'));var N={key:null,undirected:s,source:f,target:v,attributes:b};if(d)u=l._edgeKeyGenerator();else if(u=""+u,l._edges.has(u))throw new oe("Graph.".concat(g,': the "').concat(u,'" edge already exists in the graph.'));if(!l.multi&&(s?E.undirected[v]!==void 0:E.out[v]!==void 0))throw new oe("Graph.".concat(g,': an edge linking "').concat(f,'" to "').concat(v,`" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`));var O=new wn(s,u,E,F,b);return l._edges.set(u,O),f===v?s?(E.undirectedSelfLoops++,l._undirectedSelfLoopCount++):(E.directedSelfLoops++,l._directedSelfLoopCount++):s?(E.undirectedDegree++,F.undirectedDegree++):(E.outDegree++,F.inDegree++),Dt(l,s,O,f,v,E,F),s?l._undirectedSize++:l._directedSize++,N.key=u,l.emit("edgeAdded",N),u}function Ss(l,g,d,s,u,f,v,b,E){if(!s&&l.type==="undirected")throw new oe("Graph.".concat(g,": you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead."));if(s&&l.type==="directed")throw new oe("Graph.".concat(g,": you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead."));if(b){if(E){if(typeof b!="function")throw new q("Graph.".concat(g,': invalid updater function. Expecting a function but got "').concat(b,'"'))}else if(!y(b))throw new q("Graph.".concat(g,': invalid attributes. Expecting an object but got "').concat(b,'"'))}var F;if(f=""+f,v=""+v,E&&(F=b,b=void 0),!l.allowSelfLoops&&f===v)throw new oe("Graph.".concat(g,': source & target are the same ("').concat(f,`"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`));var N,O,V=l._nodes.get(f),$=l._nodes.get(v);if(!d&&(N=l._edges.get(u))){if(!(N.source.key===f&&N.target.key===v||s&&N.source.key===v&&N.target.key===f))throw new oe("Graph.".concat(g,': inconsistency detected when attempting to merge the "').concat(u,'" edge with "').concat(f,'" source & "').concat(v,'" target vs. ("').concat(N.source.key,'", "').concat(N.target.key,'").'));O=N}if(O||l.multi||!V||(O=s?V.undirected[v]:V.out[v]),O){var Z=[O.key,!1,!1,!1];if(E?!F:!b)return Z;if(E){var ue=O.attributes;O.attributes=F(ue),l.emit("edgeAttributesUpdated",{type:"replace",key:O.key,attributes:O.attributes})}else c(O.attributes,b),l.emit("edgeAttributesUpdated",{type:"merge",key:O.key,attributes:O.attributes,data:b});return Z}b=b||{},E&&F&&(b=F(b));var ae={key:null,undirected:s,source:f,target:v,attributes:b};if(d)u=l._edgeKeyGenerator();else if(u=""+u,l._edges.has(u))throw new oe("Graph.".concat(g,': the "').concat(u,'" edge already exists in the graph.'));var xe=!1,Ne=!1;return V||(V=si(l,f,{}),xe=!0,f===v&&($=V,Ne=!0)),$||($=si(l,v,{}),Ne=!0),N=new wn(s,u,V,$,b),l._edges.set(u,N),f===v?s?(V.undirectedSelfLoops++,l._undirectedSelfLoopCount++):(V.directedSelfLoops++,l._directedSelfLoopCount++):s?(V.undirectedDegree++,$.undirectedDegree++):(V.outDegree++,$.inDegree++),Dt(l,s,N,f,v,V,$),s?l._undirectedSize++:l._directedSize++,ae.key=u,l.emit("edgeAdded",ae),[u,!0,xe,Ne]}var Ee=function(l){function g(s){var u;if(u=l.call(this)||this,typeof(s=c({},_s,s)).multi!="boolean")throw new q(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "`.concat(s.multi,'".'));if(!Es.has(s.type))throw new q(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "`.concat(s.type,'".'));if(typeof s.allowSelfLoops!="boolean")throw new q(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "`.concat(s.allowSelfLoops,'".'));var f=s.type==="mixed"?Me:s.type==="directed"?an:ut;_(h(u),"NodeDataClass",f);var v=ws(),b=0;return _(h(u),"_attributes",{}),_(h(u),"_nodes",new Map),_(h(u),"_edges",new Map),_(h(u),"_directedSize",0),_(h(u),"_undirectedSize",0),_(h(u),"_directedSelfLoopCount",0),_(h(u),"_undirectedSelfLoopCount",0),_(h(u),"_edgeKeyGenerator",function(){var E;do E="geid_"+v+"_"+b++;while(u._edges.has(E));return E}),_(h(u),"_options",s),ai.forEach(function(E){return _(h(u),E,u[E])}),C(h(u),"order",function(){return u._nodes.size}),C(h(u),"size",function(){return u._edges.size}),C(h(u),"directedSize",function(){return u._directedSize}),C(h(u),"undirectedSize",function(){return u._undirectedSize}),C(h(u),"selfLoopCount",function(){return u._directedSelfLoopCount+u._undirectedSelfLoopCount}),C(h(u),"directedSelfLoopCount",function(){return u._directedSelfLoopCount}),C(h(u),"undirectedSelfLoopCount",function(){return u._undirectedSelfLoopCount}),C(h(u),"multi",u._options.multi),C(h(u),"type",u._options.type),C(h(u),"allowSelfLoops",u._options.allowSelfLoops),C(h(u),"implementation",function(){return"graphology"}),u}n(g,l);var d=g.prototype;return d._resetInstanceCounters=function(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0},d.hasNode=function(s){return this._nodes.has(""+s)},d.hasDirectedEdge=function(s,u){if(this.type==="undirected")return!1;if(arguments.length===1){var f=""+s,v=this._edges.get(f);return!!v&&!v.undirected}if(arguments.length===2){s=""+s,u=""+u;var b=this._nodes.get(s);if(!b)return!1;var E=b.out[u];return!!E&&(!this.multi||!!E.size)}throw new q("Graph.hasDirectedEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},d.hasUndirectedEdge=function(s,u){if(this.type==="directed")return!1;if(arguments.length===1){var f=""+s,v=this._edges.get(f);return!!v&&v.undirected}if(arguments.length===2){s=""+s,u=""+u;var b=this._nodes.get(s);if(!b)return!1;var E=b.undirected[u];return!!E&&(!this.multi||!!E.size)}throw new q("Graph.hasDirectedEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},d.hasEdge=function(s,u){if(arguments.length===1){var f=""+s;return this._edges.has(f)}if(arguments.length===2){s=""+s,u=""+u;var v=this._nodes.get(s);if(!v)return!1;var b=v.out!==void 0&&v.out[u];return b||(b=v.undirected!==void 0&&v.undirected[u]),!!b&&(!this.multi||!!b.size)}throw new q("Graph.hasEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},d.directedEdge=function(s,u){if(this.type!=="undirected"){if(s=""+s,u=""+u,this.multi)throw new oe("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");var f=this._nodes.get(s);if(!f)throw new x('Graph.directedEdge: could not find the "'.concat(s,'" source node in the graph.'));if(!this._nodes.has(u))throw new x('Graph.directedEdge: could not find the "'.concat(u,'" target node in the graph.'));var v=f.out&&f.out[u]||void 0;return v?v.key:void 0}},d.undirectedEdge=function(s,u){if(this.type!=="directed"){if(s=""+s,u=""+u,this.multi)throw new oe("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");var f=this._nodes.get(s);if(!f)throw new x('Graph.undirectedEdge: could not find the "'.concat(s,'" source node in the graph.'));if(!this._nodes.has(u))throw new x('Graph.undirectedEdge: could not find the "'.concat(u,'" target node in the graph.'));var v=f.undirected&&f.undirected[u]||void 0;return v?v.key:void 0}},d.edge=function(s,u){if(this.multi)throw new oe("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.edge: could not find the "'.concat(s,'" source node in the graph.'));if(!this._nodes.has(u))throw new x('Graph.edge: could not find the "'.concat(u,'" target node in the graph.'));var v=f.out&&f.out[u]||f.undirected&&f.undirected[u]||void 0;if(v)return v.key},d.areDirectedNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areDirectedNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&(u in f.in||u in f.out)},d.areOutNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areOutNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&u in f.out},d.areInNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areInNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&u in f.in},d.areUndirectedNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areUndirectedNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="directed"&&u in f.undirected},d.areNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&(u in f.in||u in f.out)||this.type!=="directed"&&u in f.undirected},d.areInboundNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areInboundNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&u in f.in||this.type!=="directed"&&u in f.undirected},d.areOutboundNeighbors=function(s,u){s=""+s,u=""+u;var f=this._nodes.get(s);if(!f)throw new x('Graph.areOutboundNeighbors: could not find the "'.concat(s,'" node in the graph.'));return this.type!=="undirected"&&u in f.out||this.type!=="directed"&&u in f.undirected},d.inDegree=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.inDegree: could not find the "'.concat(s,'" node in the graph.'));return this.type==="undirected"?0:u.inDegree+u.directedSelfLoops},d.outDegree=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.outDegree: could not find the "'.concat(s,'" node in the graph.'));return this.type==="undirected"?0:u.outDegree+u.directedSelfLoops},d.directedDegree=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.directedDegree: could not find the "'.concat(s,'" node in the graph.'));if(this.type==="undirected")return 0;var f=u.directedSelfLoops;return u.inDegree+f+(u.outDegree+f)},d.undirectedDegree=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.undirectedDegree: could not find the "'.concat(s,'" node in the graph.'));if(this.type==="directed")return 0;var f=u.undirectedSelfLoops;return u.undirectedDegree+2*f},d.degree=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.degree: could not find the "'.concat(s,'" node in the graph.'));var f=0;return this.type!=="directed"&&(f+=u.undirectedDegree+2*u.undirectedSelfLoops),this.type!=="undirected"&&(f+=u.inDegree+u.outDegree+2*u.directedSelfLoops),f},d.inDegreeWithoutSelfLoops=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.inDegreeWithoutSelfLoops: could not find the "'.concat(s,'" node in the graph.'));return this.type==="undirected"?0:u.inDegree},d.outDegreeWithoutSelfLoops=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.outDegreeWithoutSelfLoops: could not find the "'.concat(s,'" node in the graph.'));return this.type==="undirected"?0:u.outDegree},d.directedDegreeWithoutSelfLoops=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.directedDegreeWithoutSelfLoops: could not find the "'.concat(s,'" node in the graph.'));return this.type==="undirected"?0:u.inDegree+u.outDegree},d.undirectedDegreeWithoutSelfLoops=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.undirectedDegreeWithoutSelfLoops: could not find the "'.concat(s,'" node in the graph.'));return this.type==="directed"?0:u.undirectedDegree},d.degreeWithoutSelfLoops=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.degreeWithoutSelfLoops: could not find the "'.concat(s,'" node in the graph.'));var f=0;return this.type!=="directed"&&(f+=u.undirectedDegree),this.type!=="undirected"&&(f+=u.inDegree+u.outDegree),f},d.source=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.source: could not find the "'.concat(s,'" edge in the graph.'));return u.source.key},d.target=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.target: could not find the "'.concat(s,'" edge in the graph.'));return u.target.key},d.extremities=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.extremities: could not find the "'.concat(s,'" edge in the graph.'));return[u.source.key,u.target.key]},d.opposite=function(s,u){s=""+s,u=""+u;var f=this._edges.get(u);if(!f)throw new x('Graph.opposite: could not find the "'.concat(u,'" edge in the graph.'));var v=f.source.key,b=f.target.key;if(s===v)return b;if(s===b)return v;throw new x('Graph.opposite: the "'.concat(s,'" node is not attached to the "').concat(u,'" edge (').concat(v,", ").concat(b,")."))},d.hasExtremity=function(s,u){s=""+s,u=""+u;var f=this._edges.get(s);if(!f)throw new x('Graph.hasExtremity: could not find the "'.concat(s,'" edge in the graph.'));return f.source.key===u||f.target.key===u},d.isUndirected=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.isUndirected: could not find the "'.concat(s,'" edge in the graph.'));return u.undirected},d.isDirected=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.isDirected: could not find the "'.concat(s,'" edge in the graph.'));return!u.undirected},d.isSelfLoop=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.isSelfLoop: could not find the "'.concat(s,'" edge in the graph.'));return u.source===u.target},d.addNode=function(s,u){var f=function(v,b,E){if(E&&!y(E))throw new q('Graph.addNode: invalid attributes. Expecting an object but got "'.concat(E,'"'));if(b=""+b,E=E||{},v._nodes.has(b))throw new oe('Graph.addNode: the "'.concat(b,'" node already exist in the graph.'));var F=new v.NodeDataClass(b,E);return v._nodes.set(b,F),v.emit("nodeAdded",{key:b,attributes:E}),F}(this,s,u);return f.key},d.mergeNode=function(s,u){if(u&&!y(u))throw new q('Graph.mergeNode: invalid attributes. Expecting an object but got "'.concat(u,'"'));s=""+s,u=u||{};var f=this._nodes.get(s);return f?(u&&(c(f.attributes,u),this.emit("nodeAttributesUpdated",{type:"merge",key:s,attributes:f.attributes,data:u})),[s,!1]):(f=new this.NodeDataClass(s,u),this._nodes.set(s,f),this.emit("nodeAdded",{key:s,attributes:u}),[s,!0])},d.updateNode=function(s,u){if(u&&typeof u!="function")throw new q('Graph.updateNode: invalid updater function. Expecting a function but got "'.concat(u,'"'));s=""+s;var f=this._nodes.get(s);if(f){if(u){var v=f.attributes;f.attributes=u(v),this.emit("nodeAttributesUpdated",{type:"replace",key:s,attributes:f.attributes})}return[s,!1]}var b=u?u({}):{};return f=new this.NodeDataClass(s,b),this._nodes.set(s,f),this.emit("nodeAdded",{key:s,attributes:b}),[s,!0]},d.dropNode=function(s){var u=this;s=""+s;var f=this._nodes.get(s);if(!f)throw new x('Graph.dropNode: could not find the "'.concat(s,'" node in the graph.'));this.forEachEdge(s,function(v){u.dropEdge(v)}),this._nodes.delete(s),this.emit("nodeDropped",{key:s,attributes:f.attributes})},d.dropEdge=function(s){var u;if(arguments.length>1){var f=""+arguments[0],v=""+arguments[1];if(!(u=p(this,f,v,this.type)))throw new x('Graph.dropEdge: could not find the "'.concat(f,'" -> "').concat(v,'" edge in the graph.'))}else if(s=""+s,!(u=this._edges.get(s)))throw new x('Graph.dropEdge: could not find the "'.concat(s,'" edge in the graph.'));this._edges.delete(u.key);var b=u,E=b.source,F=b.target,N=b.attributes,O=u.undirected;return E===F?O?(E.undirectedSelfLoops--,this._undirectedSelfLoopCount--):(E.directedSelfLoops--,this._directedSelfLoopCount--):O?(E.undirectedDegree--,F.undirectedDegree--):(E.outDegree--,F.inDegree--),we(this,O,u),O?this._undirectedSize--:this._directedSize--,this.emit("edgeDropped",{key:s,attributes:N,source:E.key,target:F.key,undirected:O}),this},d.clear=function(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")},d.clearEdges=function(){(function(s){for(var u,f=s._nodes.values();(u=f.next()).done!==!0;)u.value.clear()})(this),this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")},d.getAttribute=function(s){return this._attributes[s]},d.getAttributes=function(){return this._attributes},d.hasAttribute=function(s){return this._attributes.hasOwnProperty(s)},d.setAttribute=function(s,u){return this._attributes[s]=u,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:s}),this},d.updateAttribute=function(s,u){if(typeof u!="function")throw new q("Graph.updateAttribute: updater should be a function.");var f=this._attributes[s];return this._attributes[s]=u(f),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:s}),this},d.removeAttribute=function(s){return delete this._attributes[s],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:s}),this},d.replaceAttributes=function(s){if(!y(s))throw new q("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=s,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this},d.mergeAttributes=function(s){if(!y(s))throw new q("Graph.mergeAttributes: provided attributes are not a plain object.");return c(this._attributes,s),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:s}),this},d.updateAttributes=function(s){if(typeof s!="function")throw new q("Graph.updateAttributes: provided updater is not a function.");return this._attributes=s(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this},d.updateEachNodeAttributes=function(s,u){if(typeof s!="function")throw new q("Graph.updateEachNodeAttributes: expecting an updater function.");if(u&&!S(u))throw new q("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");for(var f,v,b=this._nodes.values();(f=b.next()).done!==!0;)(v=f.value).attributes=s(v.key,v.attributes);this.emit("eachNodeAttributesUpdated",{hints:u||null})},d.updateEachEdgeAttributes=function(s,u){if(typeof s!="function")throw new q("Graph.updateEachEdgeAttributes: expecting an updater function.");if(u&&!S(u))throw new q("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");for(var f,v,b,E,F=this._edges.values();(f=F.next()).done!==!0;)b=(v=f.value).source,E=v.target,v.attributes=s(v.key,v.attributes,b.key,E.key,b.attributes,E.attributes,v.undirected);this.emit("eachEdgeAttributesUpdated",{hints:u||null})},d.forEachAdjacencyEntry=function(s){if(typeof s!="function")throw new q("Graph.forEachAdjacencyEntry: expecting a callback.");this.multi?_n(!1,!1,!1,this,s):En(!1,!1,!1,this,s)},d.forEachAdjacencyEntryWithOrphans=function(s){if(typeof s!="function")throw new q("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");this.multi?_n(!1,!1,!0,this,s):En(!1,!1,!0,this,s)},d.forEachAssymetricAdjacencyEntry=function(s){if(typeof s!="function")throw new q("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");this.multi?_n(!1,!0,!1,this,s):En(!1,!0,!1,this,s)},d.forEachAssymetricAdjacencyEntryWithOrphans=function(s){if(typeof s!="function")throw new q("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");this.multi?_n(!1,!0,!0,this,s):En(!1,!0,!0,this,s)},d.nodes=function(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):Ie(this._nodes.keys(),this._nodes.size)},d.forEachNode=function(s){if(typeof s!="function")throw new q("Graph.forEachNode: expecting a callback.");for(var u,f,v=this._nodes.values();(u=v.next()).done!==!0;)s((f=u.value).key,f.attributes)},d.findNode=function(s){if(typeof s!="function")throw new q("Graph.findNode: expecting a callback.");for(var u,f,v=this._nodes.values();(u=v.next()).done!==!0;)if(s((f=u.value).key,f.attributes))return f.key},d.mapNodes=function(s){if(typeof s!="function")throw new q("Graph.mapNode: expecting a callback.");for(var u,f,v=this._nodes.values(),b=new Array(this.order),E=0;(u=v.next()).done!==!0;)f=u.value,b[E++]=s(f.key,f.attributes);return b},d.someNode=function(s){if(typeof s!="function")throw new q("Graph.someNode: expecting a callback.");for(var u,f,v=this._nodes.values();(u=v.next()).done!==!0;)if(s((f=u.value).key,f.attributes))return!0;return!1},d.everyNode=function(s){if(typeof s!="function")throw new q("Graph.everyNode: expecting a callback.");for(var u,f,v=this._nodes.values();(u=v.next()).done!==!0;)if(!s((f=u.value).key,f.attributes))return!1;return!0},d.filterNodes=function(s){if(typeof s!="function")throw new q("Graph.filterNodes: expecting a callback.");for(var u,f,v=this._nodes.values(),b=[];(u=v.next()).done!==!0;)s((f=u.value).key,f.attributes)&&b.push(f.key);return b},d.reduceNodes=function(s,u){if(typeof s!="function")throw new q("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new q("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");for(var f,v,b=u,E=this._nodes.values();(f=E.next()).done!==!0;)b=s(b,(v=f.value).key,v.attributes);return b},d.nodeEntries=function(){var s=this._nodes.values();return new Y(function(){var u=s.next();if(u.done)return u;var f=u.value;return{value:{node:f.key,attributes:f.attributes},done:!1}})},d.exportNode=function(s){s=""+s;var u=this._nodes.get(s);if(!u)throw new x('Graph.exportNode: could not find the "'.concat(s,'" node in the graph.'));return ri(s,u)},d.exportEdge=function(s){s=""+s;var u=this._edges.get(s);if(!u)throw new x('Graph.exportEdge: could not find the "'.concat(s,'" edge in the graph.'));return ii(s,u)},d.export=function(){var s=new Array(this._nodes.size),u=0;this._nodes.forEach(function(v,b){s[u++]=ri(b,v)});var f=new Array(this._edges.size);return u=0,this._edges.forEach(function(v,b){f[u++]=ii(b,v)}),{attributes:this.getAttributes(),nodes:s,edges:f,options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops}}},d.importNode=function(s){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=ys(s);if(f){if(f==="not-object")throw new q('Graph.importNode: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(f==="no-key")throw new q("Graph.importNode: no key provided.");if(f==="invalid-attributes")throw new q("Graph.importNode: invalid attributes. Attributes should be a plain object, null or omitted.")}var v=s.key,b=s.attributes,E=b===void 0?{}:b;return u?this.mergeNode(v,E):this.addNode(v,E),this},d.importEdge=function(s){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=bs(s);if(f){if(f==="not-object")throw new q('Graph.importEdge: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(f==="no-source")throw new q("Graph.importEdge: missing souce.");if(f==="no-target")throw new q("Graph.importEdge: missing target.");if(f==="invalid-attributes")throw new q("Graph.importEdge: invalid attributes. Attributes should be a plain object, null or omitted.");if(f==="invalid-undirected")throw new q("Graph.importEdge: invalid undirected. Undirected should be boolean or omitted.")}var v=s.source,b=s.target,E=s.attributes,F=E===void 0?{}:E,N=s.undirected,O=N!==void 0&&N;return"key"in s?(u?O?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:O?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey).call(this,s.key,v,b,F):(u?O?this.mergeUndirectedEdge:this.mergeDirectedEdge:O?this.addUndirectedEdge:this.addDirectedEdge).call(this,v,b,F),this},d.import=function(s){var u,f,v,b=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(m(s))return this.import(s.export(),b),this;if(!y(s))throw new q("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(s.attributes){if(!y(s.attributes))throw new q("Graph.import: invalid attributes. Expecting a plain object.");b?this.mergeAttributes(s.attributes):this.replaceAttributes(s.attributes)}if(s.nodes){if(v=s.nodes,!Array.isArray(v))throw new q("Graph.import: invalid nodes. Expecting an array.");for(u=0,f=v.length;u<f;u++)this.importNode(v[u],b)}if(s.edges){if(v=s.edges,!Array.isArray(v))throw new q("Graph.import: invalid edges. Expecting an array.");for(u=0,f=v.length;u<f;u++)this.importEdge(v[u],b)}return this},d.nullCopy=function(s){var u=new g(c({},this._options,s));return u.replaceAttributes(c({},this.getAttributes())),u},d.emptyCopy=function(s){var u=this.nullCopy(s);return this._nodes.forEach(function(f,v){var b=c({},f.attributes);f=new u.NodeDataClass(v,b),u._nodes.set(v,f)}),u},d.copy=function(){for(var s,u,f=this.emptyCopy(),v=this._edges.values();(s=v.next()).done!==!0;)ui(f,"copy",!1,(u=s.value).undirected,u.key,u.source.key,u.target.key,c({},u.attributes));return f},d.upgradeToMixed=function(){return this.type==="mixed"||(this._nodes.forEach(function(s){return s.upgradeToMixed()}),this._options.type="mixed",C(this,"type",this._options.type),_(this,"NodeDataClass",Me)),this},d.upgradeToMulti=function(){return this.multi||(this._options.multi=!0,C(this,"multi",!0),(s=this)._nodes.forEach(function(u,f){if(u.out)for(var v in u.out){var b=new Set;b.add(u.out[v]),u.out[v]=b,s._nodes.get(v).in[f]=b}if(u.undirected){for(var E in u.undirected)if(!(E>f)){var F=new Set;F.add(u.undirected[E]),u.undirected[E]=F,s._nodes.get(E).undirected[f]=F}}})),this;var s},d.toJSON=function(){return this.export()},d.toString=function(){return"[object Graph]"},d.inspect=function(){var s=this,u={};this._nodes.forEach(function(F,N){u[N]=F.attributes});var f={},v={};this._edges.forEach(function(F,N){var O,V=F.undirected?"--":"->",$="",Z=F.source.key,ue=F.target.key;F.undirected&&Z>ue&&(O=Z,Z=ue,ue=O);var ae="(".concat(Z,")").concat(V,"(").concat(ue,")");N.startsWith("geid_")?s.multi&&(v[ae]===void 0?v[ae]=0:v[ae]++,$+="".concat(v[ae],". ")):$+="[".concat(N,"]: "),f[$+=ae]=F.attributes});var b={};for(var E in this)this.hasOwnProperty(E)&&!ai.has(E)&&typeof this[E]!="function"&&r(E)!=="symbol"&&(b[E]=this[E]);return b.attributes=this._attributes,b.nodes=u,b.edges=f,_(b,"constructor",this.constructor),b},g}(U.exports.EventEmitter);typeof Symbol<"u"&&(Ee.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ee.prototype.inspect),[{name:function(l){return"".concat(l,"Edge")},generateKey:!0},{name:function(l){return"".concat(l,"DirectedEdge")},generateKey:!0,type:"directed"},{name:function(l){return"".concat(l,"UndirectedEdge")},generateKey:!0,type:"undirected"},{name:function(l){return"".concat(l,"EdgeWithKey")}},{name:function(l){return"".concat(l,"DirectedEdgeWithKey")},type:"directed"},{name:function(l){return"".concat(l,"UndirectedEdgeWithKey")},type:"undirected"}].forEach(function(l){["add","merge","update"].forEach(function(g){var d=l.name(g),s=g==="add"?ui:Ss;l.generateKey?Ee.prototype[d]=function(u,f,v){return s(this,d,!0,(l.type||this.type)==="undirected",null,u,f,v,g==="update")}:Ee.prototype[d]=function(u,f,v,b){return s(this,d,!1,(l.type||this.type)==="undirected",u,f,v,b,g==="update")}})}),function(l){le.forEach(function(g){var d=g.name,s=g.attacher;s(l,d("Node"),0),s(l,d("Source"),1),s(l,d("Target"),2),s(l,d("Opposite"),3)})}(Ee),function(l){Qe.forEach(function(g){var d=g.name,s=g.attacher;s(l,d("Edge"),"mixed"),s(l,d("DirectedEdge"),"directed"),s(l,d("UndirectedEdge"),"undirected")})}(Ee),function(l){ht.forEach(function(g){(function(d,s){var u=s.name,f=s.type,v=s.direction;d.prototype[u]=function(b,E){if(f!=="mixed"&&this.type!=="mixed"&&f!==this.type)return[];if(!arguments.length)return ts(this,f);if(arguments.length===1){b=""+b;var F=this._nodes.get(b);if(F===void 0)throw new x("Graph.".concat(u,': could not find the "').concat(b,'" node in the graph.'));return os(this.multi,f==="mixed"?this.type:f,v,F)}if(arguments.length===2){b=""+b,E=""+E;var N=this._nodes.get(b);if(!N)throw new x("Graph.".concat(u,':  could not find the "').concat(b,'" source node in the graph.'));if(!this._nodes.has(E))throw new x("Graph.".concat(u,':  could not find the "').concat(E,'" target node in the graph.'));return hs(f,this.multi,v,N,E)}throw new q("Graph.".concat(u,": too many arguments (expecting 0, 1 or 2 and got ").concat(arguments.length,")."))}})(l,g),function(d,s){var u=s.name,f=s.type,v=s.direction,b="forEach"+u[0].toUpperCase()+u.slice(1,-1);d.prototype[b]=function(O,V,$){if(f==="mixed"||this.type==="mixed"||f===this.type){if(arguments.length===1)return ns(this,f,$=O);if(arguments.length===2){O=""+O,$=V;var Z=this._nodes.get(O);if(Z===void 0)throw new x("Graph.".concat(b,': could not find the "').concat(O,'" node in the graph.'));return as(this.multi,f==="mixed"?this.type:f,v,Z,$)}if(arguments.length===3){O=""+O,V=""+V;var ue=this._nodes.get(O);if(!ue)throw new x("Graph.".concat(b,':  could not find the "').concat(O,'" source node in the graph.'));if(!this._nodes.has(V))throw new x("Graph.".concat(b,':  could not find the "').concat(V,'" target node in the graph.'));return cs(f,this.multi,v,ue,V,$)}throw new q("Graph.".concat(b,": too many arguments (expecting 1, 2 or 3 and got ").concat(arguments.length,")."))}};var E="map"+u[0].toUpperCase()+u.slice(1);d.prototype[E]=function(){var O,V=Array.prototype.slice.call(arguments),$=V.pop();if(V.length===0){var Z=0;f!=="directed"&&(Z+=this.undirectedSize),f!=="undirected"&&(Z+=this.directedSize),O=new Array(Z);var ue=0;V.push(function(ae,xe,Ne,xt,Pt,un,nr){O[ue++]=$(ae,xe,Ne,xt,Pt,un,nr)})}else O=[],V.push(function(ae,xe,Ne,xt,Pt,un,nr){O.push($(ae,xe,Ne,xt,Pt,un,nr))});return this[b].apply(this,V),O};var F="filter"+u[0].toUpperCase()+u.slice(1);d.prototype[F]=function(){var O=Array.prototype.slice.call(arguments),V=O.pop(),$=[];return O.push(function(Z,ue,ae,xe,Ne,xt,Pt){V(Z,ue,ae,xe,Ne,xt,Pt)&&$.push(Z)}),this[b].apply(this,O),$};var N="reduce"+u[0].toUpperCase()+u.slice(1);d.prototype[N]=function(){var O,V,$=Array.prototype.slice.call(arguments);if($.length<2||$.length>4)throw new q("Graph.".concat(N,": invalid number of arguments (expecting 2, 3 or 4 and got ").concat($.length,")."));if(typeof $[$.length-1]=="function"&&typeof $[$.length-2]!="function")throw new q("Graph.".concat(N,": missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array."));$.length===2?(O=$[0],V=$[1],$=[]):$.length===3?(O=$[1],V=$[2],$=[$[0]]):$.length===4&&(O=$[2],V=$[3],$=[$[0],$[1]]);var Z=V;return $.push(function(ue,ae,xe,Ne,xt,Pt,un){Z=O(Z,ue,ae,xe,Ne,xt,Pt,un)}),this[b].apply(this,$),Z}}(l,g),function(d,s){var u=s.name,f=s.type,v=s.direction,b="find"+u[0].toUpperCase()+u.slice(1,-1);d.prototype[b]=function(N,O,V){if(f!=="mixed"&&this.type!=="mixed"&&f!==this.type)return!1;if(arguments.length===1)return rs(this,f,V=N);if(arguments.length===2){N=""+N,V=O;var $=this._nodes.get(N);if($===void 0)throw new x("Graph.".concat(b,': could not find the "').concat(N,'" node in the graph.'));return ss(this.multi,f==="mixed"?this.type:f,v,$,V)}if(arguments.length===3){N=""+N,O=""+O;var Z=this._nodes.get(N);if(!Z)throw new x("Graph.".concat(b,':  could not find the "').concat(N,'" source node in the graph.'));if(!this._nodes.has(O))throw new x("Graph.".concat(b,':  could not find the "').concat(O,'" target node in the graph.'));return ls(f,this.multi,v,Z,O,V)}throw new q("Graph.".concat(b,": too many arguments (expecting 1, 2 or 3 and got ").concat(arguments.length,")."))};var E="some"+u[0].toUpperCase()+u.slice(1,-1);d.prototype[E]=function(){var N=Array.prototype.slice.call(arguments),O=N.pop();return N.push(function(V,$,Z,ue,ae,xe,Ne){return O(V,$,Z,ue,ae,xe,Ne)}),!!this[b].apply(this,N)};var F="every"+u[0].toUpperCase()+u.slice(1,-1);d.prototype[F]=function(){var N=Array.prototype.slice.call(arguments),O=N.pop();return N.push(function(V,$,Z,ue,ae,xe,Ne){return!O(V,$,Z,ue,ae,xe,Ne)}),!this[b].apply(this,N)}}(l,g),function(d,s){var u=s.name,f=s.type,v=s.direction,b=u.slice(0,-1)+"Entries";d.prototype[b]=function(E,F){if(f!=="mixed"&&this.type!=="mixed"&&f!==this.type)return Y.empty();if(!arguments.length)return is(this,f);if(arguments.length===1){E=""+E;var N=this._nodes.get(E);if(!N)throw new x("Graph.".concat(b,': could not find the "').concat(E,'" node in the graph.'));return us(f,v,N)}if(arguments.length===2){E=""+E,F=""+F;var O=this._nodes.get(E);if(!O)throw new x("Graph.".concat(b,':  could not find the "').concat(E,'" source node in the graph.'));if(!this._nodes.has(F))throw new x("Graph.".concat(b,':  could not find the "').concat(F,'" target node in the graph.'));return ds(f,v,O,F)}throw new q("Graph.".concat(b,": too many arguments (expecting 0, 1 or 2 and got ").concat(arguments.length,")."))}}(l,g)})}(Ee),function(l){fs.forEach(function(g){gs(l,g),ps(l,g),vs(l,g),ms(l,g)})}(Ee);var hi=function(l){function g(d){var s=c({type:"directed"},d);if("multi"in s&&s.multi!==!1)throw new q("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(s.type!=="directed")throw new q('DirectedGraph.from: inconsistent "'+s.type+'" type in given options!');return l.call(this,s)||this}return n(g,l),g}(Ee),ci=function(l){function g(d){var s=c({type:"undirected"},d);if("multi"in s&&s.multi!==!1)throw new q("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(s.type!=="undirected")throw new q('UndirectedGraph.from: inconsistent "'+s.type+'" type in given options!');return l.call(this,s)||this}return n(g,l),g}(Ee),li=function(l){function g(d){var s=c({multi:!0},d);if("multi"in s&&s.multi!==!0)throw new q("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");return l.call(this,s)||this}return n(g,l),g}(Ee),di=function(l){function g(d){var s=c({type:"directed",multi:!0},d);if("multi"in s&&s.multi!==!0)throw new q("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(s.type!=="directed")throw new q('MultiDirectedGraph.from: inconsistent "'+s.type+'" type in given options!');return l.call(this,s)||this}return n(g,l),g}(Ee),fi=function(l){function g(d){var s=c({type:"undirected",multi:!0},d);if("multi"in s&&s.multi!==!0)throw new q("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(s.type!=="undirected")throw new q('MultiUndirectedGraph.from: inconsistent "'+s.type+'" type in given options!');return l.call(this,s)||this}return n(g,l),g}(Ee);function Vt(l){l.from=function(g,d){var s=c({},g.options,d),u=new l(s);return u.import(g),u}}return Vt(Ee),Vt(hi),Vt(ci),Vt(li),Vt(di),Vt(fi),Ee.Graph=Ee,Ee.DirectedGraph=hi,Ee.UndirectedGraph=ci,Ee.MultiGraph=li,Ee.MultiDirectedGraph=di,Ee.MultiUndirectedGraph=fi,Ee.InvalidArgumentsGraphError=q,Ee.NotFoundGraphError=x,Ee.UsageGraphError=oe,Ee})});var In=ye(Fn=>{function Vu(r){return typeof r!="number"||isNaN(r)?1:r}function qu(r,n){var e={},t=function(a){return typeof a>"u"?n:a};typeof n=="function"&&(t=n);var i=function(a){return t(a[r])},o=function(){return t(void 0)};return typeof r=="string"?(e.fromAttributes=i,e.fromGraph=function(a,h){return i(a.getNodeAttributes(h))},e.fromEntry=function(a,h){return i(h)}):typeof r=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},e.fromGraph=function(a,h){return t(r(h,a.getNodeAttributes(h)))},e.fromEntry=function(a,h){return t(r(a,h))}):(e.fromAttributes=o,e.fromGraph=o,e.fromEntry=o),e}function wo(r,n){var e={},t=function(a){return typeof a>"u"?n:a};typeof n=="function"&&(t=n);var i=function(a){return t(a[r])},o=function(){return t(void 0)};return typeof r=="string"?(e.fromAttributes=i,e.fromGraph=function(a,h){return i(a.getEdgeAttributes(h))},e.fromEntry=function(a,h){return i(h)},e.fromPartialEntry=e.fromEntry,e.fromMinimalEntry=e.fromEntry):typeof r=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},e.fromGraph=function(a,h){var c=a.extremities(h);return t(r(h,a.getEdgeAttributes(h),c[0],c[1],a.getNodeAttributes(c[0]),a.getNodeAttributes(c[1]),a.isUndirected(h)))},e.fromEntry=function(a,h,c,p,m,y,w){return t(r(a,h,c,p,m,y,w))},e.fromPartialEntry=function(a,h,c,p){return t(r(a,h,c,p))},e.fromMinimalEntry=function(a,h){return t(r(a,h))}):(e.fromAttributes=o,e.fromGraph=o,e.fromEntry=o,e.fromMinimalEntry=o),e}Fn.createNodeValueGetter=qu;Fn.createEdgeValueGetter=wo;Fn.createEdgeWeightGetter=function(r){return wo(r,Vu)}});var Ao=ye((Sl,To)=>{var ke=0,Ae=1,de=2,fe=3,gt=4,pt=5,ge=6,Eo=7,On=8,_o=9,$u=0,Yu=1,Xu=2,Pe=0,Ye=1,Be=2,Nt=3,_t=4,Ce=5,He=6,rt=7,it=8,So=3,et=10,Zu=3,Oe=9,Cr=10;To.exports=function(n,e,t){var i,o,a,h,c,p,m,y,w,_,C=e.length,S=t.length,L=n.adjustSizes,U=n.barnesHutTheta*n.barnesHutTheta,z,R,D,G,W,P,M,T=[];for(a=0;a<C;a+=et)e[a+gt]=e[a+de],e[a+pt]=e[a+fe],e[a+de]=0,e[a+fe]=0;if(n.outboundAttractionDistribution){for(z=0,a=0;a<C;a+=et)z+=e[a+ge];z/=C/et}if(n.barnesHutOptimize){var Q=1/0,se=-1/0,te=1/0,me=-1/0,X,ce,pe;for(a=0;a<C;a+=et)Q=Math.min(Q,e[a+ke]),se=Math.max(se,e[a+ke]),te=Math.min(te,e[a+Ae]),me=Math.max(me,e[a+Ae]);var Y=se-Q,A=me-te;for(Y>A?(te-=(Y-A)/2,me=te+Y):(Q-=(A-Y)/2,se=Q+A),T[0+Pe]=-1,T[0+Ye]=(Q+se)/2,T[0+Be]=(te+me)/2,T[0+Nt]=Math.max(se-Q,me-te),T[0+_t]=-1,T[0+Ce]=-1,T[0+He]=0,T[0+rt]=0,T[0+it]=0,i=1,a=0;a<C;a+=et)for(o=0,pe=So;;)if(T[o+Ce]>=0){e[a+ke]<T[o+Ye]?e[a+Ae]<T[o+Be]?X=T[o+Ce]:X=T[o+Ce]+Oe:e[a+Ae]<T[o+Be]?X=T[o+Ce]+Oe*2:X=T[o+Ce]+Oe*3,T[o+rt]=(T[o+rt]*T[o+He]+e[a+ke]*e[a+ge])/(T[o+He]+e[a+ge]),T[o+it]=(T[o+it]*T[o+He]+e[a+Ae]*e[a+ge])/(T[o+He]+e[a+ge]),T[o+He]+=e[a+ge],o=X;continue}else if(T[o+Pe]<0){T[o+Pe]=a;break}else{if(T[o+Ce]=i*Oe,y=T[o+Nt]/2,w=T[o+Ce],T[w+Pe]=-1,T[w+Ye]=T[o+Ye]-y,T[w+Be]=T[o+Be]-y,T[w+Nt]=y,T[w+_t]=w+Oe,T[w+Ce]=-1,T[w+He]=0,T[w+rt]=0,T[w+it]=0,w+=Oe,T[w+Pe]=-1,T[w+Ye]=T[o+Ye]-y,T[w+Be]=T[o+Be]+y,T[w+Nt]=y,T[w+_t]=w+Oe,T[w+Ce]=-1,T[w+He]=0,T[w+rt]=0,T[w+it]=0,w+=Oe,T[w+Pe]=-1,T[w+Ye]=T[o+Ye]+y,T[w+Be]=T[o+Be]-y,T[w+Nt]=y,T[w+_t]=w+Oe,T[w+Ce]=-1,T[w+He]=0,T[w+rt]=0,T[w+it]=0,w+=Oe,T[w+Pe]=-1,T[w+Ye]=T[o+Ye]+y,T[w+Be]=T[o+Be]+y,T[w+Nt]=y,T[w+_t]=T[o+_t],T[w+Ce]=-1,T[w+He]=0,T[w+rt]=0,T[w+it]=0,i+=4,e[T[o+Pe]+ke]<T[o+Ye]?e[T[o+Pe]+Ae]<T[o+Be]?X=T[o+Ce]:X=T[o+Ce]+Oe:e[T[o+Pe]+Ae]<T[o+Be]?X=T[o+Ce]+Oe*2:X=T[o+Ce]+Oe*3,T[o+He]=e[T[o+Pe]+ge],T[o+rt]=e[T[o+Pe]+ke],T[o+it]=e[T[o+Pe]+Ae],T[X+Pe]=T[o+Pe],T[o+Pe]=-1,e[a+ke]<T[o+Ye]?e[a+Ae]<T[o+Be]?ce=T[o+Ce]:ce=T[o+Ce]+Oe:e[a+Ae]<T[o+Be]?ce=T[o+Ce]+Oe*2:ce=T[o+Ce]+Oe*3,X===ce)if(pe--){o=X;continue}else{pe=So;break}T[ce+Pe]=a;break}}if(n.barnesHutOptimize)for(R=n.scalingRatio,a=0;a<C;a+=et)for(o=0;;)if(T[o+Ce]>=0)if(P=Math.pow(e[a+ke]-T[o+rt],2)+Math.pow(e[a+Ae]-T[o+it],2),_=T[o+Nt],4*_*_/P<U){if(D=e[a+ke]-T[o+rt],G=e[a+Ae]-T[o+it],L===!0?P>0?(M=R*e[a+ge]*T[o+He]/P,e[a+de]+=D*M,e[a+fe]+=G*M):P<0&&(M=-R*e[a+ge]*T[o+He]/Math.sqrt(P),e[a+de]+=D*M,e[a+fe]+=G*M):P>0&&(M=R*e[a+ge]*T[o+He]/P,e[a+de]+=D*M,e[a+fe]+=G*M),o=T[o+_t],o<0)break;continue}else{o=T[o+Ce];continue}else{if(p=T[o+Pe],p>=0&&p!==a&&(D=e[a+ke]-e[p+ke],G=e[a+Ae]-e[p+Ae],P=D*D+G*G,L===!0?P>0?(M=R*e[a+ge]*e[p+ge]/P,e[a+de]+=D*M,e[a+fe]+=G*M):P<0&&(M=-R*e[a+ge]*e[p+ge]/Math.sqrt(P),e[a+de]+=D*M,e[a+fe]+=G*M):P>0&&(M=R*e[a+ge]*e[p+ge]/P,e[a+de]+=D*M,e[a+fe]+=G*M)),o=T[o+_t],o<0)break;continue}else for(R=n.scalingRatio,h=0;h<C;h+=et)for(c=0;c<h;c+=et)D=e[h+ke]-e[c+ke],G=e[h+Ae]-e[c+Ae],L===!0?(P=Math.sqrt(D*D+G*G)-e[h+On]-e[c+On],P>0?(M=R*e[h+ge]*e[c+ge]/P/P,e[h+de]+=D*M,e[h+fe]+=G*M,e[c+de]-=D*M,e[c+fe]-=G*M):P<0&&(M=100*R*e[h+ge]*e[c+ge],e[h+de]+=D*M,e[h+fe]+=G*M,e[c+de]-=D*M,e[c+fe]-=G*M)):(P=Math.sqrt(D*D+G*G),P>0&&(M=R*e[h+ge]*e[c+ge]/P/P,e[h+de]+=D*M,e[h+fe]+=G*M,e[c+de]-=D*M,e[c+fe]-=G*M));for(w=n.gravity/n.scalingRatio,R=n.scalingRatio,a=0;a<C;a+=et)M=0,D=e[a+ke],G=e[a+Ae],P=Math.sqrt(Math.pow(D,2)+Math.pow(G,2)),n.strongGravityMode?P>0&&(M=R*e[a+ge]*w):P>0&&(M=R*e[a+ge]*w/P),e[a+de]-=D*M,e[a+fe]-=G*M;for(R=1*(n.outboundAttractionDistribution?z:1),m=0;m<S;m+=Zu)h=t[m+$u],c=t[m+Yu],y=t[m+Xu],W=Math.pow(y,n.edgeWeightInfluence),D=e[h+ke]-e[c+ke],G=e[h+Ae]-e[c+Ae],L===!0?(P=Math.sqrt(D*D+G*G)-e[h+On]-e[c+On],n.linLogMode?n.outboundAttractionDistribution?P>0&&(M=-R*W*Math.log(1+P)/P/e[h+ge]):P>0&&(M=-R*W*Math.log(1+P)/P):n.outboundAttractionDistribution?P>0&&(M=-R*W/e[h+ge]):P>0&&(M=-R*W)):(P=Math.sqrt(Math.pow(D,2)+Math.pow(G,2)),n.linLogMode?n.outboundAttractionDistribution?P>0&&(M=-R*W*Math.log(1+P)/P/e[h+ge]):P>0&&(M=-R*W*Math.log(1+P)/P):n.outboundAttractionDistribution?(P=1,M=-R*W/e[h+ge]):(P=1,M=-R*W)),P>0&&(e[h+de]+=D*M,e[h+fe]+=G*M,e[c+de]-=D*M,e[c+fe]-=G*M);var Te,be,j,k,ne,he;if(L===!0)for(a=0;a<C;a+=et)e[a+_o]!==1&&(Te=Math.sqrt(Math.pow(e[a+de],2)+Math.pow(e[a+fe],2)),Te>Cr&&(e[a+de]=e[a+de]*Cr/Te,e[a+fe]=e[a+fe]*Cr/Te),be=e[a+ge]*Math.sqrt((e[a+gt]-e[a+de])*(e[a+gt]-e[a+de])+(e[a+pt]-e[a+fe])*(e[a+pt]-e[a+fe])),j=Math.sqrt((e[a+gt]+e[a+de])*(e[a+gt]+e[a+de])+(e[a+pt]+e[a+fe])*(e[a+pt]+e[a+fe]))/2,k=.1*Math.log(1+j)/(1+Math.sqrt(be)),ne=e[a+ke]+e[a+de]*(k/n.slowDown),e[a+ke]=ne,he=e[a+Ae]+e[a+fe]*(k/n.slowDown),e[a+Ae]=he);else for(a=0;a<C;a+=et)e[a+_o]!==1&&(be=e[a+ge]*Math.sqrt((e[a+gt]-e[a+de])*(e[a+gt]-e[a+de])+(e[a+pt]-e[a+fe])*(e[a+pt]-e[a+fe])),j=Math.sqrt((e[a+gt]+e[a+de])*(e[a+gt]+e[a+de])+(e[a+pt]+e[a+fe])*(e[a+pt]+e[a+fe]))/2,k=e[a+Eo]*Math.log(1+j)/(1+Math.sqrt(be)),e[a+Eo]=Math.min(1,Math.sqrt(k*(Math.pow(e[a+de],2)+Math.pow(e[a+fe],2))/(1+Math.sqrt(be)))),ne=e[a+ke]+e[a+de]*(k/n.slowDown),e[a+ke]=ne,he=e[a+Ae]+e[a+fe]*(k/n.slowDown),e[a+Ae]=he);return{}}});var Rr=ye(St=>{var gn=10,Co=3;St.assign=function(r){r=r||{};var n=Array.prototype.slice.call(arguments).slice(1),e,t,i;for(e=0,i=n.length;e<i;e++)if(n[e])for(t in n[e])r[t]=n[e][t];return r};St.validateSettings=function(r){return"linLogMode"in r&&typeof r.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in r&&typeof r.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in r&&typeof r.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in r&&typeof r.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in r&&!(typeof r.scalingRatio=="number"&&r.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in r&&typeof r.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in r&&!(typeof r.gravity=="number"&&r.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in r&&!(typeof r.slowDown=="number"||r.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in r&&typeof r.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in r&&!(typeof r.barnesHutTheta=="number"&&r.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null};St.graphToByteArrays=function(r,n){var e=r.order,t=r.size,i={},o,a=new Float32Array(e*gn),h=new Float32Array(t*Co);return o=0,r.forEachNode(function(c,p){i[c]=o,a[o]=p.x,a[o+1]=p.y,a[o+2]=0,a[o+3]=0,a[o+4]=0,a[o+5]=0,a[o+6]=1,a[o+7]=1,a[o+8]=p.size||1,a[o+9]=p.fixed?1:0,o+=gn}),o=0,r.forEachEdge(function(c,p,m,y,w,_,C){var S=i[m],L=i[y],U=n(c,p,m,y,w,_,C);a[S+6]+=U,a[L+6]+=U,h[o]=S,h[o+1]=L,h[o+2]=U,o+=Co}),{nodes:a,edges:h}};St.assignLayoutChanges=function(r,n,e){var t=0;r.updateEachNodeAttributes(function(i,o){return o.x=n[t],o.y=n[t+1],t+=gn,e?e(i,o):o})};St.readGraphPositions=function(r,n){var e=0;r.forEachNode(function(t,i){n[e]=i.x,n[e+1]=i.y,e+=gn})};St.collectLayoutChanges=function(r,n,e){for(var t=r.nodes(),i={},o=0,a=0,h=n.length;o<h;o+=gn){if(e){var c=Object.assign({},r.getNodeAttributes(t[a]));c.x=n[o],c.y=n[o+1],c=e(t[a],c),i[t[a]]={x:c.x,y:c.y}}else i[t[a]]={x:n[o],y:n[o+1]};a++}return i};St.createWorker=function(n){var e=window.URL||window.webkitURL,t=n.toString(),i=e.createObjectURL(new Blob(["("+t+").call(this);"],{type:"text/javascript"})),o=new Worker(i);return e.revokeObjectURL(i),o}});var kr=ye((Al,Ro)=>{Ro.exports={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}});var Do=ye((Cl,Lo)=>{var Ku=zt(),Qu=In().createEdgeWeightGetter,Ju=Ao(),pn=Rr(),eh=kr();function ko(r,n,e){if(!Ku(n))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof e=="number"&&(e={iterations:e});var t=e.iterations;if(typeof t!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(t<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var i=Qu("getEdgeWeight"in e?e.getEdgeWeight:"weight").fromEntry,o=typeof e.outputReducer=="function"?e.outputReducer:null,a=pn.assign({},eh,e.settings),h=pn.validateSettings(a);if(h)throw new Error("graphology-layout-forceatlas2: "+h.message);var c=pn.graphToByteArrays(n,i),p;for(p=0;p<t;p++)Ju(a,c.nodes,c.edges);if(r){pn.assignLayoutChanges(n,c.nodes,o);return}return pn.collectLayoutChanges(n,c.nodes)}function th(r){var n=typeof r=="number"?r:r.order;return{barnesHutOptimize:n>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(n)}}var Lr=ko.bind(null,!1);Lr.assign=ko.bind(null,!0);Lr.inferSettings=th;Lo.exports=Lr});var xo=ye((Rl,Go)=>{Go.exports=function(){var n,e,t={};(function(){var o=0,a=1,h=2,c=3,p=4,m=5,y=6,w=7,_=8,C=9,S=0,L=1,U=2,z=0,R=1,D=2,G=3,W=4,P=5,M=6,T=7,Q=8,se=3,te=10,me=3,X=9,ce=10;t.exports=function(Y,A,Te){var be,j,k,ne,he,Ie,tt,q,x,oe,Me=A.length,an=Te.length,ut=Y.adjustSizes,wn=Y.barnesHutTheta*Y.barnesHutTheta,Dt,we,ie,le,Qe,ee,J,I=[];for(k=0;k<Me;k+=te)A[k+p]=A[k+h],A[k+m]=A[k+c],A[k+h]=0,A[k+c]=0;if(Y.outboundAttractionDistribution){for(Dt=0,k=0;k<Me;k+=te)Dt+=A[k+y];Dt/=Me/te}if(Y.barnesHutOptimize){var ht=1/0,vt=-1/0,ct=1/0,mt=-1/0,je,yt,sn;for(k=0;k<Me;k+=te)ht=Math.min(ht,A[k+o]),vt=Math.max(vt,A[k+o]),ct=Math.min(ct,A[k+a]),mt=Math.max(mt,A[k+a]);var bt=vt-ht,Bt=mt-ct;for(bt>Bt?(ct-=(bt-Bt)/2,mt=ct+bt):(ht-=(Bt-bt)/2,vt=ht+Bt),I[0+z]=-1,I[0+R]=(ht+vt)/2,I[0+D]=(ct+mt)/2,I[0+G]=Math.max(vt-ht,mt-ct),I[0+W]=-1,I[0+P]=-1,I[0+M]=0,I[0+T]=0,I[0+Q]=0,be=1,k=0;k<Me;k+=te)for(j=0,sn=se;;)if(I[j+P]>=0){A[k+o]<I[j+R]?A[k+a]<I[j+D]?je=I[j+P]:je=I[j+P]+X:A[k+a]<I[j+D]?je=I[j+P]+X*2:je=I[j+P]+X*3,I[j+T]=(I[j+T]*I[j+M]+A[k+o]*A[k+y])/(I[j+M]+A[k+y]),I[j+Q]=(I[j+Q]*I[j+M]+A[k+a]*A[k+y])/(I[j+M]+A[k+y]),I[j+M]+=A[k+y],j=je;continue}else if(I[j+z]<0){I[j+z]=k;break}else{if(I[j+P]=be*X,q=I[j+G]/2,x=I[j+P],I[x+z]=-1,I[x+R]=I[j+R]-q,I[x+D]=I[j+D]-q,I[x+G]=q,I[x+W]=x+X,I[x+P]=-1,I[x+M]=0,I[x+T]=0,I[x+Q]=0,x+=X,I[x+z]=-1,I[x+R]=I[j+R]-q,I[x+D]=I[j+D]+q,I[x+G]=q,I[x+W]=x+X,I[x+P]=-1,I[x+M]=0,I[x+T]=0,I[x+Q]=0,x+=X,I[x+z]=-1,I[x+R]=I[j+R]+q,I[x+D]=I[j+D]-q,I[x+G]=q,I[x+W]=x+X,I[x+P]=-1,I[x+M]=0,I[x+T]=0,I[x+Q]=0,x+=X,I[x+z]=-1,I[x+R]=I[j+R]+q,I[x+D]=I[j+D]+q,I[x+G]=q,I[x+W]=I[j+W],I[x+P]=-1,I[x+M]=0,I[x+T]=0,I[x+Q]=0,be+=4,A[I[j+z]+o]<I[j+R]?A[I[j+z]+a]<I[j+D]?je=I[j+P]:je=I[j+P]+X:A[I[j+z]+a]<I[j+D]?je=I[j+P]+X*2:je=I[j+P]+X*3,I[j+M]=A[I[j+z]+y],I[j+T]=A[I[j+z]+o],I[j+Q]=A[I[j+z]+a],I[je+z]=I[j+z],I[j+z]=-1,A[k+o]<I[j+R]?A[k+a]<I[j+D]?yt=I[j+P]:yt=I[j+P]+X:A[k+a]<I[j+D]?yt=I[j+P]+X*2:yt=I[j+P]+X*3,je===yt)if(sn--){j=je;continue}else{sn=se;break}I[yt+z]=k;break}}if(Y.barnesHutOptimize)for(we=Y.scalingRatio,k=0;k<Me;k+=te)for(j=0;;)if(I[j+P]>=0)if(ee=Math.pow(A[k+o]-I[j+T],2)+Math.pow(A[k+a]-I[j+Q],2),oe=I[j+G],4*oe*oe/ee<wn){if(ie=A[k+o]-I[j+T],le=A[k+a]-I[j+Q],ut===!0?ee>0?(J=we*A[k+y]*I[j+M]/ee,A[k+h]+=ie*J,A[k+c]+=le*J):ee<0&&(J=-we*A[k+y]*I[j+M]/Math.sqrt(ee),A[k+h]+=ie*J,A[k+c]+=le*J):ee>0&&(J=we*A[k+y]*I[j+M]/ee,A[k+h]+=ie*J,A[k+c]+=le*J),j=I[j+W],j<0)break;continue}else{j=I[j+P];continue}else{if(Ie=I[j+z],Ie>=0&&Ie!==k&&(ie=A[k+o]-A[Ie+o],le=A[k+a]-A[Ie+a],ee=ie*ie+le*le,ut===!0?ee>0?(J=we*A[k+y]*A[Ie+y]/ee,A[k+h]+=ie*J,A[k+c]+=le*J):ee<0&&(J=-we*A[k+y]*A[Ie+y]/Math.sqrt(ee),A[k+h]+=ie*J,A[k+c]+=le*J):ee>0&&(J=we*A[k+y]*A[Ie+y]/ee,A[k+h]+=ie*J,A[k+c]+=le*J)),j=I[j+W],j<0)break;continue}else for(we=Y.scalingRatio,ne=0;ne<Me;ne+=te)for(he=0;he<ne;he+=te)ie=A[ne+o]-A[he+o],le=A[ne+a]-A[he+a],ut===!0?(ee=Math.sqrt(ie*ie+le*le)-A[ne+_]-A[he+_],ee>0?(J=we*A[ne+y]*A[he+y]/ee/ee,A[ne+h]+=ie*J,A[ne+c]+=le*J,A[he+h]-=ie*J,A[he+c]-=le*J):ee<0&&(J=100*we*A[ne+y]*A[he+y],A[ne+h]+=ie*J,A[ne+c]+=le*J,A[he+h]-=ie*J,A[he+c]-=le*J)):(ee=Math.sqrt(ie*ie+le*le),ee>0&&(J=we*A[ne+y]*A[he+y]/ee/ee,A[ne+h]+=ie*J,A[ne+c]+=le*J,A[he+h]-=ie*J,A[he+c]-=le*J));for(x=Y.gravity/Y.scalingRatio,we=Y.scalingRatio,k=0;k<Me;k+=te)J=0,ie=A[k+o],le=A[k+a],ee=Math.sqrt(Math.pow(ie,2)+Math.pow(le,2)),Y.strongGravityMode?ee>0&&(J=we*A[k+y]*x):ee>0&&(J=we*A[k+y]*x/ee),A[k+h]-=ie*J,A[k+c]-=le*J;for(we=1*(Y.outboundAttractionDistribution?Dt:1),tt=0;tt<an;tt+=me)ne=Te[tt+S],he=Te[tt+L],q=Te[tt+U],Qe=Math.pow(q,Y.edgeWeightInfluence),ie=A[ne+o]-A[he+o],le=A[ne+a]-A[he+a],ut===!0?(ee=Math.sqrt(ie*ie+le*le)-A[ne+_]-A[he+_],Y.linLogMode?Y.outboundAttractionDistribution?ee>0&&(J=-we*Qe*Math.log(1+ee)/ee/A[ne+y]):ee>0&&(J=-we*Qe*Math.log(1+ee)/ee):Y.outboundAttractionDistribution?ee>0&&(J=-we*Qe/A[ne+y]):ee>0&&(J=-we*Qe)):(ee=Math.sqrt(Math.pow(ie,2)+Math.pow(le,2)),Y.linLogMode?Y.outboundAttractionDistribution?ee>0&&(J=-we*Qe*Math.log(1+ee)/ee/A[ne+y]):ee>0&&(J=-we*Qe*Math.log(1+ee)/ee):Y.outboundAttractionDistribution?(ee=1,J=-we*Qe/A[ne+y]):(ee=1,J=-we*Qe)),ee>0&&(A[ne+h]+=ie*J,A[ne+c]+=le*J,A[he+h]-=ie*J,A[he+c]-=le*J);var Mt,Gt,jt,lt,Ht,wt;if(ut===!0)for(k=0;k<Me;k+=te)A[k+C]!==1&&(Mt=Math.sqrt(Math.pow(A[k+h],2)+Math.pow(A[k+c],2)),Mt>ce&&(A[k+h]=A[k+h]*ce/Mt,A[k+c]=A[k+c]*ce/Mt),Gt=A[k+y]*Math.sqrt((A[k+p]-A[k+h])*(A[k+p]-A[k+h])+(A[k+m]-A[k+c])*(A[k+m]-A[k+c])),jt=Math.sqrt((A[k+p]+A[k+h])*(A[k+p]+A[k+h])+(A[k+m]+A[k+c])*(A[k+m]+A[k+c]))/2,lt=.1*Math.log(1+jt)/(1+Math.sqrt(Gt)),Ht=A[k+o]+A[k+h]*(lt/Y.slowDown),A[k+o]=Ht,wt=A[k+a]+A[k+c]*(lt/Y.slowDown),A[k+a]=wt);else for(k=0;k<Me;k+=te)A[k+C]!==1&&(Gt=A[k+y]*Math.sqrt((A[k+p]-A[k+h])*(A[k+p]-A[k+h])+(A[k+m]-A[k+c])*(A[k+m]-A[k+c])),jt=Math.sqrt((A[k+p]+A[k+h])*(A[k+p]+A[k+h])+(A[k+m]+A[k+c])*(A[k+m]+A[k+c]))/2,lt=A[k+w]*Math.log(1+jt)/(1+Math.sqrt(Gt)),A[k+w]=Math.min(1,Math.sqrt(lt*(Math.pow(A[k+h],2)+Math.pow(A[k+c],2))/(1+Math.sqrt(Gt)))),Ht=A[k+o]+A[k+h]*(lt/Y.slowDown),A[k+o]=Ht,wt=A[k+a]+A[k+c]*(lt/Y.slowDown),A[k+a]=wt);return{}}})();var i=t.exports;self.addEventListener("message",function(o){var a=o.data;n=new Float32Array(a.nodes),a.edges&&(e=new Float32Array(a.edges)),i(a.settings,n,e),self.postMessage({nodes:n.buffer},[n.buffer])})}});var Fo=ye((kl,Po)=>{var nh=xo(),rh=zt(),ih=In().createEdgeWeightGetter,Kt=Rr(),oh=kr();function Tt(r,n){if(n=n||{},!rh(r))throw new Error("graphology-layout-forceatlas2/worker: the given graph is not a valid graphology instance.");var e=ih("getEdgeWeight"in n?n.getEdgeWeight:"weight").fromEntry,t=Kt.assign({},oh,n.settings),i=Kt.validateSettings(t);if(i)throw new Error("graphology-layout-forceatlas2/worker: "+i.message);this.worker=null,this.graph=r,this.settings=t,this.getEdgeWeight=e,this.matrices=null,this.running=!1,this.killed=!1,this.outputReducer=typeof n.outputReducer=="function"?n.outputReducer:null,this.handleMessage=this.handleMessage.bind(this);var o=void 0,a=this;this.handleGraphUpdate=function(){a.worker&&a.worker.terminate(),o&&clearTimeout(o),o=setTimeout(function(){o=void 0,a.spawnWorker()},0)},r.on("nodeAdded",this.handleGraphUpdate),r.on("edgeAdded",this.handleGraphUpdate),r.on("nodeDropped",this.handleGraphUpdate),r.on("edgeDropped",this.handleGraphUpdate),this.spawnWorker()}Tt.prototype.isRunning=function(){return this.running};Tt.prototype.spawnWorker=function(){this.worker&&this.worker.terminate(),this.worker=Kt.createWorker(nh),this.worker.addEventListener("message",this.handleMessage),this.running&&(this.running=!1,this.start())};Tt.prototype.handleMessage=function(r){if(this.running){var n=new Float32Array(r.data.nodes);Kt.assignLayoutChanges(this.graph,n,this.outputReducer),this.outputReducer&&Kt.readGraphPositions(this.graph,n),this.matrices.nodes=n,this.askForIterations()}};Tt.prototype.askForIterations=function(r){var n=this.matrices,e={settings:this.settings,nodes:n.nodes.buffer},t=[n.nodes.buffer];return r&&(e.edges=n.edges.buffer,t.push(n.edges.buffer)),this.worker.postMessage(e,t),this};Tt.prototype.start=function(){if(this.killed)throw new Error("graphology-layout-forceatlas2/worker.start: layout was killed.");return this.running?this:(this.matrices=Kt.graphToByteArrays(this.graph,this.getEdgeWeight),this.running=!0,this.askForIterations(!0),this)};Tt.prototype.stop=function(){return this.running=!1,this};Tt.prototype.kill=function(){if(this.killed)return this;this.running=!1,this.killed=!0,this.matrices=null,this.worker.terminate(),this.graph.removeListener("nodeAdded",this.handleGraphUpdate),this.graph.removeListener("edgeAdded",this.handleGraphUpdate),this.graph.removeListener("nodeDropped",this.handleGraphUpdate),this.graph.removeListener("edgeDropped",this.handleGraphUpdate)};Po.exports=Tt});var Dr=ye((Ll,Oo)=>{function ah(r){return!r||typeof r!="object"||typeof r=="function"||Array.isArray(r)||r instanceof Set||r instanceof Map||r instanceof RegExp||r instanceof Date}function Io(r,n){r=r||{};var e={};for(var t in n){var i=r[t],o=n[t];if(!ah(o)){e[t]=Io(i,o);continue}i===void 0?e[t]=o:e[t]=i}return e}Oo.exports=Io});var No=ye((Dl,zo)=>{var sh=zt();zo.exports=function(n){if(!sh(n))throw new Error("graphology-utils/infer-type: expecting a valid graphology instance.");var e=n.type;return e!=="mixed"?e:n.directedSize===0&&n.undirectedSize===0||n.directedSize>0&&n.undirectedSize>0?"mixed":n.directedSize>0?"directed":"undirected"}});var Gr=ye((Gl,Uo)=>{function ot(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol<"u"&&(ot.prototype[Symbol.iterator]=function(){return this});ot.of=function(){var r=arguments,n=r.length,e=0;return new ot(function(){return e>=n?{done:!0}:{done:!1,value:r[e++]}})};ot.empty=function(){var r=new ot(function(){return{done:!0}});return r};ot.fromSequence=function(r){var n=0,e=r.length;return new ot(function(){return n>=e?{done:!0}:{done:!1,value:r[n++]}})};ot.is=function(r){return r instanceof ot?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};Uo.exports=ot});var zn=ye(at=>{var uh=Math.pow(2,8)-1,hh=Math.pow(2,16)-1,ch=Math.pow(2,32)-1,lh=Math.pow(2,7)-1,dh=Math.pow(2,15)-1,fh=Math.pow(2,31)-1;at.getPointerArray=function(r){var n=r-1;if(n<=uh)return Uint8Array;if(n<=hh)return Uint16Array;if(n<=ch)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};at.getSignedPointerArray=function(r){var n=r-1;return n<=lh?Int8Array:n<=dh?Int16Array:n<=fh?Int32Array:Float64Array};at.getNumberType=function(r){return r===(r|0)?Math.sign(r)===-1?r<=127&&r>=-128?Int8Array:r<=32767&&r>=-32768?Int16Array:Int32Array:r<=255?Uint8Array:r<=65535?Uint16Array:Uint32Array:Float64Array};var gh={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};at.getMinimalRepresentation=function(r,n){var e=null,t=0,i,o,a,h,c;for(h=0,c=r.length;h<c;h++)a=n?n(r[h]):r[h],o=at.getNumberType(a),i=gh[o.name],i>t&&(t=i,e=o);return e};at.isTypedArray=function(r){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(r)};at.concat=function(){var r=0,n,e,t;for(n=0,t=arguments.length;n<t;n++)r+=arguments[n].length;var i=new arguments[0].constructor(r);for(n=0,e=0;n<t;n++)i.set(arguments[n],e),e+=arguments[n].length;return i};at.indices=function(r){for(var n=at.getPointerArray(r),e=new n(r),t=0;t<r;t++)e[t]=t;return e}});var Bo=ye((Pl,Wo)=>{var xr=Gr(),ph=zn().getPointerArray;function ze(r,n){arguments.length<2&&(n=r,r=Array);var e=ph(n);this.size=0,this.length=n,this.dense=new e(n),this.sparse=new e(n),this.vals=new r(n)}ze.prototype.clear=function(){this.size=0};ze.prototype.has=function(r){var n=this.sparse[r];return n<this.size&&this.dense[n]===r};ze.prototype.get=function(r){var n=this.sparse[r];if(n<this.size&&this.dense[n]===r)return this.vals[n]};ze.prototype.set=function(r,n){var e=this.sparse[r];return e<this.size&&this.dense[e]===r?(this.vals[e]=n,this):(this.dense[this.size]=r,this.sparse[r]=this.size,this.vals[this.size]=n,this.size++,this)};ze.prototype.delete=function(r){var n=this.sparse[r];return n>=this.size||this.dense[n]!==r?!1:(n=this.dense[this.size-1],this.dense[this.sparse[r]]=n,this.sparse[n]=this.sparse[r],this.size--,!0)};ze.prototype.forEach=function(r,n){n=arguments.length>1?n:this;for(var e=0;e<this.size;e++)r.call(n,this.vals[e],this.dense[e])};ze.prototype.keys=function(){var r=this.size,n=this.dense,e=0;return new xr(function(){if(e<r){var t=n[e];return e++,{value:t}}return{done:!0}})};ze.prototype.values=function(){var r=this.size,n=this.vals,e=0;return new xr(function(){if(e<r){var t=n[e];return e++,{value:t}}return{done:!0}})};ze.prototype.entries=function(){var r=this.size,n=this.dense,e=this.vals,t=0;return new xr(function(){if(t<r){var i=[n[t],e[t]];return t++,{value:i}}return{done:!0}})};typeof Symbol<"u"&&(ze.prototype[Symbol.iterator]=ze.prototype.entries);ze.prototype.inspect=function(){for(var r=new Map,n=0;n<this.size;n++)r.set(this.dense[n],this.vals[n]);return Object.defineProperty(r,"constructor",{value:ze,enumerable:!1}),r.length=this.length,this.vals.constructor!==Array&&(r.type=this.vals.constructor.name),r};typeof Symbol<"u"&&(ze.prototype[Symbol.for("nodejs.util.inspect.custom")]=ze.prototype.inspect);Wo.exports=ze});var jo=ye((Fl,Mo)=>{var vh=Gr(),mh=zn().getPointerArray;function Ve(r){var n=mh(r);this.start=0,this.size=0,this.capacity=r,this.dense=new n(r),this.sparse=new n(r)}Ve.prototype.clear=function(){this.start=0,this.size=0};Ve.prototype.has=function(r){if(this.size===0)return!1;var n=this.sparse[r],e=n<this.capacity&&n>=this.start&&n<this.start+this.size||n<(this.start+this.size)%this.capacity;return e&&this.dense[n]===r};Ve.prototype.enqueue=function(r){var n=this.sparse[r];if(this.size!==0){var e=n<this.capacity&&n>=this.start&&n<this.start+this.size||n<(this.start+this.size)%this.capacity;if(e&&this.dense[n]===r)return this}return n=(this.start+this.size)%this.capacity,this.dense[n]=r,this.sparse[r]=n,this.size++,this};Ve.prototype.dequeue=function(){if(this.size!==0){var r=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var n=this.dense[r];return this.sparse[n]=this.capacity,n}};Ve.prototype.forEach=function(r,n){n=arguments.length>1?n:this;for(var e=this.capacity,t=this.size,i=this.start,o=0;o<t;)r.call(n,this.dense[i],o,this),i++,o++,i===e&&(i=0)};Ve.prototype.values=function(){var r=this.dense,n=this.capacity,e=this.size,t=this.start,i=0;return new vh(function(){if(i>=e)return{done:!0};var o=r[t];return t++,i++,t===n&&(t=0),{value:o,done:!1}})};typeof Symbol<"u"&&(Ve.prototype[Symbol.iterator]=Ve.prototype.values);Ve.prototype.inspect=function(){var r=[];return this.forEach(function(n){r.push(n)}),Object.defineProperty(r,"constructor",{value:Ve,enumerable:!1}),r.capacity=this.capacity,r};typeof Symbol<"u"&&(Ve.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ve.prototype.inspect);Mo.exports=Ve});var $o=ye((Il,qo)=>{function Ho(r){return function(n){return typeof n!="number"&&(n=n.length),Math.floor(r()*n)}}var Vo=Ho(Math.random);Vo.createRandomIndex=Ho;qo.exports=Vo});var Qo=ye(Pr=>{var At=zn(),Yo=Dr(),Xo=In().createEdgeWeightGetter,Zo=Symbol.for("nodejs.util.inspect.custom"),Ko={getEdgeWeight:"weight",keepDendrogram:!1,resolution:1};function Re(r,n){n=Yo(n,Ko);var e=n.resolution,t=Xo(n.getEdgeWeight).fromEntry,i=(r.size-r.selfLoopCount)*2,o=At.getPointerArray(i),a=At.getPointerArray(r.order+1),h=n.getEdgeWeight?Float64Array:At.getPointerArray(r.size*2);this.C=r.order,this.M=0,this.E=i,this.U=0,this.resolution=e,this.level=0,this.graph=r,this.nodes=new Array(r.order),this.keepDendrogram=n.keepDendrogram,this.neighborhood=new a(i),this.weights=new h(i),this.loops=new h(r.order),this.starts=new o(r.order+1),this.belongings=new a(r.order),this.dendrogram=[],this.mapping=null,this.counts=new a(r.order),this.unused=new a(r.order),this.totalWeights=new h(r.order);var c={},p,m=0,y=0,w=this;r.forEachNode(function(_){w.nodes[m]=_,c[_]=m,y+=r.undirectedDegreeWithoutSelfLoops(_),w.starts[m]=y,w.belongings[m]=m,w.counts[m]=1,m++}),r.forEachEdge(function(_,C,S,L,U,z,R){if(p=t(_,C,S,L,U,z,R),S=c[S],L=c[L],w.M+=p,S===L)w.totalWeights[S]+=p*2,w.loops[S]=p*2;else{w.totalWeights[S]+=p,w.totalWeights[L]+=p;var D=--w.starts[S],G=--w.starts[L];w.neighborhood[D]=L,w.neighborhood[G]=S,w.weights[D]=p,w.weights[G]=p}}),this.starts[m]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}Re.prototype.isolate=function(r,n){var e=this.belongings[r];if(this.counts[e]===1)return e;var t=this.unused[--this.U],i=this.loops[r];return this.totalWeights[e]-=n+i,this.totalWeights[t]+=n+i,this.belongings[r]=t,this.counts[e]--,this.counts[t]++,t};Re.prototype.move=function(r,n,e){var t=this.belongings[r],i=this.loops[r];this.totalWeights[t]-=n+i,this.totalWeights[e]+=n+i,this.belongings[r]=e;var o=this.counts[t]--===1;this.counts[e]++,o&&(this.unused[this.U++]=t)};Re.prototype.computeNodeDegree=function(r){var n,e,t,i=0;for(n=this.starts[r],e=this.starts[r+1];n<e;n++)t=this.weights[n],i+=t;return i};Re.prototype.expensiveIsolate=function(r){var n=this.computeNodeDegree(r);return this.isolate(r,n)};Re.prototype.expensiveMove=function(r,n){var e=this.computeNodeDegree(r);this.move(r,e,n)};Re.prototype.zoomOut=function(){var r=new Array(this.C-this.U),n={},e=this.nodes.length,t=0,i=0,o,a,h,c,p,m,y,w,_;for(o=0,h=this.C;o<h;o++)m=this.belongings[o],m in n||(n[m]=t,r[t]={adj:{},totalWeights:this.totalWeights[m],internalWeights:0},t++),this.belongings[o]=n[m];var C,S;if(this.keepDendrogram){for(C=this.dendrogram[this.level],S=new(At.getPointerArray(t))(e),o=0;o<e;o++)S[o]=this.belongings[C[o]];this.dendrogram.push(S)}else for(o=0;o<e;o++)this.mapping[o]=this.belongings[this.mapping[o]];for(o=0,h=this.C;o<h;o++)for(m=this.belongings[o],w=r[m],_=w.adj,w.internalWeights+=this.loops[o],a=this.starts[o],c=this.starts[o+1];a<c;a++){if(p=this.neighborhood[a],y=this.belongings[p],m===y){w.internalWeights+=this.weights[a];continue}y in _||(_[y]=0),_[y]+=this.weights[a]}for(this.C=t,p=0,m=0;m<t;m++){w=r[m],_=w.adj,m=+m,this.totalWeights[m]=w.totalWeights,this.loops[m]=w.internalWeights,this.counts[m]=1,this.starts[m]=p,this.belongings[m]=m;for(y in _)this.neighborhood[p]=+y,this.weights[p]=_[y],i++,p++}return this.starts[t]=i,this.E=i,this.U=0,this.level++,n};Re.prototype.modularity=function(){var r,n,e,t,i,o=0,a=this.M*2,h=new Float64Array(this.C);for(e=0;e<this.C;e++)for(r=this.belongings[e],h[r]+=this.loops[e],t=this.starts[e],i=this.starts[e+1];t<i;t++)n=this.belongings[this.neighborhood[t]],r===n&&(h[r]+=this.weights[t]);for(e=0;e<this.C;e++)o+=h[e]/a-Math.pow(this.totalWeights[e]/a,2)*this.resolution;return o};Re.prototype.delta=function(r,n,e,t){var i=this.M,o=this.totalWeights[t];return n+=this.loops[r],e/i-o*n*this.resolution/(2*i*i)};Re.prototype.deltaWithOwnCommunity=function(r,n,e,t){var i=this.M,o=this.totalWeights[t];return n+=this.loops[r],e/i-(o-n)*n*this.resolution/(2*i*i)};Re.prototype.fastDelta=function(r,n,e,t){var i=this.M,o=this.totalWeights[t];return n+=this.loops[r],e-n*o*this.resolution/(2*i)};Re.prototype.fastDeltaWithOwnCommunity=function(r,n,e,t){var i=this.M,o=this.totalWeights[t];return n+=this.loops[r],e-n*(o-n)*this.resolution/(2*i)};Re.prototype.bounds=function(r){return[this.starts[r],this.starts[r+1]]};Re.prototype.project=function(){var r=this,n={};return r.nodes.slice(0,this.C).forEach(function(e,t){n[e]=Array.from(r.neighborhood.slice(r.starts[t],r.starts[t+1])).map(function(i){return r.nodes[i]})}),n};Re.prototype.collect=function(r){arguments.length<1&&(r=this.level);var n={},e=this.keepDendrogram?this.dendrogram[r]:this.mapping,t,i;for(t=0,i=e.length;t<i;t++)n[this.nodes[t]]=e[t];return n};Re.prototype.assign=function(r,n){arguments.length<2&&(n=this.level);var e=this.keepDendrogram?this.dendrogram[n]:this.mapping,t,i;for(t=0,i=e.length;t<i;t++)this.graph.setNodeAttribute(this.nodes[t],r,e[t])};Re.prototype[Zo]=function(){var r={};Object.defineProperty(r,"constructor",{value:Re,enumerable:!1}),r.C=this.C,r.M=this.M,r.E=this.E,r.U=this.U,r.resolution=this.resolution,r.level=this.level,r.nodes=this.nodes,r.starts=this.starts.slice(0,r.C+1);var n=["neighborhood","weights"],e=["counts","loops","belongings","totalWeights"],t=this;return n.forEach(function(i){r[i]=t[i].slice(0,r.E)}),e.forEach(function(i){r[i]=t[i].slice(0,r.C)}),r.unused=this.unused.slice(0,this.U),this.keepDendrogram?r.dendrogram=this.dendrogram:r.mapping=this.mapping,r};function Le(r,n){n=Yo(n,Ko);var e=n.resolution,t=Xo(n.getEdgeWeight).fromEntry,i=(r.size-r.selfLoopCount)*2,o=At.getPointerArray(i),a=At.getPointerArray(r.order+1),h=n.getEdgeWeight?Float64Array:At.getPointerArray(r.size*2);this.C=r.order,this.M=0,this.E=i,this.U=0,this.resolution=e,this.level=0,this.graph=r,this.nodes=new Array(r.order),this.keepDendrogram=n.keepDendrogram,this.neighborhood=new a(i),this.weights=new h(i),this.loops=new h(r.order),this.starts=new o(r.order+1),this.offsets=new o(r.order),this.belongings=new a(r.order),this.dendrogram=[],this.counts=new a(r.order),this.unused=new a(r.order),this.totalInWeights=new h(r.order),this.totalOutWeights=new h(r.order);var c={},p,m=0,y=0,w=this;r.forEachNode(function(_){w.nodes[m]=_,c[_]=m,y+=r.outDegreeWithoutSelfLoops(_),w.starts[m]=y,y+=r.inDegreeWithoutSelfLoops(_),w.offsets[m]=y,w.belongings[m]=m,w.counts[m]=1,m++}),r.forEachEdge(function(_,C,S,L,U,z,R){if(p=t(_,C,S,L,U,z,R),S=c[S],L=c[L],w.M+=p,S===L)w.loops[S]+=p,w.totalInWeights[S]+=p,w.totalOutWeights[S]+=p;else{w.totalOutWeights[S]+=p,w.totalInWeights[L]+=p;var D=--w.starts[S],G=--w.offsets[L];w.neighborhood[D]=L,w.neighborhood[G]=S,w.weights[D]=p,w.weights[G]=p}}),this.starts[m]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}Le.prototype.bounds=Re.prototype.bounds;Le.prototype.inBounds=function(r){return[this.offsets[r],this.starts[r+1]]};Le.prototype.outBounds=function(r){return[this.starts[r],this.offsets[r]]};Le.prototype.project=Re.prototype.project;Le.prototype.projectIn=function(){var r=this,n={};return r.nodes.slice(0,this.C).forEach(function(e,t){n[e]=Array.from(r.neighborhood.slice(r.offsets[t],r.starts[t+1])).map(function(i){return r.nodes[i]})}),n};Le.prototype.projectOut=function(){var r=this,n={};return r.nodes.slice(0,this.C).forEach(function(e,t){n[e]=Array.from(r.neighborhood.slice(r.starts[t],r.offsets[t])).map(function(i){return r.nodes[i]})}),n};Le.prototype.isolate=function(r,n,e){var t=this.belongings[r];if(this.counts[t]===1)return t;var i=this.unused[--this.U],o=this.loops[r];return this.totalInWeights[t]-=n+o,this.totalInWeights[i]+=n+o,this.totalOutWeights[t]-=e+o,this.totalOutWeights[i]+=e+o,this.belongings[r]=i,this.counts[t]--,this.counts[i]++,i};Le.prototype.move=function(r,n,e,t){var i=this.belongings[r],o=this.loops[r];this.totalInWeights[i]-=n+o,this.totalInWeights[t]+=n+o,this.totalOutWeights[i]-=e+o,this.totalOutWeights[t]+=e+o,this.belongings[r]=t;var a=this.counts[i]--===1;this.counts[t]++,a&&(this.unused[this.U++]=i)};Le.prototype.computeNodeInDegree=function(r){var n,e,t,i=0;for(n=this.offsets[r],e=this.starts[r+1];n<e;n++)t=this.weights[n],i+=t;return i};Le.prototype.computeNodeOutDegree=function(r){var n,e,t,i=0;for(n=this.starts[r],e=this.offsets[r];n<e;n++)t=this.weights[n],i+=t;return i};Le.prototype.expensiveMove=function(r,n){var e=this.computeNodeInDegree(r),t=this.computeNodeOutDegree(r);this.move(r,e,t,n)};Le.prototype.zoomOut=function(){var r=new Array(this.C-this.U),n={},e=this.nodes.length,t=0,i=0,o,a,h,c,p,m,y,w,_,C,S,L,U;for(o=0,h=this.C;o<h;o++)m=this.belongings[o],m in n||(n[m]=t,r[t]={inAdj:{},outAdj:{},totalInWeights:this.totalInWeights[m],totalOutWeights:this.totalOutWeights[m],internalWeights:0},t++),this.belongings[o]=n[m];var z,R;if(this.keepDendrogram){for(z=this.dendrogram[this.level],R=new(At.getPointerArray(t))(e),o=0;o<e;o++)R[o]=this.belongings[z[o]];this.dendrogram.push(R)}else for(o=0;o<e;o++)this.mapping[o]=this.belongings[this.mapping[o]];for(o=0,h=this.C;o<h;o++)for(m=this.belongings[o],_=this.offsets[o],w=r[m],L=w.inAdj,U=w.outAdj,w.internalWeights+=this.loops[o],a=this.starts[o],c=this.starts[o+1];a<c;a++){if(p=this.neighborhood[a],y=this.belongings[p],C=a<_,S=C?U:L,m===y){C&&(w.internalWeights+=this.weights[a]);continue}y in S||(S[y]=0),S[y]+=this.weights[a]}for(this.C=t,p=0,m=0;m<t;m++){w=r[m],L=w.inAdj,U=w.outAdj,m=+m,this.totalInWeights[m]=w.totalInWeights,this.totalOutWeights[m]=w.totalOutWeights,this.loops[m]=w.internalWeights,this.counts[m]=1,this.starts[m]=p,this.belongings[m]=m;for(y in U)this.neighborhood[p]=+y,this.weights[p]=U[y],i++,p++;this.offsets[m]=p;for(y in L)this.neighborhood[p]=+y,this.weights[p]=L[y],i++,p++}return this.starts[t]=i,this.E=i,this.U=0,this.level++,n};Le.prototype.modularity=function(){var r,n,e,t,i,o=0,a=this.M,h=new Float64Array(this.C);for(e=0;e<this.C;e++)for(r=this.belongings[e],h[r]+=this.loops[e],t=this.starts[e],i=this.offsets[e];t<i;t++)n=this.belongings[this.neighborhood[t]],r===n&&(h[r]+=this.weights[t]);for(e=0;e<this.C;e++)o+=h[e]/a-this.totalInWeights[e]*this.totalOutWeights[e]/Math.pow(a,2)*this.resolution;return o};Le.prototype.delta=function(r,n,e,t,i){var o=this.M,a=this.totalInWeights[i],h=this.totalOutWeights[i],c=this.loops[r];return n+=c,e+=c,t/o-(e*a+n*h)*this.resolution/(o*o)};Le.prototype.deltaWithOwnCommunity=function(r,n,e,t,i){var o=this.M,a=this.totalInWeights[i],h=this.totalOutWeights[i],c=this.loops[r];return n+=c,e+=c,t/o-(e*(a-n)+n*(h-e))*this.resolution/(o*o)};Le.prototype.collect=Re.prototype.collect;Le.prototype.assign=Re.prototype.assign;Le.prototype[Zo]=function(){var r={};Object.defineProperty(r,"constructor",{value:Le,enumerable:!1}),r.C=this.C,r.M=this.M,r.E=this.E,r.U=this.U,r.resolution=this.resolution,r.level=this.level,r.nodes=this.nodes,r.starts=this.starts.slice(0,r.C+1);var n=["neighborhood","weights"],e=["counts","offsets","loops","belongings","totalInWeights","totalOutWeights"],t=this;return n.forEach(function(i){r[i]=t[i].slice(0,r.E)}),e.forEach(function(i){r[i]=t[i].slice(0,r.C)}),r.unused=this.unused.slice(0,this.U),this.keepDendrogram?r.dendrogram=this.dendrogram:r.mapping=this.mapping,r};Pr.UndirectedLouvainIndex=Re;Pr.DirectedLouvainIndex=Le});var oa=ye((zl,ia)=>{var yh=Dr(),bh=zt(),wh=No(),Jo=Bo(),ea=jo(),ta=$o().createRandomIndex,na=Qo(),Eh=na.UndirectedLouvainIndex,_h=na.DirectedLouvainIndex,ra={nodeCommunityAttribute:"community",getEdgeWeight:"weight",fastLocalMoves:!0,randomWalk:!0,resolution:1,rng:Math.random};function Nn(r,n,e){var t=r.get(n);typeof t>"u"&&(t=0),t+=e,r.set(n,t)}var Sh=1e-10;function Un(r,n,e,t,i){return Math.abs(t-i)<Sh?r===n?!1:e>r:t>i}function Th(r,n,e){var t=new Eh(n,{getEdgeWeight:e.getEdgeWeight,keepDendrogram:r,resolution:e.resolution}),i=ta(e.rng),o=!0,a=!0,h,c,p=new Jo(Float64Array,t.C),m,y,w,_,C,S,L,U,z,R,D,G,W,P,M,T,Q=0,se=0,te=[],me,X;for(e.fastLocalMoves&&(m=new ea(t.C));o;){if(R=t.C,o=!1,a=!0,e.fastLocalMoves){for(X=0,S=e.randomWalk?i(R):0,L=0;L<R;L++,S++)U=S%R,m.enqueue(U);for(;m.size!==0;){for(U=m.dequeue(),se++,D=0,p.clear(),h=t.belongings[U],y=t.starts[U],w=t.starts[U+1];y<w;y++)z=t.neighborhood[y],_=t.weights[y],c=t.belongings[z],D+=_,Nn(p,c,_);for(P=t.fastDeltaWithOwnCommunity(U,D,p.get(h)||0,h),W=h,C=0;C<p.size;C++)c=p.dense[C],c!==h&&(G=p.vals[C],Q++,T=t.fastDelta(U,D,G,c),M=Un(W,h,c,T,P),M&&(P=T,W=c));if(P<0){if(W=t.isolate(U,D),W===h)continue}else{if(W===h)continue;t.move(U,D,W)}for(o=!0,X++,y=t.starts[U],w=t.starts[U+1];y<w;y++)z=t.neighborhood[y],c=t.belongings[z],c!==W&&m.enqueue(z)}te.push(X)}else for(me=[],te.push(me);a;){for(a=!1,X=0,S=e.randomWalk?i(R):0,L=0;L<R;L++,S++){for(U=S%R,se++,D=0,p.clear(),h=t.belongings[U],y=t.starts[U],w=t.starts[U+1];y<w;y++)z=t.neighborhood[y],_=t.weights[y],c=t.belongings[z],D+=_,Nn(p,c,_);for(P=t.fastDeltaWithOwnCommunity(U,D,p.get(h)||0,h),W=h,C=0;C<p.size;C++)c=p.dense[C],c!==h&&(G=p.vals[C],Q++,T=t.fastDelta(U,D,G,c),M=Un(W,h,c,T,P),M&&(P=T,W=c));if(P<0){if(W=t.isolate(U,D),W===h)continue}else{if(W===h)continue;t.move(U,D,W)}a=!0,X++}me.push(X),o=a||o}o&&t.zoomOut()}var ce={index:t,deltaComputations:Q,nodesVisited:se,moves:te};return ce}function Ah(r,n,e){var t=new _h(n,{getEdgeWeight:e.getEdgeWeight,keepDendrogram:r,resolution:e.resolution}),i=ta(e.rng),o=!0,a=!0,h,c,p=new Jo(Float64Array,t.C),m,y,w,_,C,S,L,U,z,R,D,G,W,P,M,T,Q,se,te,me=0,X=0,ce=[],pe,Y;for(e.fastLocalMoves&&(m=new ea(t.C));o;){if(G=t.C,o=!1,a=!0,e.fastLocalMoves){for(Y=0,U=e.randomWalk?i(G):0,z=0;z<G;z++,U++)R=U%G,m.enqueue(R);for(;m.size!==0;){for(R=m.dequeue(),X++,W=0,P=0,p.clear(),h=t.belongings[R],y=t.starts[R],w=t.starts[R+1],_=t.offsets[R];y<w;y++)C=y<_,D=t.neighborhood[y],S=t.weights[y],c=t.belongings[D],C?P+=S:W+=S,Nn(p,c,S);for(Q=t.deltaWithOwnCommunity(R,W,P,p.get(h)||0,h),T=h,L=0;L<p.size;L++)c=p.dense[L],c!==h&&(M=p.vals[L],me++,te=t.delta(R,W,P,M,c),se=Un(T,h,c,te,Q),se&&(Q=te,T=c));if(Q<0){if(T=t.isolate(R,W,P),T===h)continue}else{if(T===h)continue;t.move(R,W,P,T)}for(o=!0,Y++,y=t.starts[R],w=t.starts[R+1];y<w;y++)D=t.neighborhood[y],c=t.belongings[D],c!==T&&m.enqueue(D)}ce.push(Y)}else for(pe=[],ce.push(pe);a;){for(a=!1,Y=0,U=e.randomWalk?i(G):0,z=0;z<G;z++,U++){for(R=U%G,X++,W=0,P=0,p.clear(),h=t.belongings[R],y=t.starts[R],w=t.starts[R+1],_=t.offsets[R];y<w;y++)C=y<_,D=t.neighborhood[y],S=t.weights[y],c=t.belongings[D],C?P+=S:W+=S,Nn(p,c,S);for(Q=t.deltaWithOwnCommunity(R,W,P,p.get(h)||0,h),T=h,L=0;L<p.size;L++)c=p.dense[L],c!==h&&(M=p.vals[L],me++,te=t.delta(R,W,P,M,c),se=Un(T,h,c,te,Q),se&&(Q=te,T=c));if(Q<0){if(T=t.isolate(R,W,P),T===h)continue}else{if(T===h)continue;t.move(R,W,P,T)}a=!0,Y++}pe.push(Y),o=a||o}o&&t.zoomOut()}var A={index:t,deltaComputations:me,nodesVisited:X,moves:ce};return A}function Fr(r,n,e,t){if(!bh(e))throw new Error("graphology-communities-louvain: the given graph is not a valid graphology instance.");var i=wh(e);if(i==="mixed")throw new Error("graphology-communities-louvain: cannot run the algorithm on a true mixed graph.");t=yh(t,ra);var o=0;if(e.size===0){if(r){e.forEachNode(function(y){e.setNodeAttribute(y,t.nodeCommunityAttribute,o++)});return}var a={};return e.forEachNode(function(y){a[y]=o++}),n?{communities:a,count:e.order,deltaComputations:0,dendrogram:null,level:0,modularity:NaN,moves:null,nodesVisited:0,resolution:t.resolution}:a}var h=i==="undirected"?Th:Ah,c=h(n,e,t),p=c.index;if(!n){if(r){p.assign(t.nodeCommunityAttribute);return}return p.collect()}var m={count:p.C,deltaComputations:c.deltaComputations,dendrogram:p.dendrogram,level:p.level,modularity:p.modularity(),moves:c.moves,nodesVisited:c.nodesVisited,resolution:t.resolution};return r?(p.assign(t.nodeCommunityAttribute),m):(m.communities=p.collect(),m)}var Wn=Fr.bind(null,!1,!1);Wn.assign=Fr.bind(null,!0,!1);Wn.detailed=Fr.bind(null,!1,!0);Wn.defaults=ra;ia.exports=Wn});var sa=ye((Nl,aa)=>{function Ch(r,n){return r+Math.floor(Math.random()*(n-r+1))}function Ir(r){r||(r=Ch(0,Math.pow(2,31)-1)),this.seed=r%2147483647,this.seed<=0&&(this.seed+=2147483646)}Ir.prototype.next=function(){return this.seed=this.seed*16807%2147483647,this.seed};Ir.prototype.nextFloat=function(){return(this.next()-1)/2147483646};aa.exports=Ir});var Br=ye(Ct=>{var Xe={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452};function Or(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}function zr(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Nr(r){return r>Xe.t3?Math.pow(r,1/3):r/Xe.t2+Xe.t0}function Rh(r){var n=r[0],e=r[1],t=r[2];n=zr(n),e=zr(e),t=zr(t);var i=Nr((.4124564*n+.3575761*e+.1804375*t)/Xe.Xn),o=Nr((.2126729*n+.7151522*e+.072175*t)/Xe.Yn),a=Nr((.0193339*n+.119192*e+.9503041*t)/Xe.Zn);return[i,o,a]}function Ur(r){return r>Xe.t1?r*r*r:Xe.t2*(r-Xe.t0)}function ua(r){var n=r[0],e=r[1],t=r[2],i=(n+16)/116,o=isNaN(e)?i:i+e/500,a=isNaN(t)?i:i-t/200;i=Xe.Yn*Ur(i),o=Xe.Xn*Ur(o),a=Xe.Zn*Ur(a);var h=Or(3.2404542*o-1.5371385*i-.4985314*a),c=Or(-.969266*o+1.8760108*i+.041556*a);return t=Or(.0556434*o-.2040259*i+1.0572252*a),[h,c,t]}function kh(r){var n=Rh(r),e=n[0],t=n[1],i=n[2],o=116*t-16;return[o<0?0:o,500*(e-t),200*(t-i)]}function Lh(r){var n=r[0],e=r[1],t=r[2];return n>=0&&n<=255&&e>=0&&e<=255&&t>=0&&t<=255}function Wr(r){return("0"+r.toString(16)).slice(-2)}function Dh(r){var n=ua(r);return"#"+Wr(n[0])+Wr(n[1])+Wr(n[2])}var Gh=180/Math.PI;function xh(r){var n=r[0],e=r[1],t=r[2],i=Math.sqrt(e*e+t*t),o=(Math.atan2(t,e)*Gh+360)%360;return Math.round(i*1e4)===0&&(o=NaN),[o,i,n]}function Ph(r,n){n=n.slice();for(var e=[n.shift()],t,i,o,a,h,c,p;n.length>0;){for(t=-1,i=-1/0,o=0;o<n.length;o++)for(a=n[o],p=0;p<e.length;p++)h=e[p],c=r(a,h),c>i&&(i=c,t=o);e.push(n[t]),n.splice(t,1)}return e}function Fh(r,n){var e,t,i,o=1/0,a,h=0,c=0;for(e=0,i=n.length;e<i;e++)for(t=e+1;t<i;t++)a=r(n[e],n[t]),a<o&&(o=a),h+=a,c++;return{min:o,mean:h/c}}Ct.validateRgb=Lh;Ct.labToRgb=ua;Ct.labToRgbHex=Dh;Ct.rgbToLab=kh;Ct.labToHcl=xh;Ct.diffSort=Ph;Ct.computeQualityMetrics=Fh});var la=ye((Wl,ca)=>{var ha=Br(),Qt={protanope:{x:.7465,y:.2535,m:1.273463,yint:-.073894},deuteranope:{x:1.4,y:-.4,m:.968437,yint:.003331},tritanope:{x:.1748,y:0,m:.062921,yint:.292119}};function Ih(r,n){return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2))}function Oh(r,n,e,t){for(var i=e[0],o=t[0],a=e[1],h=t[1],c=e[2],p=t[2],m=Math.sqrt(Math.pow(a,2)+Math.pow(c,2)),y=Math.sqrt(Math.pow(h,2)+Math.pow(p,2)),w=m-y,_=i-o,C=a-h,S=c-p,L=Math.sqrt(Math.pow(C,2)+Math.pow(S,2)+Math.pow(w,2)),U=Math.atan2(c,a)*(180/Math.PI);U<0;)U+=360;var z=Math.sqrt(Math.pow(m,4)/(Math.pow(m,4)+1900)),R=U>=164&&U<=345?.56+Math.abs(.2*Math.cos(U+168)):.36+Math.abs(.4*Math.cos(U+35)),D=e[0]<16?.511:.040975*i/(1+.01765*i),G=.0638*m/(1+.0131*m)+.638,W=G*(z*R+1-z),P=Math.sqrt(Math.pow(_/(r*D),2)+Math.pow(w/(n*G),2)+Math.pow(L/W,2));return P}function Rt(){this.cache={}}Rt.prototype.simulate=function(r,n,e){e=e||1;var t=r.join("-")+"-"+n+"-"+e,i=this.cache[t];if(i)return i;var o=Qt[n].x,a=Qt[n].y,h=Qt[n].m,c=Qt[n].yint,p=ha.labToRgb(r),m=p[0],y=p[1],w=p[2],_=m,C=y,S=w,L=Math.pow(m,2.2),U=Math.pow(y,2.2),z=Math.pow(w,2.2),R=L*.412424+U*.357579+z*.180464,D=L*.212656+U*.715158+z*.0721856,G=L*.0193324+U*.119193+z*.950444,W=R/(R+D+G),P=D/(R+D+G),M=(P-a)/(W-o),T=P-W*M,Q=(c-T)/(M-h),se=M*Q+T;R=Q*D/se,G=(1-(Q+se))*D/se;var te=.312713*D/.329016,me=.358271*D/.329016,X=te-R,ce=me-G,pe=X*3.24071+ce*-.498571,Y=X*-.969258+ce*.0415557,A=X*.0556352+ce*1.05707;_=R*3.24071+D*-1.53726+G*-.498571,C=R*-.969258+D*1.87599+G*.0415557,S=R*.0556352+D*-.203996+G*1.05707;var Te=((_<0?0:1)-_)/pe,be=((C<0?0:1)-C)/Y,j=((S<0?0:1)-S)/A,k=Math.max(Te>1||Te<0?0:Te,be>1||be<0?0:be,j>1||j<0?0:j);_=_+k*pe,C=C+k*Y,S=S+k*A,_=Math.pow(_,1/2.2),C=Math.pow(C,1/2.2),S=Math.pow(S,1/2.2),_=m*(1-e)+_*e,C=y*(1-e)+C*e,S=w*(1-e)+S*e;var ne=[_,C,S],he=ha.rgbToLab(ne);return this.cache[t]=he,he};Rt.prototype.euclidean=Ih;Rt.prototype.cmc=Oh.bind(null,2,1);Rt.prototype.colorblind=function(r,n,e){return n=this.simulate(n,r),e=this.simulate(e,r),this.cmc(n,e)};Object.keys(Qt).forEach(function(r){Rt.prototype[r]=function(n,e){return this.colorblind(r,n,e)}});var zh=1601;Rt.prototype.compromise=function(r,n){var e=0,t=this.cmc(r,n);return e+=t*1e3,t=this.colorblind("protanope",r,n),isNaN(t)||(e+=t*100),t=this.colorblind("deuteranope",r,n),isNaN(t)||(e+=t*500),t=this.colorblind("tritanope",r,n),isNaN(t)||(e+=t*1),e/zh};Rt.prototype.get=function(r){return r in Qt?this.colorblind.bind(this,r):this[r].bind(this)};ca.exports=Rt});var fa=ye((Bl,da)=>{var Nh={all:[0,360,0,100,0,100],default:[0,360,30,80,35,80],sensible:[0,360,25.59,55.59,60.94,90.94],colorblind:[0,360,40,70,15,85],"fancy-light":[0,360,15,40,70,100],"fancy-dark":[0,360,8,40,7,40],shades:[0,240,0,15,0,100],tarnish:[0,360,0,15,30,70],pastel:[0,360,0,30,70,100],pimp:[0,360,30,100,25,70],intense:[0,360,20,100,15,80],fluo:[0,300,35,100,75,100],"red-roses":[330,20,10,100,35,100],"ochre-sand":[20,60,20,50,35,100],"yellow-lime":[60,90,10,100,35,100],"green-mint":[90,150,10,100,35,100],"ice-cube":[150,200,0,100,35,100],"blue-ocean":[220,260,8,80,0,50],"indigo-night":[260,290,40,100,35,100],"purple-wine":[290,330,0,100,0,40]};da.exports=Nh});var wa=ye((Ml,ba)=>{var Uh=sa(),Wh=la(),Jt=Br(),ya=fa(),Bh=Jt.validateRgb,Bn=Jt.labToRgb,ga=Jt.labToRgbHex,pa=Jt.labToHcl,Mh=Jt.diffSort,jh={attempts:1,colorFilter:null,colorSpace:"default",clustering:"k-means",quality:50,ultraPrecision:!1,distance:"euclidean",seed:null},Hh=new Set(["force-vector","k-means"]),Vh=new Set(["euclidean","cmc","compromise","protanope","deuteranope","tritanope"]),qh=new Set(Object.keys(ya));function $h(r){for(var n=0,e=0,t=r.length;e<t;e++)n+=r.charCodeAt(e);return n}function Yh(r){var n=Object.assign({},jh,r);if(typeof n.attempts!="number"||n.attempts<=0)throw new Error("iwanthue: invalid `attempts` setting. Expecting a positive number.");if(n.colorFilter&&typeof n.colorFilter!="function")throw new Error("iwanthue: invalid `colorFilter` setting. Expecting a function.");if(!Hh.has(n.clustering))throw new Error('iwanthue: unknown `clustering` "'+n.clustering+'".');if(typeof n.quality!="number"||isNaN(n.quality)||n.quality<1)throw new Error("iwanthue: invalid `quality`. Expecting a number > 0.");if(typeof n.ultraPrecision!="boolean")throw new Error("iwanthue: invalid `ultraPrecision`. Expecting a boolean.");if(!Vh.has(n.distance))throw new Error('iwanthue: unknown `distance` "'+n.distance+'".');if(typeof n.seed=="string"&&(n.seed=$h(n.seed)),n.seed!==null&&typeof n.seed!="number")throw new Error("iwanthue: invalid `seed`. Expecting an integer or a string.");if(!n.colorFilter&&n.colorSpace&&n.colorSpace!=="all"){var e;if(typeof n.colorSpace=="string"){if(!qh.has(n.colorSpace))throw new Error('iwanthue: unknown `colorSpace` "'+n.colorSpace+'".');e=ya[n.colorSpace]}else if(Array.isArray(n.colorSpace)){if(n.colorSpace.length!==6)throw new Error("iwanthue: expecting a `colorSpace` array of length 6 ([hmin, hmax, cmin, cmax, lmin, lmax]).");e=n.colorSpace}else e=[n.colorSpace.hmin||0,n.colorSpace.hmax||360,n.colorSpace.cmin||0,n.colorSpace.cmax||100,n.colorSpace.lmin||0,n.colorSpace.lmax||100];e[0]<e[1]?n.colorFilter=function(t,i){var o=pa(i);return o[0]>=e[0]&&o[0]<=e[1]&&o[1]>=e[2]&&o[1]<=e[3]&&o[2]>=e[4]&&o[2]<=e[5]}:n.colorFilter=function(t,i){var o=pa(i);return(o[0]>=e[0]||o[0]<=e[1])&&o[1]>=e[2]&&o[1]<=e[3]&&o[2]>=e[4]&&o[2]<=e[5]}}return n}function va(r,n,e){for(var t=new Array(n),i,o,a=0;a<n;a++){do i=[100*r(),100*(2*r()-1),100*(2*r()-1)],o=Bn(i);while(!e(o,i));t[a]=i}return t}var Xh=100,ma=100;function Zh(r,n,e,t,i){for(var o=new Array(t.length),a=i.quality*20,h,c,p=t.length,m,y,w,_,C,S,L,U,z,R,D,G;a-- >0;){for(h=0;h<p;h++)o[h]={dl:0,da:0,db:0};for(h=0;h<p;h++)for(m=t[h],c=0;c<h;c++)y=t[c],w=n(m,y),w>0?(_=m[0]-y[0],C=m[1]-y[1],S=m[2]-y[2],L=Xh/Math.pow(w,2),o[h].dl+=_*L/w,o[h].da+=C*L/w,o[h].db+=S*L/w,o[c].dl-=_*L/w,o[c].da-=C*L/w,o[c].db-=S*L/w):(o[c].dl+=2-4*r(),o[c].da+=2-4*r(),o[c].db+=2-4*r());for(h=0;h<p;h++)z=t[h],D=ma*Math.sqrt(Math.pow(o[h].dl,2)+Math.pow(o[h].da,2)+Math.pow(o[h].db,2)),D>0&&(R=ma*Math.min(.1,D)/D,U=[z[0]+o[h].dl*R,z[1]+o[h].da*R,z[2]+o[h].db*R],G=Bn(U),e(G,U)&&(t[h]=U))}}function Kh(r,n,e,t){var i=[],o=[],a,h,c,p,m,y=5,w=10,_=10;for(t.ultraPrecision&&(y=1,w=5,_=5),a=0;a<=100;a+=y)for(h=-100;h<=100;h+=w)for(c=-100;c<=100;c+=_)p=[a,h,c],m=Bn(p),n(m,p)&&(i.push(p),o.push(null));for(var C=t.quality,S,L,U,z,R=i.length,D=e.length,G,W,P,M,T,Q;C-- >0;){for(S=0;S<R;S++)for(z=i[S],W=1/0,L=0;L<D;L++)U=e[L],G=r(U,z),G<W&&(W=G,o[S]=L);for(P=i.slice(),L=0;L<D;L++){for(M=0,T=[0,0,0],S=0;S<R;S++)o[S]===L&&(M++,T[0]+=i[S][0],T[1]+=i[S][1],T[2]+=i[S][2]);if(M!==0)if(T[0]/=M,T[1]/=M,T[2]/=M,m=Bn(T),n(m,T))e[L]=T;else{if(P.length>0){for(W=1/0,Q=-1,S=0;S<P.length;S++)G=r(P[S],T),G<W&&(W=G,Q=S);e[L]=i[Q]}else{for(W=1/0,Q=-1,S=0;S<i.length;S++)G=r(i[S],T),G<W&&(W=G,Q=S);e[L]=i[Q]}P=P.filter(function(se){return se[0]!==e[L][0]||se[1]!==e[L][1]||se[2]!==e[L][2]})}}}return e}ba.exports=function(n,e){if(typeof n!="number"||n<1)throw new Error("iwanthue: expecting a color count > 1.");e=Yh(e);var t=new Uh(e.seed),i=function(){return t.nextFloat()},o=new Wh,a=o.get(e.distance),h=function(_,C){return Bh(_)?e.colorFilter?!!e.colorFilter(_,C):!0:!1},c;if(n===1)return c=va(i,n,h),[ga(c[0])];for(var p=e.attempts,m,y=-1/0,w;p>0;)c=va(i,n,h),e.clustering==="force-vector"?Zh(i,a,h,c,e):Kh(a,h,c,e),m=Jt.computeQualityMetrics(a,c),m.min>y&&(y=m.min,w=c),p--;return c=w,c=Mh(a,c),c.map(ga)}});var Aa=ye((jl,Ta)=>{"use strict";Ta.exports=_a;function _a(r,n,e){r instanceof RegExp&&(r=Ea(r,e)),n instanceof RegExp&&(n=Ea(n,e));var t=Sa(r,n,e);return t&&{start:t[0],end:t[1],pre:e.slice(0,t[0]),body:e.slice(t[0]+r.length,t[1]),post:e.slice(t[1]+n.length)}}function Ea(r,n){var e=n.match(r);return e?e[0]:null}_a.range=Sa;function Sa(r,n,e){var t,i,o,a,h,c=e.indexOf(r),p=e.indexOf(n,c+1),m=c;if(c>=0&&p>0){if(r===n)return[c,p];for(t=[],o=e.length;m>=0&&!h;)m==c?(t.push(m),c=e.indexOf(r,m+1)):t.length==1?h=[t.pop(),p]:(i=t.pop(),i<o&&(o=i,a=p),p=e.indexOf(n,m+1)),m=c<p&&c>=0?c:p;t.length&&(h=[o,a])}return h}});var Pa=ye((Hl,xa)=>{var Ca=Aa();xa.exports=ec;var Ra="\0SLASH"+Math.random()+"\0",ka="\0OPEN"+Math.random()+"\0",jr="\0CLOSE"+Math.random()+"\0",La="\0COMMA"+Math.random()+"\0",Da="\0PERIOD"+Math.random()+"\0";function Mr(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function Qh(r){return r.split("\\\\").join(Ra).split("\\{").join(ka).split("\\}").join(jr).split("\\,").join(La).split("\\.").join(Da)}function Jh(r){return r.split(Ra).join("\\").split(ka).join("{").split(jr).join("}").split(La).join(",").split(Da).join(".")}function Ga(r){if(!r)return[""];var n=[],e=Ca("{","}",r);if(!e)return r.split(",");var t=e.pre,i=e.body,o=e.post,a=t.split(",");a[a.length-1]+="{"+i+"}";var h=Ga(o);return o.length&&(a[a.length-1]+=h.shift(),a.push.apply(a,h)),n.push.apply(n,a),n}function ec(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),vn(Qh(r),!0).map(Jh)):[]}function tc(r){return"{"+r+"}"}function nc(r){return/^-?0\d/.test(r)}function rc(r,n){return r<=n}function ic(r,n){return r>=n}function vn(r,n){var e=[],t=Ca("{","}",r);if(!t)return[r];var i=t.pre,o=t.post.length?vn(t.post,!1):[""];if(/\$$/.test(t.pre))for(var a=0;a<o.length;a++){var h=i+"{"+t.body+"}"+o[a];e.push(h)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(t.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(t.body),m=c||p,y=t.body.indexOf(",")>=0;if(!m&&!y)return t.post.match(/,.*\}/)?(r=t.pre+"{"+t.body+jr+t.post,vn(r)):[r];var w;if(m)w=t.body.split(/\.\./);else if(w=Ga(t.body),w.length===1&&(w=vn(w[0],!1).map(tc),w.length===1))return o.map(function(Q){return t.pre+w[0]+Q});var _;if(m){var C=Mr(w[0]),S=Mr(w[1]),L=Math.max(w[0].length,w[1].length),U=w.length==3?Math.abs(Mr(w[2])):1,z=rc,R=S<C;R&&(U*=-1,z=ic);var D=w.some(nc);_=[];for(var G=C;z(G,S);G+=U){var W;if(p)W=String.fromCharCode(G),W==="\\"&&(W="");else if(W=String(G),D){var P=L-W.length;if(P>0){var M=new Array(P+1).join("0");G<0?W="-"+M+W.slice(1):W=M+W}}_.push(W)}}else{_=[];for(var T=0;T<w.length;T++)_.push.apply(_,vn(w[T],!1))}for(var T=0;T<_.length;T++)for(var a=0;a<o.length;a++){var h=i+_[T]+o[a];(!n||m||h)&&e.push(h)}}return e}});function Ds(r,n){if(typeof r!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var t=e.call(r,n||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function It(r){var n=Ds(r,"string");return typeof n=="symbol"?n:n+""}function De(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function pi(r,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,It(t.key),t)}}function Ge(r,n,e){return n&&pi(r.prototype,n),e&&pi(r,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ft(r){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ft(r)}function vi(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vi=function(){return!!r})()}function H(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Gs(r,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return H(r)}function Ue(r,n,e){return n=Ft(n),Gs(r,vi()?Reflect.construct(n,e||[],Ft(r).constructor):n.apply(r,e))}function rr(r,n){return rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rr(r,n)}function We(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&rr(r,n)}function xs(r){if(Array.isArray(r))return r}function Ps(r,n){var e=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(e!=null){var t,i,o,a,h=[],c=!0,p=!1;try{if(o=(e=e.call(r)).next,n===0){if(Object(e)!==e)return;c=!1}else for(;!(c=(t=o.call(e)).done)&&(h.push(t.value),h.length!==n);c=!0);}catch(m){p=!0,i=m}finally{try{if(!c&&e.return!=null&&(a=e.return(),Object(a)!==a))return}finally{if(p)throw i}}return h}}function Sn(r,n){(n==null||n>r.length)&&(n=r.length);for(var e=0,t=Array(n);e<n;e++)t[e]=r[e];return t}function sr(r,n){if(r){if(typeof r=="string")return Sn(r,n);var e={}.toString.call(r).slice(8,-1);return e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set"?Array.from(r):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Sn(r,n):void 0}}function Fs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $t(r,n){return xs(r)||Ps(r,n)||sr(r,n)||Fs()}var ir={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"};var mi=new Int8Array(4),or=new Int32Array(mi.buffer,0,1),Is=new Float32Array(mi.buffer,0,1),Os=/^\s*rgba?\s*\(/,zs=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function Ns(r){var n=0,e=0,t=0,i=1;if(r[0]==="#")r.length===4?(n=parseInt(r.charAt(1)+r.charAt(1),16),e=parseInt(r.charAt(2)+r.charAt(2),16),t=parseInt(r.charAt(3)+r.charAt(3),16)):(n=parseInt(r.charAt(1)+r.charAt(2),16),e=parseInt(r.charAt(3)+r.charAt(4),16),t=parseInt(r.charAt(5)+r.charAt(6),16)),r.length===9&&(i=parseInt(r.charAt(7)+r.charAt(8),16)/255);else if(Os.test(r)){var o=r.match(zs);o&&(n=+o[1],e=+o[2],t=+o[3],o[4]&&(i=+o[4]))}return{r:n,g:e,b:t,a:i}}var qt={};for(hn in ir)qt[hn]=Yt(ir[hn]),qt[ir[hn]]=qt[hn];var hn;function yi(r,n,e,t,i){return or[0]=t<<24|e<<16|n<<8|r,i&&(or[0]=or[0]&4278190079),Is[0]}function Yt(r){if(r=r.toLowerCase(),typeof qt[r]<"u")return qt[r];var n=Ns(r),e=n.r,t=n.g,i=n.b,o=n.a;o=o*255|0;var a=yi(e,t,i,o,!0);return qt[r]=a,a}var ar={};function ur(r){if(typeof ar[r]<"u")return ar[r];var n=(r&16711680)>>>16,e=(r&65280)>>>8,t=r&255,i=255,o=yi(n,e,t,i,!0);return ar[r]=o,o}function hr(r,n,e,t){return e+(n<<8)+(r<<16)}function cr(r,n,e,t,i,o){var a=Math.floor(e/o*i),h=Math.floor(r.drawingBufferHeight/o-t/o*i),c=new Uint8Array(4);r.bindFramebuffer(r.FRAMEBUFFER,n),r.readPixels(a,h,1,1,r.RGBA,r.UNSIGNED_BYTE,c);var p=$t(c,4),m=p[0],y=p[1],w=p[2],_=p[3];return[m,y,w,_]}function B(r,n,e){return(n=It(n))in r?Object.defineProperty(r,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[n]=e,r}function bi(r,n){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);n&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,t)}return e}function K(r){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?bi(Object(e),!0).forEach(function(t){B(r,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):bi(Object(e)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))})}return r}function Us(r,n){for(;!{}.hasOwnProperty.call(r,n)&&(r=Ft(r))!==null;);return r}function fr(){return fr=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,n,e){var t=Us(r,n);if(t){var i=Object.getOwnPropertyDescriptor(t,n);return i.get?i.get.call(arguments.length<3?r:e):i.value}},fr.apply(null,arguments)}function Ci(r,n,e,t){var i=fr(Ft(1&t?r.prototype:r),n,e);return 2&t&&typeof i=="function"?function(o){return i.apply(e,o)}:i}function Ws(r){return r.normalized?1:r.size}function lr(r){var n=0;return r.forEach(function(e){return n+=Ws(e)}),n}function Ri(r,n,e){var t=r==="VERTEX"?n.VERTEX_SHADER:n.FRAGMENT_SHADER,i=n.createShader(t);if(i===null)throw new Error("loadShader: error while creating the shader");n.shaderSource(i,e),n.compileShader(i);var o=n.getShaderParameter(i,n.COMPILE_STATUS);if(!o){var a=n.getShaderInfoLog(i);throw n.deleteShader(i),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(e))}return i}function Bs(r,n){return Ri("VERTEX",r,n)}function Ms(r,n){return Ri("FRAGMENT",r,n)}function js(r,n){var e=r.createProgram();if(e===null)throw new Error("loadProgram: error while creating the program.");var t,i;for(t=0,i=n.length;t<i;t++)r.attachShader(e,n[t]);r.linkProgram(e);var o=r.getProgramParameter(e,r.LINK_STATUS);if(!o)throw r.deleteProgram(e),new Error("loadProgram: error while linking the program.");return e}function wi(r){var n=r.gl,e=r.buffer,t=r.program,i=r.vertexShader,o=r.fragmentShader;n.deleteShader(i),n.deleteShader(o),n.deleteProgram(t),n.deleteBuffer(e)}var Ei=`#define PICKING_MODE
`,Hs=B(B(B(B(B(B(B(B({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4);var ki=function(){function r(n,e,t){De(this,r),B(this,"array",new Float32Array),B(this,"constantArray",new Float32Array),B(this,"capacity",0),B(this,"verticesCount",0);var i=this.getDefinition();if(this.VERTICES=i.VERTICES,this.VERTEX_SHADER_SOURCE=i.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=i.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=i.UNIFORMS,this.ATTRIBUTES=i.ATTRIBUTES,this.METHOD=i.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in i?i.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in i?i.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in i,this.ATTRIBUTES_ITEMS_COUNT=lr(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=t,this.normalProgram=this.getProgramInfo("normal",n,i.VERTEX_SHADER_SOURCE,i.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=e?this.getProgramInfo("pick",n,Ei+i.VERTEX_SHADER_SOURCE,Ei+i.FRAGMENT_SHADER_SOURCE,e):null,this.isInstanced){var o=lr(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var h=this.CONSTANT_DATA[a];if(h.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(h.length," items instead of ").concat(o,")"));for(var c=0;c<h.length;c++)this.constantArray[a*o+c]=h[c]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return Ge(r,[{key:"kill",value:function(){wi(this.normalProgram),this.pickProgram&&(wi(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(e,t,i,o,a){var h=this.getDefinition(),c=t.createBuffer();if(c===null)throw new Error("Program: error while creating the WebGL buffer.");var p=Bs(t,i),m=Ms(t,o),y=js(t,[p,m]),w={};h.UNIFORMS.forEach(function(S){var L=t.getUniformLocation(y,S);L&&(w[S]=L)});var _={};h.ATTRIBUTES.forEach(function(S){_[S.name]=t.getAttribLocation(y,S.name)});var C;if("CONSTANT_ATTRIBUTES"in h&&(h.CONSTANT_ATTRIBUTES.forEach(function(S){_[S.name]=t.getAttribLocation(y,S.name)}),C=t.createBuffer(),C===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:e,program:y,gl:t,frameBuffer:a,buffer:c,constantBuffer:C||{},uniformLocations:w,attributeLocations:_,isPicking:e==="pick",vertexShader:p,fragmentShader:m}}},{key:"bindProgram",value:function(e){var t=this,i=0,o=e.gl,a=e.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,e.constantBuffer),i=0,this.CONSTANT_ATTRIBUTES.forEach(function(h){return i+=t.bindAttribute(h,e,i,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,e.buffer),i=0,this.ATTRIBUTES.forEach(function(h){return i+=t.bindAttribute(h,e,i,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),i=0,this.ATTRIBUTES.forEach(function(h){return i+=t.bindAttribute(h,e,i)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(e){var t=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,e,!1)}),this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,e,!0)})):this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,e)})}},{key:"bindAttribute",value:function(e,t,i,o){var a=Hs[e.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(e.type,'"'));var h=t.attributeLocations[e.name],c=t.gl;if(h!==-1){c.enableVertexAttribArray(h);var p=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:lr(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(c.vertexAttribPointer(h,e.size,e.type,e.normalized||!1,p,i),this.isInstanced&&o)if(c instanceof WebGL2RenderingContext)c.vertexAttribDivisor(h,1);else{var m=c.getExtension("ANGLE_instanced_arrays");m&&m.vertexAttribDivisorANGLE(h,1)}}return e.size*a}},{key:"unbindAttribute",value:function(e,t,i){var o=t.attributeLocations[e.name],a=t.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&i))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var h=a.getExtension("ANGLE_instanced_arrays");h&&h.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(e){e!==this.capacity&&(this.capacity=e,this.verticesCount=this.VERTICES*e,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(e,t){var i=t.gl,o=t.program;i.enable(i.BLEND),i.useProgram(o),this.setUniforms(e,t),this.drawWebGL(this.METHOD,t)}},{key:"render",value:function(e){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,e.width*e.pixelRatio/e.downSizingRatio,e.height*e.pixelRatio/e.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(K(K({},e),{},{pixelRatio:e.pixelRatio/e.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,e.width*e.pixelRatio,e.height*e.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(e,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(e,t){var i=t.gl,o=t.frameBuffer;if(i.bindFramebuffer(i.FRAMEBUFFER,o),!this.isInstanced)i.drawArrays(e,0,this.verticesCount);else if(i instanceof WebGL2RenderingContext)i.drawArraysInstanced(e,0,this.VERTICES,this.capacity);else{var a=i.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(e,0,this.VERTICES,this.capacity)}}}]),r}();var Vs=function(r){We(n,r);function n(){return De(this,n),Ue(this,n,arguments)}return Ge(n,[{key:"kill",value:function(){Ci(n,"kill",this,3)([])}},{key:"process",value:function(t,i,o){var a=i*this.STRIDE;if(o.hidden){for(var h=a+this.STRIDE;a<h;a++)this.array[a]=0;return}return this.processVisibleItem(ur(t),a,o)}}]),n}(ki);var gr=function(r){We(n,r);function n(){var e;De(this,n);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=Ue(this,n,[].concat(i)),B(H(e),"drawLabel",void 0),e}return Ge(n,[{key:"kill",value:function(){Ci(n,"kill",this,3)([])}},{key:"process",value:function(t,i,o,a,h){var c=i*this.STRIDE;if(h.hidden||o.hidden||a.hidden){for(var p=c+this.STRIDE;c<p;c++)this.array[c]=0;return}return this.processVisibleItem(ur(t),c,o,a,h)}}]),n}(ki);function qs(r,n){return function(){function e(t,i,o){De(this,e),B(this,"drawLabel",n),this.programs=r.map(function(a){return new a(t,i,o)})}return Ge(e,[{key:"reallocate",value:function(i){this.programs.forEach(function(o){return o.reallocate(i)})}},{key:"process",value:function(i,o,a,h,c){this.programs.forEach(function(p){return p.process(i,o,a,h,c)})}},{key:"render",value:function(i){this.programs.forEach(function(o){return o.render(i)})}},{key:"kill",value:function(){this.programs.forEach(function(i){return i.kill()})}}]),e}()}function Li(r,n,e,t,i){var o=i.edgeLabelSize,a=i.edgeLabelFont,h=i.edgeLabelWeight,c=i.edgeLabelColor.attribute?n[i.edgeLabelColor.attribute]||i.edgeLabelColor.color||"#000":i.edgeLabelColor.color,p=n.label;if(p){r.fillStyle=c,r.font="".concat(h," ").concat(o,"px ").concat(a);var m=e.size,y=t.size,w=e.x,_=e.y,C=t.x,S=t.y,L=(w+C)/2,U=(_+S)/2,z=C-w,R=S-_,D=Math.sqrt(z*z+R*R);if(!(D<m+y)){w+=z*m/D,_+=R*m/D,C-=z*y/D,S-=R*y/D,L=(w+C)/2,U=(_+S)/2,z=C-w,R=S-_,D=Math.sqrt(z*z+R*R);var G=r.measureText(p).width;if(G>D){var W="\u2026";for(p=p+W,G=r.measureText(p).width;G>D&&p.length>1;)p=p.slice(0,-2)+W,G=r.measureText(p).width;if(p.length<4)return}var P;z>0?R>0?P=Math.acos(z/D):P=Math.asin(R/D):R>0?P=Math.acos(z/D)+Math.PI:P=Math.asin(z/D)+Math.PI/2,r.save(),r.translate(L,U),r.rotate(P),r.fillText(p,-G/2,n.size/2+o),r.restore()}}}function pr(r,n,e){if(n.label){var t=e.labelSize,i=e.labelFont,o=e.labelWeight,a=e.labelColor.attribute?n[e.labelColor.attribute]||e.labelColor.color||"#000":e.labelColor.color;r.fillStyle=a,r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillText(n.label,n.x+n.size+3,n.y+t/3)}}function Di(r,n,e){var t=e.labelSize,i=e.labelFont,o=e.labelWeight;r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillStyle="#FFF",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=8,r.shadowColor="#000";var a=2;if(typeof n.label=="string"){var h=r.measureText(n.label).width,c=Math.round(h+5),p=Math.round(t+2*a),m=Math.max(n.size,t/2)+a,y=Math.asin(p/2/m),w=Math.sqrt(Math.abs(Math.pow(m,2)-Math.pow(p/2,2)));r.beginPath(),r.moveTo(n.x+w,n.y+p/2),r.lineTo(n.x+m+c,n.y+p/2),r.lineTo(n.x+m+c,n.y-p/2),r.lineTo(n.x+w,n.y-p/2),r.arc(n.x,n.y,m,y,-y),r.closePath(),r.fill()}else r.beginPath(),r.arc(n.x,n.y,n.size+a,0,Math.PI*2),r.closePath(),r.fill();r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=0,pr(r,n,e)}var $s=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ys=$s,Xs=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Zs=Xs,Gi=WebGLRenderingContext,_i=Gi.UNSIGNED_BYTE,dr=Gi.FLOAT,Ks=["u_sizeRatio","u_correctionRatio","u_matrix"],ln=function(r){We(n,r);function n(){return De(this,n),Ue(this,n,arguments)}return Ge(n,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Zs,FRAGMENT_SHADER_SOURCE:Ys,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ks,ATTRIBUTES:[{name:"a_position",size:2,type:dr},{name:"a_size",size:1,type:dr},{name:"a_color",size:4,type:_i,normalized:!0},{name:"a_id",size:4,type:_i,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:dr}],CONSTANT_DATA:[[n.ANGLE_1],[n.ANGLE_2],[n.ANGLE_3]]}}},{key:"processVisibleItem",value:function(t,i,o){var a=this.array,h=Yt(o.color);a[i++]=o.x,a[i++]=o.y,a[i++]=o.size,a[i++]=h,a[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,a=i.uniformLocations,h=a.u_sizeRatio,c=a.u_correctionRatio,p=a.u_matrix;o.uniform1f(c,t.correctionRatio),o.uniform1f(h,t.sizeRatio),o.uniformMatrix3fv(p,!1,t.matrix)}}]),n}(Vs);B(ln,"ANGLE_1",0);B(ln,"ANGLE_2",2*Math.PI/3);B(ln,"ANGLE_3",4*Math.PI/3);var Qs=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Js=Qs,eu=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,tu=eu,xi=WebGLRenderingContext,Si=xi.UNSIGNED_BYTE,Tn=xi.FLOAT,nu=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Pi={lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function Fi(r){var n=K(K({},Pi),r||{});return function(e){We(t,e);function t(){return De(this,t),Ue(this,t,arguments)}return Ge(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:tu,FRAGMENT_SHADER_SOURCE:Js,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:nu,ATTRIBUTES:[{name:"a_position",size:2,type:Tn},{name:"a_normal",size:2,type:Tn},{name:"a_radius",size:1,type:Tn},{name:"a_color",size:4,type:Si,normalized:!0},{name:"a_id",size:4,type:Si,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:Tn}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,h,c,p){var m=p.size||1,y=c.size||1,w=h.x,_=h.y,C=c.x,S=c.y,L=Yt(p.color),U=C-w,z=S-_,R=U*U+z*z,D=0,G=0;R&&(R=1/Math.sqrt(R),D=-z*R*m,G=U*R*m);var W=this.array;W[a++]=C,W[a++]=S,W[a++]=-D,W[a++]=-G,W[a++]=y,W[a++]=L,W[a++]=o}},{key:"setUniforms",value:function(o,a){var h=a.gl,c=a.uniformLocations,p=c.u_matrix,m=c.u_sizeRatio,y=c.u_correctionRatio,w=c.u_minEdgeThickness,_=c.u_lengthToThicknessRatio,C=c.u_widenessToThicknessRatio;h.uniformMatrix3fv(p,!1,o.matrix),h.uniform1f(m,o.sizeRatio),h.uniform1f(y,o.correctionRatio),h.uniform1f(w,o.minEdgeThickness),h.uniform1f(_,n.lengthToThicknessRatio),h.uniform1f(C,n.widenessToThicknessRatio)}}]),t}(gr)}Fi();var ru=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ii=ru,iu=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ou=iu,Oi=WebGLRenderingContext,Ti=Oi.UNSIGNED_BYTE,Ot=Oi.FLOAT,au=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],su={lengthToThicknessRatio:Pi.lengthToThicknessRatio};function zi(r){var n=K(K({},su),r||{});return function(e){We(t,e);function t(){return De(this,t),Ue(this,t,arguments)}return Ge(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ou,FRAGMENT_SHADER_SOURCE:Ii,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:au,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Ot},{name:"a_positionEnd",size:2,type:Ot},{name:"a_normal",size:2,type:Ot},{name:"a_color",size:4,type:Ti,normalized:!0},{name:"a_id",size:4,type:Ti,normalized:!0},{name:"a_radius",size:1,type:Ot}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Ot},{name:"a_normalCoef",size:1,type:Ot},{name:"a_radiusCoef",size:1,type:Ot}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,h,c,p){var m=p.size||1,y=h.x,w=h.y,_=c.x,C=c.y,S=Yt(p.color),L=_-y,U=C-w,z=c.size||1,R=L*L+U*U,D=0,G=0;R&&(R=1/Math.sqrt(R),D=-U*R*m,G=L*R*m);var W=this.array;W[a++]=y,W[a++]=w,W[a++]=_,W[a++]=C,W[a++]=D,W[a++]=G,W[a++]=S,W[a++]=o,W[a++]=z}},{key:"setUniforms",value:function(o,a){var h=a.gl,c=a.uniformLocations,p=c.u_matrix,m=c.u_zoomRatio,y=c.u_feather,w=c.u_pixelRatio,_=c.u_correctionRatio,C=c.u_sizeRatio,S=c.u_minEdgeThickness,L=c.u_lengthToThicknessRatio;h.uniformMatrix3fv(p,!1,o.matrix),h.uniform1f(m,o.zoomRatio),h.uniform1f(C,o.sizeRatio),h.uniform1f(_,o.correctionRatio),h.uniform1f(w,o.pixelRatio),h.uniform1f(y,o.antiAliasingFeather),h.uniform1f(S,o.minEdgeThickness),h.uniform1f(L,n.lengthToThicknessRatio)}}]),t}(gr)}zi();function uu(r){return qs([zi(r),Fi(r)])}var hu=uu(),Ni=hu,cu=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,lu=cu,Ui=WebGLRenderingContext,Ai=Ui.UNSIGNED_BYTE,cn=Ui.FLOAT,du=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Wi=function(r){We(n,r);function n(){return De(this,n),Ue(this,n,arguments)}return Ge(n,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:lu,FRAGMENT_SHADER_SOURCE:Ii,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:du,ATTRIBUTES:[{name:"a_positionStart",size:2,type:cn},{name:"a_positionEnd",size:2,type:cn},{name:"a_normal",size:2,type:cn},{name:"a_color",size:4,type:Ai,normalized:!0},{name:"a_id",size:4,type:Ai,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:cn},{name:"a_normalCoef",size:1,type:cn}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(t,i,o,a,h){var c=h.size||1,p=o.x,m=o.y,y=a.x,w=a.y,_=Yt(h.color),C=y-p,S=w-m,L=C*C+S*S,U=0,z=0;L&&(L=1/Math.sqrt(L),U=-S*L*c,z=C*L*c);var R=this.array;R[i++]=p,R[i++]=m,R[i++]=y,R[i++]=w,R[i++]=U,R[i++]=z,R[i++]=_,R[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,a=i.uniformLocations,h=a.u_matrix,c=a.u_zoomRatio,p=a.u_feather,m=a.u_pixelRatio,y=a.u_correctionRatio,w=a.u_sizeRatio,_=a.u_minEdgeThickness;o.uniformMatrix3fv(h,!1,t.matrix),o.uniform1f(c,t.zoomRatio),o.uniform1f(w,t.sizeRatio),o.uniform1f(y,t.correctionRatio),o.uniform1f(m,t.pixelRatio),o.uniform1f(p,t.antiAliasingFeather),o.uniform1f(_,t.minEdgeThickness)}}]),n}(gr);var Ki=nt(mr()),Rn=function(r){We(n,r);function n(){var e;return De(this,n),e=Ue(this,n),e.rawEmitter=H(e),e}return Ge(n)}(Ki.EventEmitter);var to=nt(zt());var bu=function(n){return n},wu=function(n){return n*n},Eu=function(n){return n*(2-n)},_u=function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)},Su=function(n){return n*n*n},Tu=function(n){return--n*n*n+1},Au=function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},no={linear:bu,quadraticIn:wu,quadraticOut:Eu,quadraticInOut:_u,cubicIn:Su,cubicOut:Tu,cubicInOut:Au},ro={easing:"quadraticInOut",duration:150};function $e(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function kn(r,n,e){return r[0]=n,r[4]=typeof e=="number"?e:n,r}function Ji(r,n){var e=Math.sin(n),t=Math.cos(n);return r[0]=t,r[1]=e,r[3]=-e,r[4]=t,r}function eo(r,n,e){return r[6]=n,r[7]=e,r}function Et(r,n){var e=r[0],t=r[1],i=r[2],o=r[3],a=r[4],h=r[5],c=r[6],p=r[7],m=r[8],y=n[0],w=n[1],_=n[2],C=n[3],S=n[4],L=n[5],U=n[6],z=n[7],R=n[8];return r[0]=y*e+w*o+_*c,r[1]=y*t+w*a+_*p,r[2]=y*i+w*h+_*m,r[3]=C*e+S*o+L*c,r[4]=C*t+S*a+L*p,r[5]=C*i+S*h+L*m,r[6]=U*e+z*o+R*c,r[7]=U*t+z*a+R*p,r[8]=U*i+z*h+R*m,r}function Ln(r,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,t=r[0],i=r[1],o=r[3],a=r[4],h=r[6],c=r[7],p=n.x,m=n.y;return{x:p*t+m*o+h*e,y:p*i+m*a+c*e}}function Cu(r,n){var e=r.height/r.width,t=n.height/n.width;return e<1&&t>1||e>1&&t<1?1:Math.min(Math.max(t,1/t),Math.max(1/e,e))}function Zt(r,n,e,t,i){var o=r.angle,a=r.ratio,h=r.x,c=r.y,p=n.width,m=n.height,y=$e(),w=Math.min(p,m)-2*t,_=Cu(n,e);return i?(Et(y,eo($e(),h,c)),Et(y,kn($e(),a)),Et(y,Ji($e(),o)),Et(y,kn($e(),p/w/2/_,m/w/2/_))):(Et(y,kn($e(),2*(w/p)*_,2*(w/m)*_)),Et(y,Ji($e(),-o)),Et(y,kn($e(),1/a)),Et(y,eo($e(),-h,-c))),y}function io(r,n,e){var t=Ln(r,{x:Math.cos(n.angle),y:Math.sin(n.angle)},0),i=t.x,o=t.y;return 1/Math.sqrt(Math.pow(i,2)+Math.pow(o,2))/e.width}function oo(r){if(!r.order)return{x:[0,1],y:[0,1]};var n=1/0,e=-1/0,t=1/0,i=-1/0;return r.forEachNode(function(o,a){var h=a.x,c=a.y;h<n&&(n=h),h>e&&(e=h),c<t&&(t=c),c>i&&(i=c)}),{x:[n,e],y:[t,i]}}function ao(r){if(!(0,to.default)(r))throw new Error("Sigma: invalid graph instance.");r.forEachNode(function(n,e){if(!Number.isFinite(e.x)||!Number.isFinite(e.y))throw new Error("Sigma: Coordinates of node ".concat(n," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function so(r,n,e){var t=document.createElement(r);if(n)for(var i in n)t.style[i]=n[i];if(e)for(var o in e)t.setAttribute(o,e[o]);return t}function yr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function br(r,n,e){return e.sort(function(t,i){var o=n(t)||0,a=n(i)||0;return o<a?-1:o>a?1:0})}function wr(r){var n=$t(r.x,2),e=n[0],t=n[1],i=$t(r.y,2),o=i[0],a=i[1],h=Math.max(t-e,a-o),c=(t+e)/2,p=(a+o)/2;(h===0||Math.abs(h)===1/0||isNaN(h))&&(h=1),isNaN(c)&&(c=0),isNaN(p)&&(p=0);var m=function(w){return{x:.5+(w.x-c)/h,y:.5+(w.y-p)/h}};return m.applyTo=function(y){y.x=.5+(y.x-c)/h,y.y=.5+(y.y-p)/h},m.inverse=function(y){return{x:c+h*(y.x-.5),y:p+h*(y.y-.5)}},m.ratio=h,m}function Er(r,n){var e=n.size;if(e!==0){var t=r.length;r.length+=e;var i=0;n.forEach(function(o){r[t+i]=o,i++})}}function Dn(r){r=r||{};for(var n=0,e=arguments.length<=1?0:arguments.length-1;n<e;n++){var t=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];t&&Object.assign(r,t)}return r}var Gn={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Li,defaultDrawNodeLabel:pr,defaultDrawNodeHover:Di,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraRotation:!0,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},Ru={circle:ln},ku={arrow:Ni,line:Wi};function _r(r){if(typeof r.labelDensity!="number"||r.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var n=r.minCameraRatio,e=r.maxCameraRatio;if(typeof n=="number"&&typeof e=="number"&&e<n)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function uo(r){var n=Dn({},Gn,r);return n.nodeProgramClasses=Dn({},Ru,n.nodeProgramClasses),n.edgeProgramClasses=Dn({},ku,n.edgeProgramClasses),n}var bl=nt(mr()),wl=nt(zt()),xn=1.5,ho=function(r){We(n,r);function n(){var e;return De(this,n),e=Ue(this,n),B(H(e),"x",.5),B(H(e),"y",.5),B(H(e),"angle",0),B(H(e),"ratio",1),B(H(e),"minRatio",null),B(H(e),"maxRatio",null),B(H(e),"enabledRotation",!0),B(H(e),"nextFrame",null),B(H(e),"previousState",null),B(H(e),"enabled",!0),e.previousState=e.getState(),e}return Ge(n,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(t){return this.x===t.x&&this.y===t.y&&this.ratio===t.ratio&&this.angle===t.angle}},{key:"getPreviousState",value:function(){var t=this.previousState;return t?{x:t.x,y:t.y,angle:t.angle,ratio:t.ratio}:null}},{key:"getBoundedRatio",value:function(t){var i=t;return typeof this.minRatio=="number"&&(i=Math.max(i,this.minRatio)),typeof this.maxRatio=="number"&&(i=Math.min(i,this.maxRatio)),i}},{key:"validateState",value:function(t){var i={};return typeof t.x=="number"&&(i.x=t.x),typeof t.y=="number"&&(i.y=t.y),this.enabledRotation&&typeof t.angle=="number"&&(i.angle=t.angle),typeof t.ratio=="number"&&(i.ratio=this.getBoundedRatio(t.ratio)),i}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(t){if(!this.enabled)return this;this.previousState=this.getState();var i=this.validateState(t);return typeof i.x=="number"&&(this.x=i.x),typeof i.y=="number"&&(this.y=i.y),this.enabledRotation&&typeof i.angle=="number"&&(this.angle=i.angle),typeof i.ratio=="number"&&(this.ratio=i.ratio),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(t){return this.setState(t(this.getState())),this}},{key:"animate",value:function(t){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(_){return i.animate(t,o,_)});if(this.enabled){var h=K(K({},ro),o),c=this.validateState(t),p=typeof h.easing=="function"?h.easing:no[h.easing],m=Date.now(),y=this.getState(),w=function _(){var C=(Date.now()-m)/h.duration;if(C>=1){i.nextFrame=null,i.setState(c),i.animationCallback&&(i.animationCallback.call(null),i.animationCallback=void 0);return}var S=p(C),L={};typeof c.x=="number"&&(L.x=y.x+(c.x-y.x)*S),typeof c.y=="number"&&(L.y=y.y+(c.y-y.y)*S),i.enabledRotation&&typeof c.angle=="number"&&(L.angle=y.angle+(c.angle-y.angle)*S),typeof c.ratio=="number"&&(L.ratio=y.ratio+(c.ratio-y.ratio)*S),i.setState(L),i.nextFrame=requestAnimationFrame(_)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(w)):w(),this.animationCallback=a}}},{key:"animatedZoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio/t}):this.animate({ratio:this.ratio/(t.factor||xn)},t):this.animate({ratio:this.ratio/xn})}},{key:"animatedUnzoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio*t}):this.animate({ratio:this.ratio*(t.factor||xn)},t):this.animate({ratio:this.ratio*xn})}},{key:"animatedReset",value:function(t){return this.animate({x:.5,y:.5,ratio:1,angle:0},t)}},{key:"copy",value:function(){return n.from(this.getState())}}],[{key:"from",value:function(t){var i=new n;return i.setState(t)}}]),n}(Rn);function Je(r,n){var e=n.getBoundingClientRect();return{x:r.clientX-e.left,y:r.clientY-e.top}}function dt(r,n){var e=K(K({},Je(r,n)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0},original:r});return e}function dn(r){var n="x"in r?r:K(K({},r.touches[0]||r.previousTouches[0]),{},{original:r.original,sigmaDefaultPrevented:r.sigmaDefaultPrevented,preventSigmaDefault:function(){r.sigmaDefaultPrevented=!0,n.sigmaDefaultPrevented=!0}});return n}function Lu(r,n){return K(K({},dt(r,n)),{},{delta:vo(r)})}var Du=2;function Pn(r){for(var n=[],e=0,t=Math.min(r.length,Du);e<t;e++)n.push(r[e]);return n}function fn(r,n,e){var t={touches:Pn(r.touches).map(function(i){return Je(i,e)}),previousTouches:n.map(function(i){return Je(i,e)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){t.sigmaDefaultPrevented=!0},original:r};return t}function vo(r){if(typeof r.deltaY<"u")return r.deltaY*-3/360;if(typeof r.detail<"u")return r.detail/-9;throw new Error("Captor: could not extract delta from event.")}var mo=function(r){We(n,r);function n(e,t){var i;return De(this,n),i=Ue(this,n),i.container=e,i.renderer=t,i}return Ge(n)}(Rn),Gu=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],xu=Gu.reduce(function(r,n){return K(K({},r),{},B({},n,Gn[n]))},{}),Pu=function(r){We(n,r);function n(e,t){var i;return De(this,n),i=Ue(this,n,[e,t]),B(H(i),"enabled",!0),B(H(i),"draggedEvents",0),B(H(i),"downStartTime",null),B(H(i),"lastMouseX",null),B(H(i),"lastMouseY",null),B(H(i),"isMouseDown",!1),B(H(i),"isMoving",!1),B(H(i),"movingTimeout",null),B(H(i),"startCameraState",null),B(H(i),"clicks",0),B(H(i),"doubleClickTimeout",null),B(H(i),"currentWheelDirection",0),B(H(i),"settings",xu),i.handleClick=i.handleClick.bind(H(i)),i.handleRightClick=i.handleRightClick.bind(H(i)),i.handleDown=i.handleDown.bind(H(i)),i.handleUp=i.handleUp.bind(H(i)),i.handleMove=i.handleMove.bind(H(i)),i.handleWheel=i.handleWheel.bind(H(i)),i.handleLeave=i.handleLeave.bind(H(i)),i.handleEnter=i.handleEnter.bind(H(i)),e.addEventListener("click",i.handleClick,{capture:!1}),e.addEventListener("contextmenu",i.handleRightClick,{capture:!1}),e.addEventListener("mousedown",i.handleDown,{capture:!1}),e.addEventListener("wheel",i.handleWheel,{capture:!1}),e.addEventListener("mouseleave",i.handleLeave,{capture:!1}),e.addEventListener("mouseenter",i.handleEnter,{capture:!1}),document.addEventListener("mousemove",i.handleMove,{capture:!1}),document.addEventListener("mouseup",i.handleUp,{capture:!1}),i}return Ge(n,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("click",this.handleClick),t.removeEventListener("contextmenu",this.handleRightClick),t.removeEventListener("mousedown",this.handleDown),t.removeEventListener("wheel",this.handleWheel),t.removeEventListener("mouseleave",this.handleLeave),t.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(t){var i=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(t);setTimeout(function(){i.clicks=0,i.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",dt(t,this.container))}}},{key:"handleRightClick",value:function(t){this.enabled&&this.emit("rightClick",dt(t,this.container))}},{key:"handleDoubleClick",value:function(t){if(this.enabled){t.preventDefault(),t.stopPropagation();var i=dt(t,this.container);if(this.emit("doubleClick",i),!i.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(Je(t,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(t){if(this.enabled){if(t.button===0){this.startCameraState=this.renderer.getCamera().getState();var i=Je(t,this.container),o=i.x,a=i.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",dt(t,this.container))}}},{key:"handleUp",value:function(t){var i=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=Je(t,this.container),h=a.x,c=a.y,p=o.getState(),m=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:p.x+this.settings.inertiaRatio*(p.x-m.x),y:p.y+this.settings.inertiaRatio*(p.y-m.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==h||this.lastMouseY!==c)&&o.setState({x:p.x,y:p.y}),this.isMoving=!1,setTimeout(function(){var y=i.draggedEvents>0;i.draggedEvents=0,y&&i.renderer.refresh()},0),this.emit("mouseup",dt(t,this.container))}}},{key:"handleMove",value:function(t){var i=this;if(this.enabled){var o=dt(t,this.container);if(this.emit("mousemovebody",o),(t.target===this.container||t.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.movingTimeout=null,i.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),h=Je(t,this.container),c=h.x,p=h.y,m=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),y=this.renderer.viewportToFramedGraph({x:c,y:p}),w=m.x-y.x,_=m.y-y.y,C=a.getState(),S=C.x+w,L=C.y+_;a.setState({x:S,y:L}),this.lastMouseX=c,this.lastMouseY=p,t.preventDefault(),t.stopPropagation()}}}},{key:"handleLeave",value:function(t){this.emit("mouseleave",dt(t,this.container))}},{key:"handleEnter",value:function(t){this.emit("mouseenter",dt(t,this.container))}},{key:"handleWheel",value:function(t){var i=this;if(this.enabled){t.preventDefault(),t.stopPropagation();var o=vo(t);if(o){var a=Lu(t,this.container);if(this.emit("wheel",a),!a.sigmaDefaultPrevented){var h=o>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=this.renderer.getCamera(),p=c.getBoundedRatio(c.getState().ratio*h),m=o>0?1:-1,y=Date.now();this.currentWheelDirection===m&&this.lastWheelTriggerTime&&y-this.lastWheelTriggerTime<this.settings.zoomDuration/5||(c.animate(this.renderer.getViewportZoomedState(Je(t,this.container),p),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){i.currentWheelDirection=0}),this.currentWheelDirection=m,this.lastWheelTriggerTime=y)}}}}},{key:"setSettings",value:function(t){this.settings=t}}]),n}(mo),Fu=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Iu=Fu.reduce(function(r,n){return K(K({},r),{},B({},n,Gn[n]))},{}),Ou=function(r){We(n,r);function n(e,t){var i;return De(this,n),i=Ue(this,n,[e,t]),B(H(i),"enabled",!0),B(H(i),"isMoving",!1),B(H(i),"hasMoved",!1),B(H(i),"touchMode",0),B(H(i),"startTouchesPositions",[]),B(H(i),"lastTouches",[]),B(H(i),"lastTap",null),B(H(i),"settings",Iu),i.handleStart=i.handleStart.bind(H(i)),i.handleLeave=i.handleLeave.bind(H(i)),i.handleMove=i.handleMove.bind(H(i)),e.addEventListener("touchstart",i.handleStart,{capture:!1}),e.addEventListener("touchcancel",i.handleLeave,{capture:!1}),document.addEventListener("touchend",i.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",i.handleMove,{capture:!1,passive:!1}),i}return Ge(n,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(t){var i=this;if(this.enabled){t.preventDefault();var o=Pn(t.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(_){return Je(_,i.container)}),this.touchMode===2){var a=$t(this.startTouchesPositions,2),h=a[0],c=h.x,p=h.y,m=a[1],y=m.x,w=m.y;this.startTouchesAngle=Math.atan2(w-p,y-c),this.startTouchesDistance=Math.sqrt(Math.pow(y-c,2)+Math.pow(w-p,2))}this.emit("touchdown",fn(t,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(t){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(t.cancelable&&t.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(t.touches.length===1){this.handleStart(t),t.preventDefault();break}case 1:if(this.isMoving){var i=this.renderer.getCamera(),o=i.getState(),a=i.getPreviousState()||{x:0,y:0};i.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",fn(t,this.lastTouches,this.container)),!t.touches.length){var h=Je(this.lastTouches[0],this.container),c=this.startTouchesPositions[0],p=Math.pow(h.x-c.x,2)+Math.pow(h.y-c.y,2);if(!t.touches.length&&p<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var m=fn(t,this.lastTouches,this.container);if(this.emit("doubletap",m),this.lastTap=null,!m.sigmaDefaultPrevented){var y=this.renderer.getCamera(),w=y.getBoundedRatio(y.getState().ratio/this.settings.doubleClickZoomingRatio);y.animate(this.renderer.getViewportZoomedState(h,w),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var _=fn(t,this.lastTouches,this.container);this.emit("tap",_),this.lastTap={time:Date.now(),position:_.touches[0]||_.previousTouches[0]}}}this.lastTouches=Pn(t.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(t){var i=this;if(!(!this.enabled||!this.startTouchesPositions.length)){t.preventDefault();var o=Pn(t.touches),a=o.map(function(j){return Je(j,i.container)}),h=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var c=fn(t,h,this.container);if(this.emit("touchmove",c),!c.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(j,k){var ne=i.startTouchesPositions[k];return ne&&(j.x!==ne.x||j.y!==ne.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.isMoving=!1},this.settings.dragTimeout);var p=this.renderer.getCamera(),m=this.startCameraState,y=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var w=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),_=w.x,C=w.y,S=this.renderer.viewportToFramedGraph(a[0]),L=S.x,U=S.y;p.setState({x:m.x+_-L,y:m.y+C-U});break}case 2:{var z={x:.5,y:.5,angle:0,ratio:1},R=a[0],D=R.x,G=R.y,W=a[1],P=W.x,M=W.y,T=Math.atan2(M-G,P-D)-this.startTouchesAngle,Q=Math.hypot(M-G,P-D)/this.startTouchesDistance,se=p.getBoundedRatio(m.ratio/Q);z.ratio=se,z.angle=m.angle+T;var te=this.getDimensions(),me=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:m}),X=Math.min(te.width,te.height)-2*y,ce=X/te.width,pe=X/te.height,Y=se/X,A=D-X/2/ce,Te=G-X/2/pe,be=[A*Math.cos(-z.angle)-Te*Math.sin(-z.angle),Te*Math.cos(-z.angle)+A*Math.sin(-z.angle)];A=be[0],Te=be[1],z.x=me.x-A*Y,z.y=me.y+Te*Y,p.setState(z);break}}}}}},{key:"setSettings",value:function(t){this.settings=t}}]),n}(mo);function zu(r){if(Array.isArray(r))return Sn(r)}function Nu(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Uu(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function co(r){return zu(r)||Nu(r)||sr(r)||Uu()}function Wu(r,n){if(r==null)return{};var e={};for(var t in r)if({}.hasOwnProperty.call(r,t)){if(n.includes(t))continue;e[t]=r[t]}return e}function Sr(r,n){if(r==null)return{};var e,t,i=Wu(r,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(t=0;t<o.length;t++)e=o[t],n.includes(e)||{}.propertyIsEnumerable.call(r,e)&&(i[e]=r[e])}return i}var lo=function(){function r(n,e){De(this,r),this.key=n,this.size=e}return Ge(r,null,[{key:"compare",value:function(e,t){return e.size>t.size?-1:e.size<t.size||e.key>t.key?1:-1}}]),r}(),fo=function(){function r(){De(this,r),B(this,"width",0),B(this,"height",0),B(this,"cellSize",0),B(this,"columns",0),B(this,"rows",0),B(this,"cells",{})}return Ge(r,[{key:"resizeAndClear",value:function(e,t){this.width=e.width,this.height=e.height,this.cellSize=t,this.columns=Math.ceil(e.width/t),this.rows=Math.ceil(e.height/t),this.cells={}}},{key:"getIndex",value:function(e){var t=Math.floor(e.x/this.cellSize),i=Math.floor(e.y/this.cellSize);return i*this.columns+t}},{key:"add",value:function(e,t,i){var o=new lo(e,t),a=this.getIndex(i),h=this.cells[a];h||(h=[],this.cells[a]=h),h.push(o)}},{key:"organize",value:function(){for(var e in this.cells){var t=this.cells[e];t.sort(lo.compare)}}},{key:"getLabelsToDisplay",value:function(e,t){var i=this.cellSize*this.cellSize,o=i/e/e,a=o*t/i,h=Math.ceil(a),c=[];for(var p in this.cells)for(var m=this.cells[p],y=0;y<Math.min(h,m.length);y++)c.push(m[y].key);return c}}]),r}();function Bu(r){var n=r.graph,e=r.hoveredNode,t=r.highlightedNodes,i=r.displayedNodeLabels,o=[];return n.forEachEdge(function(a,h,c,p){(c===e||p===e||t.has(c)||t.has(p)||i.has(c)&&i.has(p))&&o.push(a)}),o}var go=150,po=50,ft=Object.prototype.hasOwnProperty;function Mu(r,n,e){if(!ft.call(e,"x")||!ft.call(e,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(n,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return e.color||(e.color=r.defaultNodeColor),!e.label&&e.label!==""&&(e.label=null),e.label!==void 0&&e.label!==null?e.label=""+e.label:e.label=null,e.size||(e.size=2),ft.call(e,"hidden")||(e.hidden=!1),ft.call(e,"highlighted")||(e.highlighted=!1),ft.call(e,"forceLabel")||(e.forceLabel=!1),(!e.type||e.type==="")&&(e.type=r.defaultNodeType),e.zIndex||(e.zIndex=0),e}function ju(r,n,e){return e.color||(e.color=r.defaultEdgeColor),e.label||(e.label=""),e.size||(e.size=.5),ft.call(e,"hidden")||(e.hidden=!1),ft.call(e,"forceLabel")||(e.forceLabel=!1),(!e.type||e.type==="")&&(e.type=r.defaultEdgeType),e.zIndex||(e.zIndex=0),e}var Hu=function(r){We(n,r);function n(e,t){var i,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(De(this,n),i=Ue(this,n),B(H(i),"elements",{}),B(H(i),"canvasContexts",{}),B(H(i),"webGLContexts",{}),B(H(i),"pickingLayers",new Set),B(H(i),"textures",{}),B(H(i),"frameBuffers",{}),B(H(i),"activeListeners",{}),B(H(i),"labelGrid",new fo),B(H(i),"nodeDataCache",{}),B(H(i),"edgeDataCache",{}),B(H(i),"nodeProgramIndex",{}),B(H(i),"edgeProgramIndex",{}),B(H(i),"nodesWithForcedLabels",new Set),B(H(i),"edgesWithForcedLabels",new Set),B(H(i),"nodeExtent",{x:[0,1],y:[0,1]}),B(H(i),"nodeZExtent",[1/0,-1/0]),B(H(i),"edgeZExtent",[1/0,-1/0]),B(H(i),"matrix",$e()),B(H(i),"invMatrix",$e()),B(H(i),"correctionRatio",1),B(H(i),"customBBox",null),B(H(i),"normalizationFunction",wr({x:[0,1],y:[0,1]})),B(H(i),"graphToViewportRatio",1),B(H(i),"itemIDsIndex",{}),B(H(i),"nodeIndices",{}),B(H(i),"edgeIndices",{}),B(H(i),"width",0),B(H(i),"height",0),B(H(i),"pixelRatio",yr()),B(H(i),"pickingDownSizingRatio",2*i.pixelRatio),B(H(i),"displayedNodeLabels",new Set),B(H(i),"displayedEdgeLabels",new Set),B(H(i),"highlightedNodes",new Set),B(H(i),"hoveredNode",null),B(H(i),"hoveredEdge",null),B(H(i),"renderFrame",null),B(H(i),"renderHighlightedNodesFrame",null),B(H(i),"needToProcess",!1),B(H(i),"checkEdgesEventsFrame",null),B(H(i),"nodePrograms",{}),B(H(i),"nodeHoverPrograms",{}),B(H(i),"edgePrograms",{}),i.settings=uo(o),_r(i.settings),ao(e),!(t instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");i.graph=e,i.container=t,i.createWebGLContext("edges",{picking:o.enableEdgeEvents}),i.createCanvasContext("edgeLabels"),i.createWebGLContext("nodes",{picking:!0}),i.createCanvasContext("labels"),i.createCanvasContext("hovers"),i.createWebGLContext("hoverNodes"),i.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),i.resize();for(var a in i.settings.nodeProgramClasses)i.registerNodeProgram(a,i.settings.nodeProgramClasses[a],i.settings.nodeHoverProgramClasses[a]);for(var h in i.settings.edgeProgramClasses)i.registerEdgeProgram(h,i.settings.edgeProgramClasses[h]);return i.camera=new ho,i.bindCameraHandlers(),i.mouseCaptor=new Pu(i.elements.mouse,H(i)),i.mouseCaptor.setSettings(i.settings),i.touchCaptor=new Ou(i.elements.mouse,H(i)),i.touchCaptor.setSettings(i.settings),i.bindEventHandlers(),i.bindGraphHandlers(),i.handleSettingsUpdate(),i.refresh(),i}return Ge(n,[{key:"registerNodeProgram",value:function(t,i,o){return this.nodePrograms[t]&&this.nodePrograms[t].kill(),this.nodeHoverPrograms[t]&&this.nodeHoverPrograms[t].kill(),this.nodePrograms[t]=new i(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[t]=new(o||i)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(t,i){return this.edgePrograms[t]&&this.edgePrograms[t].kill(),this.edgePrograms[t]=new i(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(t){if(this.nodePrograms[t]){var i=this.nodePrograms,o=i[t],a=Sr(i,[t].map(It));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[t]){var h=this.nodeHoverPrograms,c=h[t],p=Sr(h,[t].map(It));c.kill(),this.nodePrograms=p}return this}},{key:"unregisterEdgeProgram",value:function(t){if(this.edgePrograms[t]){var i=this.edgePrograms,o=i[t],a=Sr(i,[t].map(It));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(t){var i=this.webGLContexts[t],o=this.frameBuffers[t],a=this.textures[t];a&&i.deleteTexture(a);var h=i.createTexture();return i.bindFramebuffer(i.FRAMEBUFFER,o),i.bindTexture(i.TEXTURE_2D,h),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,h,0),this.textures[t]=h,this}},{key:"bindCameraHandlers",value:function(){var t=this;return this.activeListeners.camera=function(){t.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(t){var i=t.x,o=t.y,a=cr(this.webGLContexts.nodes,this.frameBuffers.nodes,i,o,this.pixelRatio,this.pickingDownSizingRatio),h=hr.apply(void 0,co(a)),c=this.itemIDsIndex[h];return c&&c.type==="node"?c.id:null}},{key:"bindEventHandlers",value:function(){var t=this;this.activeListeners.handleResize=function(){t.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=dn(o),h={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},c=t.getNodeAtPosition(a);if(c&&t.hoveredNode!==c&&!t.nodeDataCache[c].hidden){t.hoveredNode&&t.emit("leaveNode",K(K({},h),{},{node:t.hoveredNode})),t.hoveredNode=c,t.emit("enterNode",K(K({},h),{},{node:c})),t.scheduleHighlightedNodesRender();return}if(t.hoveredNode&&t.getNodeAtPosition(a)!==t.hoveredNode){var p=t.hoveredNode;t.hoveredNode=null,t.emit("leaveNode",K(K({},h),{},{node:p})),t.scheduleHighlightedNodesRender();return}if(t.settings.enableEdgeEvents){var m=t.hoveredNode?null:t.getEdgeAtPoint(h.event.x,h.event.y);m!==t.hoveredEdge&&(t.hoveredEdge&&t.emit("leaveEdge",K(K({},h),{},{edge:t.hoveredEdge})),m&&t.emit("enterEdge",K(K({},h),{},{edge:m})),t.hoveredEdge=m)}},this.activeListeners.handleMoveBody=function(o){var a=dn(o);t.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=dn(o),h={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};t.hoveredNode&&(t.emit("leaveNode",K(K({},h),{},{node:t.hoveredNode})),t.scheduleHighlightedNodesRender()),t.settings.enableEdgeEvents&&t.hoveredEdge&&(t.emit("leaveEdge",K(K({},h),{},{edge:t.hoveredEdge})),t.scheduleHighlightedNodesRender()),t.emit("leaveStage",K({},h))},this.activeListeners.handleEnter=function(o){var a=dn(o),h={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};t.emit("enterStage",K({},h))};var i=function(a){return function(h){var c=dn(h),p={event:c,preventSigmaDefault:function(){c.preventSigmaDefault()}},m=t.getNodeAtPosition(c);if(m)return t.emit("".concat(a,"Node"),K(K({},p),{},{node:m}));if(t.settings.enableEdgeEvents){var y=t.getEdgeAtPoint(c.x,c.y);if(y)return t.emit("".concat(a,"Edge"),K(K({},p),{},{edge:y}))}return t.emit("".concat(a,"Stage"),p)}};return this.activeListeners.handleClick=i("click"),this.activeListeners.handleRightClick=i("rightClick"),this.activeListeners.handleDoubleClick=i("doubleClick"),this.activeListeners.handleWheel=i("wheel"),this.activeListeners.handleDown=i("down"),this.activeListeners.handleUp=i("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var t=this,i=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var h,c=(h=a.hints)===null||h===void 0?void 0:h.attributes;t.graph.forEachNode(function(m){return t.updateNode(m)});var p=!c||c.some(function(m){return o.has(m)});t.refresh({partialGraph:{nodes:i.nodes()},skipIndexation:!p,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var h,c=(h=a.hints)===null||h===void 0?void 0:h.attributes;t.graph.forEachEdge(function(m){return t.updateEdge(m)});var p=c&&["zIndex","type"].some(function(m){return c?.includes(m)});t.refresh({partialGraph:{edges:i.edges()},skipIndexation:!p,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var h=a.key;t.addNode(h),t.refresh({partialGraph:{nodes:[h]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var h=a.key;t.refresh({partialGraph:{nodes:[h]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var h=a.key;t.removeNode(h),t.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var h=a.key;t.addEdge(h),t.refresh({partialGraph:{edges:[h]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var h=a.key;t.refresh({partialGraph:{edges:[h]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var h=a.key;t.removeEdge(h),t.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){t.clearEdgeState(),t.clearEdgeIndices(),t.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){t.clearEdgeState(),t.clearNodeState(),t.clearEdgeIndices(),t.clearNodeIndices(),t.refresh({schedule:!0})},i.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var t=this.graph;t.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),t.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),t.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),t.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),t.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),t.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),t.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),t.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),t.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),t.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(t,i){var o=cr(this.webGLContexts.edges,this.frameBuffers.edges,t,i,this.pixelRatio,this.pickingDownSizingRatio),a=hr.apply(void 0,co(o)),h=this.itemIDsIndex[a];return h&&h.type==="edge"?h.id:null}},{key:"process",value:function(){var t=this;this.emit("beforeProcess");var i=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=oo(this.graph),!this.settings.autoRescale){var h=a.width,c=a.height,p=this.nodeExtent,m=p.x,y=p.y;this.nodeExtent={x:[(m[0]+m[1])/2-h/2,(m[0]+m[1])/2+h/2],y:[(y[0]+y[1])/2-c/2,(y[0]+y[1])/2+c/2]}}this.normalizationFunction=wr(this.customBBox||this.nodeExtent);var w=new ho,_=Zt(w.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var C={},S={},L={},U={},z=1,R=i.nodes(),D=0,G=R.length;D<G;D++){var W=R[D],P=this.nodeDataCache[W],M=i.getNodeAttributes(W);P.x=M.x,P.y=M.y,this.normalizationFunction.applyTo(P),typeof P.label=="string"&&!P.hidden&&this.labelGrid.add(W,P.size,this.framedGraphToViewport(P,{matrix:_})),C[P.type]=(C[P.type]||0)+1}this.labelGrid.organize();for(var T in this.nodePrograms){if(!ft.call(this.nodePrograms,T))throw new Error('Sigma: could not find a suitable program for node type "'.concat(T,'"!'));this.nodePrograms[T].reallocate(C[T]||0),C[T]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(R=br(this.nodeZExtent,function(Ie){return t.nodeDataCache[Ie].zIndex},R));for(var Q=0,se=R.length;Q<se;Q++){var te=R[Q];S[te]=z,U[S[te]]={type:"node",id:te},z++;var me=this.nodeDataCache[te];this.addNodeToProgram(te,S[te],C[me.type]++)}for(var X={},ce=i.edges(),pe=0,Y=ce.length;pe<Y;pe++){var A=ce[pe],Te=this.edgeDataCache[A];X[Te.type]=(X[Te.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(ce=br(this.edgeZExtent,function(Ie){return t.edgeDataCache[Ie].zIndex},ce));for(var be in this.edgePrograms){if(!ft.call(this.edgePrograms,be))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(be,'"!'));this.edgePrograms[be].reallocate(X[be]||0),X[be]=0}for(var j=0,k=ce.length;j<k;j++){var ne=ce[j];L[ne]=z,U[L[ne]]={type:"edge",id:ne},z++;var he=this.edgeDataCache[ne];this.addEdgeToProgram(ne,L[ne],X[he.type]++)}return this.itemIDsIndex=U,this.nodeIndices=S,this.edgeIndices=L,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(t){var i=this.settings;if(this.camera.minRatio=i.minCameraRatio,this.camera.maxRatio=i.maxCameraRatio,this.camera.enabledRotation=i.enableCameraRotation,this.camera.setState(this.camera.validateState(this.camera.getState())),t){if(t.edgeProgramClasses!==i.edgeProgramClasses){for(var o in i.edgeProgramClasses)i.edgeProgramClasses[o]!==t.edgeProgramClasses[o]&&this.registerEdgeProgram(o,i.edgeProgramClasses[o]);for(var a in t.edgeProgramClasses)i.edgeProgramClasses[a]||this.unregisterEdgeProgram(a)}if(t.nodeProgramClasses!==i.nodeProgramClasses||t.nodeHoverProgramClasses!==i.nodeHoverProgramClasses){for(var h in i.nodeProgramClasses)(i.nodeProgramClasses[h]!==t.nodeProgramClasses[h]||i.nodeHoverProgramClasses[h]!==t.nodeHoverProgramClasses[h])&&this.registerNodeProgram(h,i.nodeProgramClasses[h],i.nodeHoverProgramClasses[h]);for(var c in t.nodeProgramClasses)i.nodeProgramClasses[c]||this.unregisterNodeProgram(c)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var t=this.camera.getState(),i=this.labelGrid.getLabelsToDisplay(t.ratio,this.settings.labelDensity);Er(i,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,h=i.length;a<h;a++){var c=i[a],p=this.nodeDataCache[c];if(!this.displayedNodeLabels.has(c)&&!p.hidden){var m=this.framedGraphToViewport(p),y=m.x,w=m.y,_=this.scaleSize(p.size);if(!(!p.forceLabel&&_<this.settings.labelRenderedSizeThreshold)&&!(y<-go||y>this.width+go||w<-po||w>this.height+po)){this.displayedNodeLabels.add(c);var C=this.settings.defaultDrawNodeLabel,S=this.nodePrograms[p.type],L=S?.drawLabel||C;L(o,K(K({key:c},p),{},{size:_,x:y,y:w}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var t=this.canvasContexts.edgeLabels;t.clearRect(0,0,this.width,this.height);var i=Bu({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});Er(i,this.edgesWithForcedLabels);for(var o=new Set,a=0,h=i.length;a<h;a++){var c=i[a],p=this.graph.extremities(c),m=this.nodeDataCache[p[0]],y=this.nodeDataCache[p[1]],w=this.edgeDataCache[c];if(!o.has(c)&&!(w.hidden||m.hidden||y.hidden)){var _=this.settings.defaultDrawEdgeLabel,C=this.edgePrograms[w.type],S=C?.drawLabel||_;S(t,K(K({key:c},w),{},{size:this.scaleSize(w.size)}),K(K(K({key:p[0]},m),this.framedGraphToViewport(m)),{},{size:this.scaleSize(m.size)}),K(K(K({key:p[1]},y),this.framedGraphToViewport(y)),{},{size:this.scaleSize(y.size)}),this.settings),o.add(c)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var t=this,i=this.canvasContexts.hovers;i.clearRect(0,0,this.width,this.height);var o=function(_){var C=t.nodeDataCache[_],S=t.framedGraphToViewport(C),L=S.x,U=S.y,z=t.scaleSize(C.size),R=t.settings.defaultDrawNodeHover,D=t.nodePrograms[C.type],G=D?.drawHover||R;G(i,K(K({key:_},C),{},{size:z,x:L,y:U}),t.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(w){w!==t.hoveredNode&&a.push(w)}),a.forEach(function(w){return o(w)});var h={};a.forEach(function(w){var _=t.nodeDataCache[w].type;h[_]=(h[_]||0)+1});for(var c in this.nodeHoverPrograms)this.nodeHoverPrograms[c].reallocate(h[c]||0),h[c]=0;a.forEach(function(w){var _=t.nodeDataCache[w];t.nodeHoverPrograms[_.type].process(0,h[_.type]++,_)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var p=this.getRenderParams();for(var m in this.nodeHoverPrograms){var y=this.nodeHoverPrograms[m];y.render(p)}}},{key:"scheduleHighlightedNodesRender",value:function(){var t=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){t.renderHighlightedNodesFrame=null,t.renderHighlightedNodes(),t.renderEdgeLabels()}))}},{key:"render",value:function(){var t=this;this.emit("beforeRender");var i=function(){return t.emit("afterRender"),t};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(L){return t.resetWebGLTexture(L)}),!this.graph.order)return i();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,h=this.camera.getState(),c=this.getDimensions(),p=this.getGraphDimensions(),m=this.getStagePadding();this.matrix=Zt(h,c,p,m),this.invMatrix=Zt(h,c,p,m,!0),this.correctionRatio=io(this.matrix,h,c),this.graphToViewportRatio=this.getGraphToViewportRatio();var y=this.getRenderParams();for(var w in this.nodePrograms){var _=this.nodePrograms[w];_.render(y)}if(!this.settings.hideEdgesOnMove||!a)for(var C in this.edgePrograms){var S=this.edgePrograms[C];S.render(y)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),i()}},{key:"addNode",value:function(t){var i=Object.assign({},this.graph.getNodeAttributes(t));this.settings.nodeReducer&&(i=this.settings.nodeReducer(t,i));var o=Mu(this.settings,t,i);this.nodeDataCache[t]=o,this.nodesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(t),this.highlightedNodes.delete(t),o.highlighted&&!o.hidden&&this.highlightedNodes.add(t),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(t){this.addNode(t);var i=this.nodeDataCache[t];this.normalizationFunction.applyTo(i)}},{key:"removeNode",value:function(t){delete this.nodeDataCache[t],delete this.nodeProgramIndex[t],this.highlightedNodes.delete(t),this.hoveredNode===t&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(t)}},{key:"addEdge",value:function(t){var i=Object.assign({},this.graph.getEdgeAttributes(t));this.settings.edgeReducer&&(i=this.settings.edgeReducer(t,i));var o=ju(this.settings,t,i);this.edgeDataCache[t]=o,this.edgesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(t),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(t){this.addEdge(t)}},{key:"removeEdge",value:function(t){delete this.edgeDataCache[t],delete this.edgeProgramIndex[t],this.hoveredEdge===t&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(t)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new fo,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0]}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(t,i,o){var a=this.nodeDataCache[t],h=this.nodePrograms[a.type];if(!h)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));h.process(i,o,a),this.nodeProgramIndex[t]=o}},{key:"addEdgeToProgram",value:function(t,i,o){var a=this.edgeDataCache[t],h=this.edgePrograms[a.type];if(!h)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var c=this.graph.extremities(t),p=this.nodeDataCache[c[0]],m=this.nodeDataCache[c[1]];h.process(i,o,p,m,a),this.edgeProgramIndex[t]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var t=this.settings,i=t.stagePadding,o=t.autoRescale;return o&&i||0}},{key:"createCanvas",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.elements[t])throw new Error('Sigma: a layer named "'.concat(t,'" already exists'));var o=so("canvas",{position:"absolute"},{class:"sigma-".concat(t)});return i.style&&Object.assign(o.style,i.style),this.elements[t]=o,"beforeLayer"in i&&i.beforeLayer?this.elements[i.beforeLayer].before(o):"afterLayer"in i&&i.afterLayer?this.elements[i.afterLayer].after(o):this.container.appendChild(o),o}},{key:"createCanvasContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(t,i),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[t]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i?.canvas||this.createCanvas(t,i);i.hidden&&o.remove();var a=K({preserveDrawingBuffer:!1,antialias:!1},i),h;h=o.getContext("webgl2",a),h||(h=o.getContext("webgl",a)),h||(h=o.getContext("experimental-webgl",a));var c=h;if(this.webGLContexts[t]=c,c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),i.picking){this.pickingLayers.add(t);var p=c.createFramebuffer();if(!p)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(t));this.frameBuffers[t]=p}return c}},{key:"killLayer",value:function(t){var i=this.elements[t];if(!i)throw new Error("Sigma: cannot kill layer ".concat(t,", which does not exist"));if(this.webGLContexts[t]){var o,a=this.webGLContexts[t];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[t]}else delete this.canvasContexts[t];return i.remove(),delete this.elements[t],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(t){this.unbindCameraHandlers(),this.camera=t,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(t){t!==this.graph&&(this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=t,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var t=this.customBBox||this.nodeExtent;return{width:t.x[1]-t.x[0]||1,height:t.y[1]-t.y[0]||1}}},{key:"getNodeDisplayData",value:function(t){var i=this.nodeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getEdgeDisplayData",value:function(t){var i=this.edgeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return K({},this.settings)}},{key:"getSetting",value:function(t){return this.settings[t]}},{key:"setSetting",value:function(t,i){var o=K({},this.settings);return this.settings[t]=i,_r(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(t,i){return this.setSetting(t,i(this.settings[t])),this}},{key:"resize",value:function(t){var i=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=yr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!t&&i===this.width&&o===this.height)return this;this.emit("resize");for(var a in this.elements){var h=this.elements[a];h.style.width=this.width+"px",h.style.height=this.height+"px"}for(var c in this.canvasContexts)this.elements[c].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[c].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[c].scale(this.pixelRatio,this.pixelRatio);for(var p in this.webGLContexts){this.elements[p].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[p].setAttribute("height",this.height*this.pixelRatio+"px");var m=this.webGLContexts[p];if(m.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(p)){var y=this.textures[p];y&&m.deleteTexture(y)}}return this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(t){var i=this,o=t?.skipIndexation!==void 0?t?.skipIndexation:!1,a=t?.schedule!==void 0?t.schedule:!1,h=!t||!t.partialGraph;if(h)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(D){return i.addNode(D)}),this.graph.forEachEdge(function(D){return i.addEdge(D)});else{for(var c,p,m=((c=t.partialGraph)===null||c===void 0?void 0:c.nodes)||[],y=0,w=m?.length||0;y<w;y++){var _=m[y];if(this.updateNode(_),o){var C=this.nodeProgramIndex[_];if(C===void 0)throw new Error('Sigma: node "'.concat(_,`" can't be repaint`));this.addNodeToProgram(_,this.nodeIndices[_],C)}}for(var S=(t==null||(p=t.partialGraph)===null||p===void 0?void 0:p.edges)||[],L=0,U=S.length;L<U;L++){var z=S[L];if(this.updateEdge(z),o){var R=this.edgeProgramIndex[z];if(R===void 0)throw new Error('Sigma: edge "'.concat(z,`" can't be repaint`));this.addEdgeToProgram(z,this.edgeIndices[z],R)}}}return(h||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var t=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){t.render()})),this}},{key:"scheduleRefresh",value:function(t){return this.refresh(K(K({},t),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(t,i){var o=this.camera.getState(),a=o.ratio,h=o.angle,c=o.x,p=o.y,m=this.settings,y=m.minCameraRatio,w=m.maxCameraRatio;typeof w=="number"&&(i=Math.min(i,w)),typeof y=="number"&&(i=Math.max(i,y));var _=i/a,C={x:this.width/2,y:this.height/2},S=this.viewportToFramedGraph(t),L=this.viewportToFramedGraph(C);return{angle:h,x:(S.x-L.x)*(1-_)+c,y:(S.y-L.y)*(1-_)+p,ratio:i}}},{key:"viewRectangle",value:function(){var t=this.viewportToFramedGraph({x:0,y:0}),i=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:t.x,y1:t.y,x2:i.x,y2:i.y,height:i.y-o.y}}},{key:"framedGraphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!!i.graphDimensions,a=i.matrix?i.matrix:o?Zt(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding()):this.matrix,h=Ln(a,t);return{x:(1+h.x)*this.width/2,y:(1-h.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!i.graphDimensions,a=i.matrix?i.matrix:o?Zt(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding(),!0):this.invMatrix,h=Ln(a,{x:t.x/this.width*2-1,y:1-t.y/this.height*2});return isNaN(h.x)&&(h.x=0),isNaN(h.y)&&(h.y=0),h}},{key:"viewportToGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(t,i))}},{key:"graphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(t),i)}},{key:"getGraphToViewportRatio",value:function(){var t={x:0,y:0},i={x:1,y:1},o=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),a=this.graphToViewport(t),h=this.graphToViewport(i),c=Math.sqrt(Math.pow(a.x-h.x,2)+Math.pow(a.y-h.y,2));return c/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(t){return this.customBBox=t,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var t=this.container;t.firstChild;)t.removeChild(t.firstChild);this.canvasContexts={},this.webGLContexts={},this.elements={};for(var i in this.nodePrograms)this.nodePrograms[i].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var h in this.elements)this.killLayer(h)}},{key:"scaleSize",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return t/this.settings.zoomToSizeRatioFunction(i)*(this.getSetting("itemSizesReference")==="positions"?i*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){return K({},this.elements)}}]),n}(Rn),yo=Hu;var Zn=nt(bo()),qa=nt(Do()),$a=nt(Fo()),Ya=nt(oa()),Xa=nt(wa());var Ba=nt(Pa(),1);var mn=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")};var oc={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},yn=r=>r.replace(/[[\]\\-]/g,"\\$&"),ac=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Fa=r=>r.join(""),Ia=(r,n)=>{let e=n;if(r.charAt(e)!=="[")throw new Error("not in a brace expression");let t=[],i=[],o=e+1,a=!1,h=!1,c=!1,p=!1,m=e,y="";e:for(;o<r.length;){let S=r.charAt(o);if((S==="!"||S==="^")&&o===e+1){p=!0,o++;continue}if(S==="]"&&a&&!c){m=o+1;break}if(a=!0,S==="\\"&&!c){c=!0,o++;continue}if(S==="["&&!c){for(let[L,[U,z,R]]of Object.entries(oc))if(r.startsWith(L,o)){if(y)return["$.",!1,r.length-e,!0];o+=L.length,R?i.push(U):t.push(U),h=h||z;continue e}}if(c=!1,y){S>y?t.push(yn(y)+"-"+yn(S)):S===y&&t.push(yn(S)),y="",o++;continue}if(r.startsWith("-]",o+1)){t.push(yn(S+"-")),o+=2;continue}if(r.startsWith("-",o+1)){y=S,o+=2;continue}t.push(yn(S)),o++}if(m<o)return["",!1,0,!1];if(!t.length&&!i.length)return["$.",!1,r.length-e,!0];if(i.length===0&&t.length===1&&/^\\?.$/.test(t[0])&&!p){let S=t[0].length===2?t[0].slice(-1):t[0];return[ac(S),!1,m-e,!1]}let w="["+(p?"^":"")+Fa(t)+"]",_="["+(p?"":"^")+Fa(i)+"]";return[t.length&&i.length?"("+w+"|"+_+")":t.length?w:_,h,m-e,!0]};var kt=(r,{windowsPathsNoEscape:n=!1}={})=>n?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var sc=new Set(["!","?","+","*","@"]),Oa=r=>sc.has(r),uc="(?!(?:^|/)\\.\\.?(?:$|/))",Mn="(?!\\.)",hc=new Set(["[","."]),cc=new Set(["..","."]),lc=new Set("().*{}+?[]^$\\!"),dc=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Hr="[^/]",za=Hr+"*?",Na=Hr+"+?",en=class r{type;#n;#r;#o=!1;#e=[];#t;#a;#u;#s=!1;#i;#h;#l=!1;constructor(n,e,t={}){this.type=n,n&&(this.#r=!0),this.#t=e,this.#n=this.#t?this.#t.#n:this,this.#i=this.#n===this?t:this.#n.#i,this.#u=this.#n===this?[]:this.#n.#u,n==="!"&&!this.#n.#s&&this.#u.push(this),this.#a=this.#t?this.#t.#e.length:0}get hasMagic(){if(this.#r!==void 0)return this.#r;for(let n of this.#e)if(typeof n!="string"&&(n.type||n.hasMagic))return this.#r=!0;return this.#r}toString(){return this.#h!==void 0?this.#h:this.type?this.#h=this.type+"("+this.#e.map(n=>String(n)).join("|")+")":this.#h=this.#e.map(n=>String(n)).join("")}#f(){if(this!==this.#n)throw new Error("should only call on root");if(this.#s)return this;this.toString(),this.#s=!0;let n;for(;n=this.#u.pop();){if(n.type!=="!")continue;let e=n,t=e.#t;for(;t;){for(let i=e.#a+1;!t.type&&i<t.#e.length;i++)for(let o of n.#e){if(typeof o=="string")throw new Error("string part in extglob AST??");o.copyIn(t.#e[i])}e=t,t=e.#t}}return this}push(...n){for(let e of n)if(e!==""){if(typeof e!="string"&&!(e instanceof r&&e.#t===this))throw new Error("invalid part: "+e);this.#e.push(e)}}toJSON(){let n=this.type===null?this.#e.slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...this.#e.map(e=>e.toJSON())];return this.isStart()&&!this.type&&n.unshift([]),this.isEnd()&&(this===this.#n||this.#n.#s&&this.#t?.type==="!")&&n.push({}),n}isStart(){if(this.#n===this)return!0;if(!this.#t?.isStart())return!1;if(this.#a===0)return!0;let n=this.#t;for(let e=0;e<this.#a;e++){let t=n.#e[e];if(!(t instanceof r&&t.type==="!"))return!1}return!0}isEnd(){if(this.#n===this||this.#t?.type==="!")return!0;if(!this.#t?.isEnd())return!1;if(!this.type)return this.#t?.isEnd();let n=this.#t?this.#t.#e.length:0;return this.#a===n-1}copyIn(n){typeof n=="string"?this.push(n):this.push(n.clone(this))}clone(n){let e=new r(this.type,n);for(let t of this.#e)e.copyIn(t);return e}static#c(n,e,t,i){let o=!1,a=!1,h=-1,c=!1;if(e.type===null){let _=t,C="";for(;_<n.length;){let S=n.charAt(_++);if(o||S==="\\"){o=!o,C+=S;continue}if(a){_===h+1?(S==="^"||S==="!")&&(c=!0):S==="]"&&!(_===h+2&&c)&&(a=!1),C+=S;continue}else if(S==="["){a=!0,h=_,c=!1,C+=S;continue}if(!i.noext&&Oa(S)&&n.charAt(_)==="("){e.push(C),C="";let L=new r(S,e);_=r.#c(n,L,_,i),e.push(L);continue}C+=S}return e.push(C),_}let p=t+1,m=new r(null,e),y=[],w="";for(;p<n.length;){let _=n.charAt(p++);if(o||_==="\\"){o=!o,w+=_;continue}if(a){p===h+1?(_==="^"||_==="!")&&(c=!0):_==="]"&&!(p===h+2&&c)&&(a=!1),w+=_;continue}else if(_==="["){a=!0,h=p,c=!1,w+=_;continue}if(Oa(_)&&n.charAt(p)==="("){m.push(w),w="";let C=new r(_,m);m.push(C),p=r.#c(n,C,p,i);continue}if(_==="|"){m.push(w),w="",y.push(m),m=new r(null,e);continue}if(_===")")return w===""&&e.#e.length===0&&(e.#l=!0),m.push(w),w="",e.push(...y,m),p;w+=_}return e.type=null,e.#r=void 0,e.#e=[n.substring(t-1)],p}static fromGlob(n,e={}){let t=new r(null,void 0,e);return r.#c(n,t,0,e),t}toMMPattern(){if(this!==this.#n)return this.#n.toMMPattern();let n=this.toString(),[e,t,i,o]=this.toRegExpSource();if(!(i||this.#r||this.#i.nocase&&!this.#i.nocaseMagicOnly&&n.toUpperCase()!==n.toLowerCase()))return t;let h=(this.#i.nocase?"i":"")+(o?"u":"");return Object.assign(new RegExp(`^${e}$`,h),{_src:e,_glob:n})}get options(){return this.#i}toRegExpSource(n){let e=n??!!this.#i.dot;if(this.#n===this&&this.#f(),!this.type){let c=this.isStart()&&this.isEnd(),p=this.#e.map(_=>{let[C,S,L,U]=typeof _=="string"?r.#g(_,this.#r,c):_.toRegExpSource(n);return this.#r=this.#r||L,this.#o=this.#o||U,C}).join(""),m="";if(this.isStart()&&typeof this.#e[0]=="string"&&!(this.#e.length===1&&cc.has(this.#e[0]))){let C=hc,S=e&&C.has(p.charAt(0))||p.startsWith("\\.")&&C.has(p.charAt(2))||p.startsWith("\\.\\.")&&C.has(p.charAt(4)),L=!e&&!n&&C.has(p.charAt(0));m=S?uc:L?Mn:""}let y="";return this.isEnd()&&this.#n.#s&&this.#t?.type==="!"&&(y="(?:$|\\/)"),[m+p+y,kt(p),this.#r=!!this.#r,this.#o]}let t=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",o=this.#d(e);if(this.isStart()&&this.isEnd()&&!o&&this.type!=="!"){let c=this.toString();return this.#e=[c],this.type=null,this.#r=void 0,[c,kt(this.toString()),!1,!1]}let a=!t||n||e||!Mn?"":this.#d(!0);a===o&&(a=""),a&&(o=`(?:${o})(?:${a})*?`);let h="";if(this.type==="!"&&this.#l)h=(this.isStart()&&!e?Mn:"")+Na;else{let c=this.type==="!"?"))"+(this.isStart()&&!e&&!n?Mn:"")+za+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;h=i+o+c}return[h,kt(o),this.#r=!!this.#r,this.#o]}#d(n){return this.#e.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[t,i,o,a]=e.toRegExpSource(n);return this.#o=this.#o||a,t}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#g(n,e,t=!1){let i=!1,o="",a=!1;for(let h=0;h<n.length;h++){let c=n.charAt(h);if(i){i=!1,o+=(lc.has(c)?"\\":"")+c;continue}if(c==="\\"){h===n.length-1?o+="\\\\":i=!0;continue}if(c==="["){let[p,m,y,w]=Ia(n,h);if(y){o+=p,a=a||m,h+=y-1,e=e||w;continue}}if(c==="*"){t&&n==="*"?o+=Na:o+=za,e=!0;continue}if(c==="?"){o+=Hr,e=!0;continue}o+=dc(c)}return[o,kt(n),!!e,a]}};var Vr=(r,{windowsPathsNoEscape:n=!1}={})=>n?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&");var Fe=(r,n,e={})=>(mn(n),!e.nocomment&&n.charAt(0)==="#"?!1:new tn(n,e).match(r)),fc=/^\*+([^+@!?\*\[\(]*)$/,gc=r=>n=>!n.startsWith(".")&&n.endsWith(r),pc=r=>n=>n.endsWith(r),vc=r=>(r=r.toLowerCase(),n=>!n.startsWith(".")&&n.toLowerCase().endsWith(r)),mc=r=>(r=r.toLowerCase(),n=>n.toLowerCase().endsWith(r)),yc=/^\*+\.\*+$/,bc=r=>!r.startsWith(".")&&r.includes("."),wc=r=>r!=="."&&r!==".."&&r.includes("."),Ec=/^\.\*+$/,_c=r=>r!=="."&&r!==".."&&r.startsWith("."),Sc=/^\*+$/,Tc=r=>r.length!==0&&!r.startsWith("."),Ac=r=>r.length!==0&&r!=="."&&r!=="..",Cc=/^\?+([^+@!?\*\[\(]*)?$/,Rc=([r,n=""])=>{let e=Ma([r]);return n?(n=n.toLowerCase(),t=>e(t)&&t.toLowerCase().endsWith(n)):e},kc=([r,n=""])=>{let e=ja([r]);return n?(n=n.toLowerCase(),t=>e(t)&&t.toLowerCase().endsWith(n)):e},Lc=([r,n=""])=>{let e=ja([r]);return n?t=>e(t)&&t.endsWith(n):e},Dc=([r,n=""])=>{let e=Ma([r]);return n?t=>e(t)&&t.endsWith(n):e},Ma=([r])=>{let n=r.length;return e=>e.length===n&&!e.startsWith(".")},ja=([r])=>{let n=r.length;return e=>e.length===n&&e!=="."&&e!==".."},Ha=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Ua={win32:{sep:"\\"},posix:{sep:"/"}},Gc=Ha==="win32"?Ua.win32.sep:Ua.posix.sep;Fe.sep=Gc;var Ke=Symbol("globstar **");Fe.GLOBSTAR=Ke;var xc="[^/]",Pc=xc+"*?",Fc="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Ic="(?:(?!(?:\\/|^)\\.).)*?",Oc=(r,n={})=>e=>Fe(e,r,n);Fe.filter=Oc;var Ze=(r,n={})=>Object.assign({},r,n),zc=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Fe;let n=Fe;return Object.assign((t,i,o={})=>n(t,i,Ze(r,o)),{Minimatch:class extends n.Minimatch{constructor(i,o={}){super(i,Ze(r,o))}static defaults(i){return n.defaults(Ze(r,i)).Minimatch}},AST:class extends n.AST{constructor(i,o,a={}){super(i,o,Ze(r,a))}static fromGlob(i,o={}){return n.AST.fromGlob(i,Ze(r,o))}},unescape:(t,i={})=>n.unescape(t,Ze(r,i)),escape:(t,i={})=>n.escape(t,Ze(r,i)),filter:(t,i={})=>n.filter(t,Ze(r,i)),defaults:t=>n.defaults(Ze(r,t)),makeRe:(t,i={})=>n.makeRe(t,Ze(r,i)),braceExpand:(t,i={})=>n.braceExpand(t,Ze(r,i)),match:(t,i,o={})=>n.match(t,i,Ze(r,o)),sep:n.sep,GLOBSTAR:Ke})};Fe.defaults=zc;var Va=(r,n={})=>(mn(r),n.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:(0,Ba.default)(r));Fe.braceExpand=Va;var Nc=(r,n={})=>new tn(r,n).makeRe();Fe.makeRe=Nc;var Uc=(r,n,e={})=>{let t=new tn(n,e);return r=r.filter(i=>t.match(i)),t.options.nonull&&!r.length&&r.push(n),r};Fe.match=Uc;var Wa=/[?*]|[+@!]\(.*?\)|\[|\]/,Wc=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),tn=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(n,e={}){mn(n),e=e||{},this.options=e,this.pattern=n,this.platform=e.platform||Ha,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let n of this.set)for(let e of n)if(typeof e!="string")return!0;return!1}debug(...n){}make(){let n=this.pattern,e=this.options;if(!e.nocomment&&n.charAt(0)==="#"){this.comment=!0;return}if(!n){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...o)=>console.error(...o)),this.debug(this.pattern,this.globSet);let t=this.globSet.map(o=>this.slashSplit(o));this.globParts=this.preprocess(t),this.debug(this.pattern,this.globParts);let i=this.globParts.map((o,a,h)=>{if(this.isWindows&&this.windowsNoMagicRoot){let c=o[0]===""&&o[1]===""&&(o[2]==="?"||!Wa.test(o[2]))&&!Wa.test(o[3]),p=/^[a-z]:/i.test(o[0]);if(c)return[...o.slice(0,4),...o.slice(4).map(m=>this.parse(m))];if(p)return[o[0],...o.slice(1).map(m=>this.parse(m))]}return o.map(c=>this.parse(c))});if(this.debug(this.pattern,i),this.set=i.filter(o=>o.indexOf(!1)===-1),this.isWindows)for(let o=0;o<this.set.length;o++){let a=this.set[o];a[0]===""&&a[1]===""&&this.globParts[o][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(n){if(this.options.noglobstar)for(let t=0;t<n.length;t++)for(let i=0;i<n[t].length;i++)n[t][i]==="**"&&(n[t][i]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(n=this.firstPhasePreProcess(n),n=this.secondPhasePreProcess(n)):e>=1?n=this.levelOneOptimize(n):n=this.adjascentGlobstarOptimize(n),n}adjascentGlobstarOptimize(n){return n.map(e=>{let t=-1;for(;(t=e.indexOf("**",t+1))!==-1;){let i=t;for(;e[i+1]==="**";)i++;i!==t&&e.splice(t,i-t)}return e})}levelOneOptimize(n){return n.map(e=>(e=e.reduce((t,i)=>{let o=t[t.length-1];return i==="**"&&o==="**"?t:i===".."&&o&&o!==".."&&o!=="."&&o!=="**"?(t.pop(),t):(t.push(i),t)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(n){Array.isArray(n)||(n=this.slashSplit(n));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let i=1;i<n.length-1;i++){let o=n[i];i===1&&o===""&&n[0]===""||(o==="."||o==="")&&(e=!0,n.splice(i,1),i--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(e=!0,n.pop())}let t=0;for(;(t=n.indexOf("..",t+1))!==-1;){let i=n[t-1];i&&i!=="."&&i!==".."&&i!=="**"&&(e=!0,n.splice(t-1,2),t-=2)}}while(e);return n.length===0?[""]:n}firstPhasePreProcess(n){let e=!1;do{e=!1;for(let t of n){let i=-1;for(;(i=t.indexOf("**",i+1))!==-1;){let a=i;for(;t[a+1]==="**";)a++;a>i&&t.splice(i+1,a-i);let h=t[i+1],c=t[i+2],p=t[i+3];if(h!==".."||!c||c==="."||c===".."||!p||p==="."||p==="..")continue;e=!0,t.splice(i,1);let m=t.slice(0);m[i]="**",n.push(m),i--}if(!this.preserveMultipleSlashes){for(let a=1;a<t.length-1;a++){let h=t[a];a===1&&h===""&&t[0]===""||(h==="."||h==="")&&(e=!0,t.splice(a,1),a--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let o=0;for(;(o=t.indexOf("..",o+1))!==-1;){let a=t[o-1];if(a&&a!=="."&&a!==".."&&a!=="**"){e=!0;let c=o===1&&t[o+1]==="**"?["."]:[];t.splice(o-1,2,...c),t.length===0&&t.push(""),o-=2}}}}while(e);return n}secondPhasePreProcess(n){for(let e=0;e<n.length-1;e++)for(let t=e+1;t<n.length;t++){let i=this.partsMatch(n[e],n[t],!this.preserveMultipleSlashes);if(i){n[e]=[],n[t]=i;break}}return n.filter(e=>e.length)}partsMatch(n,e,t=!1){let i=0,o=0,a=[],h="";for(;i<n.length&&o<e.length;)if(n[i]===e[o])a.push(h==="b"?e[o]:n[i]),i++,o++;else if(t&&n[i]==="**"&&e[o]===n[i+1])a.push(n[i]),i++;else if(t&&e[o]==="**"&&n[i]===e[o+1])a.push(e[o]),o++;else if(n[i]==="*"&&e[o]&&(this.options.dot||!e[o].startsWith("."))&&e[o]!=="**"){if(h==="b")return!1;h="a",a.push(n[i]),i++,o++}else if(e[o]==="*"&&n[i]&&(this.options.dot||!n[i].startsWith("."))&&n[i]!=="**"){if(h==="a")return!1;h="b",a.push(e[o]),i++,o++}else return!1;return n.length===e.length&&a}parseNegate(){if(this.nonegate)return;let n=this.pattern,e=!1,t=0;for(let i=0;i<n.length&&n.charAt(i)==="!";i++)e=!e,t++;t&&(this.pattern=n.slice(t)),this.negate=e}matchOne(n,e,t=!1){let i=this.options;if(this.isWindows){let S=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),L=!S&&n[0]===""&&n[1]===""&&n[2]==="?"&&/^[a-z]:$/i.test(n[3]),U=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),z=!U&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),R=L?3:S?0:void 0,D=z?3:U?0:void 0;if(typeof R=="number"&&typeof D=="number"){let[G,W]=[n[R],e[D]];G.toLowerCase()===W.toLowerCase()&&(e[D]=G,D>R?e=e.slice(D):R>D&&(n=n.slice(R)))}}let{optimizationLevel:o=1}=this.options;o>=2&&(n=this.levelTwoFileOptimize(n)),this.debug("matchOne",this,{file:n,pattern:e}),this.debug("matchOne",n.length,e.length);for(var a=0,h=0,c=n.length,p=e.length;a<c&&h<p;a++,h++){this.debug("matchOne loop");var m=e[h],y=n[a];if(this.debug(e,m,y),m===!1)return!1;if(m===Ke){this.debug("GLOBSTAR",[e,m,y]);var w=a,_=h+1;if(_===p){for(this.debug("** at the end");a<c;a++)if(n[a]==="."||n[a]===".."||!i.dot&&n[a].charAt(0)===".")return!1;return!0}for(;w<c;){var C=n[w];if(this.debug(`
globstar while`,n,w,e,_,C),this.matchOne(n.slice(w),e.slice(_),t))return this.debug("globstar found match!",w,c,C),!0;if(C==="."||C===".."||!i.dot&&C.charAt(0)==="."){this.debug("dot detected!",n,w,e,_);break}this.debug("globstar swallow a segment, and continue"),w++}return!!(t&&(this.debug(`
>>> no match, partial?`,n,w,e,_),w===c))}let S;if(typeof m=="string"?(S=y===m,this.debug("string match",m,y,S)):(S=m.test(y),this.debug("pattern match",m,y,S)),!S)return!1}if(a===c&&h===p)return!0;if(a===c)return t;if(h===p)return a===c-1&&n[a]==="";throw new Error("wtf?")}braceExpand(){return Va(this.pattern,this.options)}parse(n){mn(n);let e=this.options;if(n==="**")return Ke;if(n==="")return"";let t,i=null;(t=n.match(Sc))?i=e.dot?Ac:Tc:(t=n.match(fc))?i=(e.nocase?e.dot?mc:vc:e.dot?pc:gc)(t[1]):(t=n.match(Cc))?i=(e.nocase?e.dot?kc:Rc:e.dot?Lc:Dc)(t):(t=n.match(yc))?i=e.dot?wc:bc:(t=n.match(Ec))&&(i=_c);let o=en.fromGlob(n,this.options).toMMPattern();return i&&typeof o=="object"&&Reflect.defineProperty(o,"test",{value:i}),o}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let n=this.set;if(!n.length)return this.regexp=!1,this.regexp;let e=this.options,t=e.noglobstar?Pc:e.dot?Fc:Ic,i=new Set(e.nocase?["i"]:[]),o=n.map(c=>{let p=c.map(m=>{if(m instanceof RegExp)for(let y of m.flags.split(""))i.add(y);return typeof m=="string"?Wc(m):m===Ke?Ke:m._src});return p.forEach((m,y)=>{let w=p[y+1],_=p[y-1];m!==Ke||_===Ke||(_===void 0?w!==void 0&&w!==Ke?p[y+1]="(?:\\/|"+t+"\\/)?"+w:p[y]=t:w===void 0?p[y-1]=_+"(?:\\/|"+t+")?":w!==Ke&&(p[y-1]=_+"(?:\\/|\\/"+t+"\\/)"+w,p[y+1]=Ke))}),p.filter(m=>m!==Ke).join("/")}).join("|"),[a,h]=n.length>1?["(?:",")"]:["",""];o="^"+a+o+h+"$",this.negate&&(o="^(?!"+o+").+$");try{this.regexp=new RegExp(o,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(n){return this.preserveMultipleSlashes?n.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(n)?["",...n.split(/\/+/)]:n.split(/\/+/)}match(n,e=this.partial){if(this.debug("match",n,this.pattern),this.comment)return!1;if(this.empty)return n==="";if(n==="/"&&e)return!0;let t=this.options;this.isWindows&&(n=n.split("\\").join("/"));let i=this.slashSplit(n);this.debug(this.pattern,"split",i);let o=this.set;this.debug(this.pattern,"set",o);let a=i[i.length-1];if(!a)for(let h=i.length-2;!a&&h>=0;h--)a=i[h];for(let h=0;h<o.length;h++){let c=o[h],p=i;if(t.matchBase&&c.length===1&&(p=[a]),this.matchOne(p,c,e))return t.flipNegate?!0:!this.negate}return t.flipNegate?!1:this.negate}static defaults(n){return Fe.defaults(n).Minimatch}};Fe.AST=en;Fe.Minimatch=tn;Fe.escape=Vr;Fe.unescape=kt;var jn=class{rules=[];constructor(n){this.rules=JSON.parse(n)}getMaxDependents(n){try{if(this.rules.length===0){console.error("Arquivo de configura\xE7\xE3o n\xE3o encontrado.");return}if(!n){console.error("Caminho de origem n\xE3o fornecido.");return}let e;for(let t of this.rules)if(this.matchGlob(t.source,n)){e=t.maxDependencies;break}return e}catch(e){console.error("Erro ao verificar regras de importa\xE7\xE3o:",e);return}}async getCRV(n,e){try{if(this.rules.length===0)return console.error("Arquivo de configura\xE7\xE3o n\xE3o encontrado."),[];if(!n||!e)return console.error("Caminho de origem ou destino n\xE3o fornecido."),[];if(n===e)return console.error("O caminho de origem e destino s\xE3o iguais."),[];let t=[];if(!this.rules||this.rules.length===0)return console.error("Arquivo de configura\xE7\xE3o n\xE3o encontrado."),t;for(let i of this.rules)if(this.matchGlob(i.source,n))for(let a of i.cannotDependOn??[])this.matchGlob(a,e)&&t.push({description:i.description??"No description",sourcePath:n,targetPath:e});return t}catch(t){return console.error("Erro ao verificar regras de importa\xE7\xE3o:",t),[]}}matchGlob(n,e){return Fe(e,n)}};var _e,qe={},re=new Zn.default,Se={searchQuery:""},on,qn=null,bn,Ut=!1,Lt=null,qr=!1,st=!0,nn=!0,$r=!1,rn=[],Wt=document.getElementById("search-input"),Mc=document.getElementById("suggestions"),Hn=document.getElementById("drag-node"),Vn=document.getElementById("hover-node"),jc=document.getElementById("full-screen"),Hc=document.getElementById("sigma-container"),$n=document.getElementById("general"),Yn=document.getElementById("scoped"),Kn=document.getElementById("lock");async function Za(){return re=new Zn.default,Object.keys(qe).forEach(async r=>{let n=qe[r],e=n.imports;if(!re.hasNode(r)){let t=n.filePath,i=n.fileName,o=n.isGodFile,a=qe[t].imports.length;re.addNode(t,{x:Math.random(),y:Math.random(),label:i,color:"#db381b",size:Math.min(12,7+a*.1),filePath:t,dependsOn:a,isGodFile:o})}e.forEach(async t=>{let i=t.filePath,o=t.fileName,a=t.relativePath,h=t.isGodFile,c=0;if(qe[i]&&(c=qe[i].imports.length),re.hasNode(a)||re.addNode(a,{x:Math.random(),y:Math.random(),color:"#ff6347",label:o,size:Math.min(7,6+c*.1),filePath:i,dependsOn:c,relativePath:a,isGodFile:h}),a&&!re.hasEdge(r,a))if(on){let p=await on.getCRV(r,i);rn.push(...p),re.addEdge(r,a,{color:p.length>0?"#ff0000":"#1f1e1e30",size:p.length>0?.5:1})}else re.addEdge(r,a)})}),re}async function Vc(){return re=new Zn.default,Object.keys(qe).forEach(async r=>{let n=qe[r],e=n.imports;if(!re.hasNode(r)){let t=n.filePath,i=n.fileName,o=n.isGodFile,a=e.length;re.addNode(t,{x:Math.random(),y:Math.random(),label:i,color:"#db381b",size:Math.min(9,7+a*.1),filePath:t,dependsOn:a,isGodFile:o})}e.forEach(async t=>{let i=t.filePath,o=t.fileName,a=t.relativePath,h=t.isGodFile,c=0;if(qe[i]&&(c=qe[i].imports.length),re.hasNode(i)||re.addNode(i,{x:Math.random(),y:Math.random(),color:"#ff6347",label:o,size:Math.min(9,6+c*.1),filePath:i,dependsOn:c,relativePath:a,isGodFile:h}),i&&!re.hasEdge(r,i))if(on){let p=await on.getCRV(r,i);rn.push(...p),re.addEdge(r,i,{color:p.length>0?"#ff0000":"#1f1e1e30",size:p.length>0?.5:1})}else re.addEdge(r,i)})}),re}function Xn(r){if(Se.searchQuery=r,Wt.value!==r&&(Wt.value=r),r){let n=r.toLowerCase(),e=re.nodes().map(t=>t).map(t=>({id:t,label:re.getNodeAttribute(t,"label")})).filter(({label:t})=>t.toLowerCase().includes(n));if(e.length===1&&e[0].label===r){Se.selectedNode=e[0].id,Se.suggestions=void 0;let t=_e.getNodeDisplayData(Se.selectedNode);_e.getCamera().animate(t,{duration:500})}else Se.selectedNode=void 0,Se.suggestions=new Set(e.map(({id:t})=>t))}else Se.selectedNode=void 0,Se.suggestions=void 0;_e.refresh()}function Yr(r){st&&(r?(Se.hoveredNode=r,Se.hoveredNeighbors=new Set(re.neighbors(r))):(Se.hoveredNode=void 0,Se.hoveredNeighbors=void 0),_e?.refresh())}function Ka(){document.activeElement.blur(),Ut=!Ut,Hn.style.backgroundColor=Ut?"#adc6ff":"#f2f2f2",Ut?Hn.textContent="Drag node: ON":Hn.textContent="Drag node: OFF"}Hn.addEventListener("click",Ka);function Zr(r){Yr(void 0),document.activeElement.blur(),st=r,Vn.style.backgroundColor=st?"#adc6ff":"#f2f2f2",st?Vn.textContent="Hide others: ON":Vn.textContent="Hide others: OFF"}Vn.addEventListener("click",()=>{st=!st,Zr(st)});function Qa(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}jc.addEventListener("click",Qa);function Ja(){nn=!nn,Kn.textContent=nn?"\u{1F513}":"\u{1F512}",nn?es():(bn.isRunning(),Kr())}Kn.addEventListener("click",Ja);function Kr(){qn&&qn(),bn.isRunning()&&bn.stop()}function es(){qn&&qn(),bn.start()}$n.addEventListener("click",async()=>{$n.style.backgroundColor="#adc6ff",Yn.style.backgroundColor="#f2f2f2",nn=!0,Kn.textContent="\u{1F513}",Kr(),await Vc(),Jr()});Yn.addEventListener("click",async()=>{$n.style.backgroundColor="#f2f2f2",Yn.style.backgroundColor="#adc6ff",nn=!0,Kn.textContent="\u{1F513}",Kr(),await Za(),Jr()});function Qr(){let r=document.getElementById("panel"),n=document.getElementById("panelContent"),e=document.getElementById("toggleText");$r?(n.style.display="none",e.textContent="Connection Rules Violations"):(n.style.display="block",e.textContent="Connection Rules Violations"),$r=!$r}document.getElementById("togglePanelButton").addEventListener("click",Qr);function Xr(r){return r.includes("/")?r.split("/").pop():r.includes("\\")?r.split("\\").pop():r}function qc(){let r=document.getElementById("panelContent");if(r.innerHTML=`<ul style="list-style-type: none; padding-inline-start: 0; margin: 0;">
${rn.map(n=>`<li style="margin-bottom: 2px; padding: 4px 10px; background-color: bisque; border-bottom: transparent solid 1px;">
  <p style="margin: auto;">${n.description}</p>
  <a href="vscode://file${n.sourcePath}" target="_blank" style="text-decoration: none;">\u26A0\uFE0F ${Xr(n.sourcePath)}</a>${n.isGodFile?"":` \u27A1 <a href="vscode://file${n.targetPath}" target="_blank" style="text-decoration: none;">${Xr(n.targetPath)}</a>`}</li>`).join("")}
</ul>`,rn.length>0){Qr(),document.querySelector("#crvIndicator circle").setAttribute("fill","red");let e=document.getElementById("total-violations");e.textContent=rn.length.toString()}}function Jr(){Ya.default.assign(re,{nodeCommunityAttribute:"community"});let r=new Set;re.forEachNode((a,h)=>r.add(h.community));let n=Array.from(r),e=(0,Xa.default)(r.size).reduce((a,h,c)=>({...a,[n[c]]:h}),{});re.forEachNode((a,h)=>{let c=re.getNodeAttribute(a,"isGodFile"),p=re.getNodeAttribute(a,"label"),m=re.getNodeAttribute(a,"dependsOn");console.log("isGodFile",c),re.setNodeAttribute(a,"color",c?"red":e[h.community]),re.setNodeAttribute(a,"size",c?13:Math.min(12,7+m*.1)),re.setNodeAttribute(a,"label",c?`${p}`:p)});let t=qa.default.inferSettings(re);bn=new $a.default(re,{settings:t}),_e?.clear(),_e?.removeAllListeners(),_e?.kill(),_e=new yo(re,Hc,{defaultEdgeColor:"#1f1e1e30",labelColor:{color:"#bfbdbd"}});let i=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;_e.setSetting("labelWeight","bold"),_e.on("enterNode",({node:a})=>{Yr(a)}),_e.on("leaveNode",()=>{Yr(void 0)}),_e.setSetting("nodeReducer",(a,h)=>{let c={...h};if(Se.hoveredNeighbors&&!Se.hoveredNeighbors.has(a)&&Se.hoveredNode!==a){if(!st)return;c.label="",c.color="#2b2b2b30"}if(Se.hoveredNode===a||Se.selectedNode===a)c.highlighted=!0;else if(Se.suggestions&&!Se.suggestions.has(a)){if(!st)return;c.label="",c.color="#2b2b2b30"}return c}),_e.setSetting("edgeReducer",(a,h)=>{let c={...h};return Se.hoveredNode&&!re.hasExtremity(a,Se.hoveredNode)&&(c.hidden=!0),Se.suggestions&&(!Se.suggestions.has(re.source(a))||!Se.suggestions.has(re.target(a)))&&(c.hidden=!0),c}),_e.on("downNode",a=>{Ut&&(qr=!0,Lt=a.node,re.setNodeAttribute(Lt,"highlighted",!0),_e.getCustomBBox()||_e.setCustomBBox(_e.getBBox()))}),_e.on("moveBody",({event:a})=>{if(!Ut||!qr||!Lt)return;let h=_e.viewportToGraph(a);re.setNodeAttribute(Lt,"x",h.x),re.setNodeAttribute(Lt,"y",h.y),a.preventSigmaDefault(),a.original.preventDefault(),a.original.stopPropagation()});let o=()=>{Ut&&(Lt&&re.removeNodeAttribute(Lt,"highlighted"),qr=!1,Lt=null)};_e.on("upNode",o),_e.on("upStage",o),_e.on("clickNode",a=>{let h=a.node,c=a.event.x,p=a.event.y,m=re.getNodeAttribute(h,"label"),y=re.getNodeAttribute(h,"dependsOn"),w=re.getNodeAttribute(h,"filePath");if(h){let _=`vscode://file${w}`;Xc(m,`Depends on ${y} files
Path: ${w}`,_)}a.preventSigmaDefault(),a.event.preventSigmaDefault()}),Mc.innerHTML=re.nodes().map(a=>`<option value="${re.getNodeAttribute(a,"label")}"></option>`).join(`
`),es()}Wt.addEventListener("input",()=>{Xn(Wt.value||"")});Wt.addEventListener("blur",()=>{});window.addEventListener("message",async r=>{try{let n=JSON.parse(r.data);qe=n.files,n.rules&&(on=new jn(n.rules),Yc()),await Za(),Jr(),qc()}catch(n){console.error("Error:",n)}});function $c(){for(let r in qe)if(qe.hasOwnProperty(r)){let n=qe[r],e=n.filePath,t=on.getMaxDependents(e);if(!t)continue;let i=n.imports.length,o=t&&i>t,a=Xr(e);o&&(n.isGodFile=!0,rn.push({description:`File ${a} has ${i} dependencies (max is ${t})`,sourcePath:e,isGodFile:!0}))}}function Yc(){$c()}document.addEventListener("DOMContentLoaded",function(){let r=document.getElementById("sigma-container");window.sigma=r,Yn.style.backgroundColor="#adc6ff",$n.style.backgroundColor="#f2f2f2",Zr(!0)});function Xc(r,n,e){let t=document.getElementById("toast"),i=document.getElementById("toast-text"),o=document.getElementById("toast-link"),a=document.getElementById("close-toast"),h=document.getElementById("toast-focus");h.textContent=r,h.addEventListener("click",()=>{Xn(r);let c=_e.getNodeDisplayData(r);_e.getCamera().animate(c,{duration:500})}),i.textContent=n,o.href=e,t.classList.remove("hide"),t.classList.add("show"),a.addEventListener("click",()=>{Xn(""),t.classList.remove("show"),t.classList.add("hide")})}document.addEventListener("keydown",r=>{if(Wt!==document.activeElement)if(r.key==="Escape"||r.key==="Enter"){let n=document.getElementById("toast");n.classList.remove("show"),n.classList.add("hide"),Wt.value="",Xn("")}else r.key==="h"?Zr(!st):r.key==="d"?Ka():r.key==="p"?Qr():r.key==="f"?Qa():r.key==="a"&&Ja()});})();
